

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AddMint - Ultra Professional</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS start here (copied from style.css for all-in-one file) */

        /* General Body and Container Styles */
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color-main); /* Using CSS variables */
            color: var(--text-color-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease; /* For dark/light mode */
        }

        /* Dark Mode Variables (Default) */
        body.dark-mode {
            --bg-color-main: #1a1a2e;
            --bg-color-lighter: #16213e;
            --bg-color-darker: #0d2a4a;
            --text-color-main: #e0e0e0;
            --text-color-light: #bbb;
            --text-color-accent: #00ffff;
            --border-color-main: #0f3460;
            --shadow-color-main: rgba(0, 255, 255, 0.2);
            --shadow-color-strong: rgba(0, 255, 255, 0.4);
            --highlight-color-main: #00ffff;
            --highlight-color-secondary: #ff00ff;
            --button-primary-bg: #00ffff;
            --button-primary-text: #1a1a2e;
            --button-secondary-bg: #334e68;
            --button-secondary-text: #e0e0e0;
            --input-bg: #1a1a2e;
            --input-border: #00ffff;
            --post-card-bg: #0f3460;
            --chat-bubble-left-bg: #334e68;
            --chat-bubble-right-bg: #00ffff;
            --chat-bubble-right-text: #1a1a2e;
        }

        /* Light Mode Variables (Example, not fully implemented for all elements) */
        body.light-mode {
            --bg-color-main: #f0f2f5;
            --bg-color-lighter: #ffffff;
            --bg-color-darker: #e0e0e0;
            --text-color-main: #333333;
            --text-color-light: #666666;
            --text-color-accent: #007bff;
            --border-color-main: #cccccc;
            --shadow-color-main: rgba(0, 0, 0, 0.1);
            --shadow-color-strong: rgba(0, 0, 0, 0.2);
            --highlight-color-main: #007bff;
            --highlight-color-secondary: #6f42c1;
            --button-primary-bg: #007bff;
            --button-primary-text: #ffffff;
            --button-secondary-bg: #e9ecef;
            --button-secondary-text: #333333;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --post-card-bg: #ffffff;
            --chat-bubble-left-bg: #e9ecef;
            --chat-bubble-right-bg: #007bff;
            --chat-bubble-right-text: #ffffff;
        }


        .app-container {
            width: 100%;
            max-width: 420px; /* Typical mobile width */
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color-lighter);
            box-shadow: 0 0 30px var(--shadow-color-main); /* Subtle glow */
            border-radius: 12px;
            overflow: hidden;
            position: relative; /* For sidebar positioning */
            border: 1px solid var(--border-color-main);
        }

        /* Added by JS if necessary to initially hide until content is ready */
        .hidden {
            display: none !important; /* Forces elements to be truly hidden by default */
        }

        /* Diagnostic message - Visible only if JavaScript successfully loads and sets its display */
        #load-status {
            position:fixed; 
            top:50%; 
            left:50%; 
            transform:translate(-50%, -50%); 
            color:white; 
            background:black; 
            padding:10px; 
            z-index:9999;
            display: none; /* JS will change this to block */
            text-align: center;
        }

        /* Auth Container (Login/Signup) - Now handled more robustly by JS display flex/none */
        .auth-container {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            display: flex; /* Changed from default hidden to flex, controlled by JS. */
            justify-content: center;
            align-items: center; /* Vertically centers the .auth-content */
            background-color: var(--bg-color-lighter);
            box-shadow: 0 0 30px var(--shadow-color-main);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color-main);
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
            text-align: center;
        }
        .auth-content { /* Main content area for forms */
            width: 100%;
            background-color: var(--bg-color-main);
            padding: 30px 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid var(--border-color-main);
            display: flex; /* Inner flex to arrange children vertically */
            flex-direction: column;
            align-items: center; /* Center login/signup forms */
        }
        .app-logo-splash { /* Used by auth-content h1 */
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #00ffff, #ff00ff); 
            border-radius: 50%;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), 0 0 40px rgba(255, 0, 255, 0.4);
            animation: pulse 2s infinite alternate;
        }
        .app-logo-splash::before {
            content: 'A'; 
            font-family: 'Montserrat', sans-serif;
            font-size: 60px;
            font-weight: bold;
            color: #1a1a2e;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }


        .auth-screen { 
            display: none; /* Default to hidden */
            width: 100%; 
            flex-direction: column; 
            align-items: center; 
        }
        .auth-screen.active {
            display: flex; /* Active screen becomes visible flex */
        }
        .auth-text { 
            font-size: 0.9em;
            margin-top: 15px;
            color: var(--text-color-light);
        }
        .auth-text a { 
            color: var(--highlight-color-main);
            text-decoration: none;
            font-weight: bold;
        }
        .auth-text a:hover {
            text-decoration: underline;
        }
        .status-message { 
            margin-top: 15px;
            padding: 8px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .status-message.error { 
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        .status-message.success { 
            background-color: rgba(51, 255, 87, 0.2);
            color: #33ff57;
            border: 1px solid #33ff57;
        }
        .status-message.info { 
            background-color: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border: 1px solid #00ffff;
        }


        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--border-color-main);
            color: white;
            border-bottom: 1px solid var(--bg-color-darker);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .header-left, .header-right {
            display: flex;
            align-items: center;
        }

        .app-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-left: 15px;
            color: var(--highlight-color-main);
            text-shadow: 0 0 5px var(--highlight-color-main);
        }

        .icon-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 15px;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .icon-button:hover {
            color: var(--highlight-color-main);
            transform: scale(1.1);
        }

        .loader { 
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--highlight-color-main);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .menu-icon {
            width: 30px;
            height: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
        }

        .menu-icon .bar {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 2px;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px; /* Hidden by default */
            width: 280px;
            height: 100%;
            background-color: var(--border-color-main);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
            z-index: 20;
            transition: left 0.3s ease-in-out;
            padding-top: 20px;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--bg-color-darker);
            margin-bottom: 20px;
            position: relative;
        }

        .sidebar-header h3 {
            margin: 0 0 0 15px;
            color: var(--highlight-color-main);
            font-size: 1.4em;
            max-width: 150px; /* Prevent long names from pushing close button */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-header .close-sidebar {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            color: white;
            cursor: pointer;
            line-height: 1;
        }

        .profile-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--highlight-color-main); /* Default for coded avatars */
            overflow: hidden;
            position: relative;
            border: 2px solid var(--highlight-color-main);
            flex-shrink: 0;
            background-size: cover; /* For direct pic link */
            background-position: center; /* For direct pic link */
        }
        .profile-avatar-small::before {
            content: '👤'; /* Default large avatar */
            font-family: 'Font Awesome 6 Free'; font-weight: 900;
            font-size: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--button-primary-text);
        }
        .profile-avatar-small[style*="background-image"]::before {
            content: none; /* Hide default emoji if image is loaded */
        }


        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-color-main);
            text-decoration: none;
            font-size: 1.1em;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .sidebar ul li a:hover {
            background-color: var(--bg-color-main);
            color: var(--highlight-color-main);
        }

        /* Data Saver Toggle */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            margin-left: auto; /* Push to the right */
            flex-shrink: 0; /* Prevent shrinking */
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-switch label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-switch label:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + label {
            background-color: var(--highlight-color-main);
        }

        .toggle-switch input:checked + label:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }


        /* Main Content */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        .app-screen {
            display: none;
        }

        .app-screen.active {
            display: block;
        }

        section {
            background-color: var(--bg-color-main);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px var(--shadow-color-main);
            border: 1px solid var(--border-color-main);
        }

        h2 {
            color: var(--highlight-color-main);
            text-shadow: 0 0 5px var(--highlight-color-main);
            border-bottom: 2px solid var(--border-color-main);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Category Filter */
        .category-filter {
            margin-bottom: 20px;
        }
        .category-filter select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color-main);
            border: 1px solid var(--input-border);
        }


        /* Post Feed Styles */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Space between posts */
        }

        .post-card {
            background-color: var(--post-card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.08);
            border: 1px solid var(--bg-color-darker);
            transition: box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
            position: relative; /* For neon effect */
        }

        .post-card.neon-glow {
            box-shadow: 0 0 5px var(--highlight-color-main), 0 0 15px var(--highlight-color-main), 0 0 25px var(--highlight-color-main), 0 0 35px var(--highlight-color-main);
            border-color: var(--highlight-color-main);
        }
        
        /* NEW: Remix effect */
        .post-card.remixed {
            background-color: #2a163e; /* Lighter purple/darker blue for remixed */
            border-color: #ff00ff; /* Pink border */
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2);
        }
        .remix-content-wrapper {
            display: flex;
            flex-direction: column; /* Stack them for better mobile view */
            gap: 10px;
            margin-top: 10px;
            border-top: 1px dashed #0d2a4a;
            padding-top: 15px;
        }
        .remix-original, .remix-reply {
            padding: 10px;
            border-radius: 8px;
            background-color: #1a1a2e; /* Darker background for remix sections */
            border: 1px solid #0f3460;
        }
        .remix-original h5, .remix-reply h5 {
            margin-top: 0;
            color: #00ffff;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .remix-original p, .remix-reply p {
            font-size: 0.9em;
            color: #e0e0e0;
            margin-bottom: 0;
        }
        /* End NEW: Remix effect */


        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #00ffff; /* Default for coded avatars */
            margin-right: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid #00ffff;
            flex-shrink: 0;
            cursor: pointer; /* Make avatar clickable */
        }

        /* Styles for coded avatars - All 50 logos */
        /* These styles will be dynamically generated by JS, example below */
        /* .profile-avatar.user-logo-1 { background-color: #ff6347; } .profile-avatar.user-logo-1::before { content: '🧑'; font-size: 24px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); } */
        /* JS function applies these in a style tag directly to head */
        
        .profile-avatar.user-logo-default::before {
            content: '👤';
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            font-size: 24px;
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            color: #1a1a2e;
        }

        .profile-avatar[style*="background-image"]::before {
            content: none !important; /* Hide default emoji if direct image URL is set */
        }
        

        .profile-avatar.small {
            width: 30px;
            height: 30px;
            border-width: 1px;
        }

        .username {
            font-weight: bold;
            color: #fff;
            flex-grow: 1;
            cursor: pointer; /* Make username clickable */
        }

        .post-options {
            position: relative;
        }

        .post-options .fa-ellipsis-v {
            cursor: pointer;
            font-size: 1.2em;
            color: #888;
        }

        .options-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 5;
            min-width: 120px;
            overflow: hidden;
        }

        .options-dropdown span {
            display: block;
            padding: 10px 15px;
            cursor: pointer;
            color: #e0e0e0;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .options-dropdown span:hover {
            background-color: #0f3460;
            color: #00ffff;
        }

        .post-content {
            margin-bottom: 10px;
        }

        .post-content p {
            margin: 0 0 10px 0;
            white-space: pre-wrap; /* To respect newlines from textarea */
            word-wrap: break-word;
        }

        .post-content img, .post-content iframe {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #0d2a4a;
        }
        
        .post-content iframe {
            aspect-ratio: 16 / 9;
            width: 100%;
        }

        .post-content a {
            color: #00ffff;
            text-decoration: underline;
            word-break: break-all;
        }

        .post-footer {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .post-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .like-button, .views-count, .translate-button, .speak-button {
            cursor: pointer;
            display: flex;
            align-items: center;
            color: #bbb;
            transition: color 0.2s ease;
        }

        .like-button i, .views-count i, .translate-button i, .speak-button i {
            margin-right: 5px;
        }

        .like-button .fas.fa-heart {
            color: #ff007f; /* Red for liked */
            animation: bounceIn 0.3s ease-out;
        }
        .speak-button.active i {
            color: #00ffff; /* Highlight when speaking */
        }


        .post-reactions {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #aaa;
        }

        .emoji-reaction-display {
            display: flex;
            gap: 5px;
            flex-wrap: wrap; /* Allow wrapping if many emojis */
        }

        .emoji-reaction-display .emoji {
            font-size: 1.2em;
            display: flex; /* To align count */
            align-items: center;
        }

        .emoji-reaction-display .count {
            font-size: 0.8em;
            margin-left: 2px;
            color: #e0e0e0;
        }

        .total-reactions {
            margin-left: 10px;
            font-weight: bold;
            color: #00ffff;
        }

        .emoji-picker, .emoji-picker-chat {
            position: absolute;
            bottom: 45px; /* Adjust based on footer position */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.2);
            z-index: 10;
        }

        .emoji-option {
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .emoji-option:hover {
            transform: scale(1.2);
        }

        /* Horizontal Post Layout (for mixed feed) */
        .horizontal-post-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch; /* For smoother scrolling on iOS */
            margin: 10px 0;
            background-color: #0d2a4a;
            border-radius: 10px;
            padding: 15px;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
            border: 1px solid #0f3460;
        }

        .horizontal-post-container .post-card {
            min-width: 250px; /* Fixed width for horizontal items */
            scroll-snap-align: start;
            flex-shrink: 0;
            margin-bottom: 0; /* Override default margin */
        }

        .horizontal-post-container .post-card .post-content img {
            height: 150px; /* Fixed height for horizontal images */
            object-fit: cover;
        }

        /* Table Post Layout */
        .table-post-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
            gap: 15px;
            padding: 15px;
            background-color: #0d2a4a;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
            border: 1px solid #0f3460;
            margin: 10px 0;
        }

        .table-post-container .post-card {
            margin-bottom: 0; /* Override default margin */
            padding: 10px;
        }

        .table-post-container .post-card .post-content img {
            height: 100px; /* Smaller images for table layout */
            object-fit: cover;
        }
        .table-post-container .post-card .post-content p {
            font-size: 0.85em; /* Smaller text for table layout */
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limit text to 3 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        /* Form & Button Styles */
        .form-group {
            margin-bottom: 15px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #e0e0e0;
            text-align: left;
        }
        
        .password-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-input-group input {
            width: 100%;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            cursor: pointer;
            color: var(--text-color-light);
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="file"],
        textarea,
        select,
        input[type="number"],
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #00ffff; /* Neon border */
            border-radius: 6px;
            background-color: #1a1a2e;
            color: #e0e0e0;
            box-sizing: border-box;
            font-size: 1em;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus,
        input[type="number"]:focus,
        input[type="date"]:focus {
            border-color: #ff00ff; /* Pink focus */
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.4);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input[type="file"] {
            padding: 8px; /* Less padding for file input */
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            text-align: center;
            text-decoration: none; /* For link buttons */
            width: 100%;
        }

        .btn.primary-btn {
            background-color: #00ffff;
            color: #1a1a2e;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }

        .btn.primary-btn:hover {
            background-color: #00e0e0;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
        }
        .btn:disabled { /* General styling for disabled buttons */
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }


        .btn.secondary-btn {
            background-color: #334e68;
            color: #e0e0e0;
            border: 1px solid #00ffff;
        }

        .btn.secondary-btn:hover {
            background-color: #4a6684;
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }

        .btn.danger-btn {
            background-color: #e74c3c;
            color: white;
        }

        .btn.danger-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn.social-btn {
            background-color: #2e8b57; /* WhatsApp Green */
            color: white;
            margin-right: 10px;
            width: auto;
        }

        .btn.social-btn i {
            margin-right: 8px;
        }

        .btn.social-btn:hover {
            background-color: #226b41;
        }
        
        .btn.small {
            padding: 6px 12px;
            font-size: 0.9em;
            width: auto;
        }

        .profile-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .profile-actions .btn {
            width: auto;
            flex-grow: 1;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: #1a1a2e;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
            border: 1px solid #00ffff;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: fadeInScale 0.3s ease-out;
            max-height: 90vh; /* Allow scrolling for tall modals */
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #00ffff;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }

        .modal-content .btn {
            margin-top: 15px;
            width: 100%;
        }

        .logo-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #0f3460;
            border-radius: 8px;
            background-color: #0d2a4a;
        }

        .logo-option-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #333; /* Base color for logo previews */
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid transparent;
            transition: border-color 0.2s ease, transform 0.2s ease;
            position: relative;
        }

        .logo-option-item.selected {
            border-color: #00ffff;
            box-shadow: 0 0 10px #00ffff;
        }

        .logo-option-item:hover {
            transform: scale(1.1);
        }

        /* Specific profile avatar styles for edit profile */
        .profile-avatar-large.user-logo-1 { background-color: #ff6347; } .profile-avatar-large.user-logo-1::before { content: '🧑'; font-size: 60px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #1a1a2e; }
        .profile-avatar-large.user-logo-2 { background-color: #6a5acd; } .profile-avatar-large.user-logo-2::before { content: '👩'; font-size: 60px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #1a1a2e; }
        /* Add other 48 logos dynamically or pre-define here if preferred */
        /* ... (rest of 50 logo styles would be here) */
        .profile-avatar.user-logo-default::before { /* Default fallback if dynamic styles fail */
            content: '👤';
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            font-size: 24px;
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            color: #1a1a2e;
        }

        /* Profile Screen Specifics */
        .profile-header-area {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #0f3460;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid #0d2a4a;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #00ffff; /* Default for coded avatars */
            margin: 0 auto 20px auto;
            overflow: hidden;
            position: relative;
            border: 4px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
            background-size: cover;
            background-position: center;
        }
        /* Override default avatar emoji if background image is present */
        .profile-avatar-large[style*="background-image"]::before {
            content: none !important; 
        }
        
        #my-profile-username {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .profile-name, .profile-bio {
            color: #e0e0e0;
            font-size: 0.95em;
            margin-bottom: 5px;
        }
        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            font-size: 1.1em;
        }

        .profile-stats div {
            text-align: center;
            padding: 8px 12px;
            background-color: #1a1a2e;
            border-radius: 8px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
        }

        .profile-stats span {
            display: block;
            font-weight: bold;
            font-size: 1.2em;
            color: #00ffff;
        }

        .clickable-stat {
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .clickable-stat:hover {
            background-color: #0d2a4a;
            transform: translateY(-2px);
        }
        
        .profile-post-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-post-tabs .tab-btn {
            background-color: transparent;
            color: var(--text-color-light);
            border: none;
            border-bottom: 2px solid transparent;
            padding: 10px;
            cursor: pointer;
            transition: color 0.3s, border-color 0.3s;
        }

        .profile-post-tabs .tab-btn.active {
            color: var(--highlight-color-main);
            border-bottom-color: var(--highlight-color-main);
        }

        /* Chat Styles */
        .message-list-container, .chat-window-container {
            background-color: #0f3460;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid #0d2a4a;
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
        }

        .recent-chats-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #1a1a2e;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .chat-item:hover {
            background-color: #1a1a2e;
        }

        .chat-info {
            margin-left: 10px;
            flex-grow: 1;
            overflow: hidden;
        }

        .chat-username {
            font-weight: bold;
            color: #00ffff;
            display: block;
        }

        .last-message {
            font-size: 0.9em;
            color: #bbb;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-window-container {
            height: calc(100vh - 160px);
            padding: 0;
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #0f3460;
            border-bottom: 1px solid #0d2a4a;
            color: white;
        }

        .chat-header .icon-button {
            margin-right: 10px;
        }

        #chat-partner-username {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ffff;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-color: #1a1a2e;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 0.95em;
            line-height: 1.4;
            position: relative;
        }

        .message-bubble.right {
            align-self: flex-end;
            background-color: #00ffff;
            color: #1a1a2e;
            border-bottom-right-radius: 4px;
        }

        .message-bubble.left {
            align-self: flex-start;
            background-color: #334e68;
            color: #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .chat-input-area {
            display: flex;
            padding: 10px 15px;
            border-top: 1px solid #0d2a4a;
            background-color: #0f3460;
        }

        #message-input {
            flex-grow: 1;
            margin-right: 10px;
            min-height: 40px;
            max-height: 100px;
            resize: none;
            align-self: center;
        }

        #send-message-btn {
            padding: 10px 15px;
            font-size: 1.2em;
            width: auto;
        }

        /* Search Screen */
        .search-input-group {
            display: flex;
            margin-bottom: 20px;
        }

        #search-query {
            flex-grow: 1;
            margin-right: 10px;
        }

        .search-results-container h3 {
            margin-top: 25px;
            color: #00ffff;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 5px;
        }

        .search-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #0d2a4a;
            border-radius: 8px;
            border: 1px solid #0f3460;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-user-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #1a1a2e;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-user-item:last-child {
            border-bottom: none;
        }

        .search-user-item:hover {
            background-color: #1a1a2e;
        }

        .search-username {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: bold;
            color: #e0e0e0;
        }

        .search-user-item .follow-btn {
            padding: 5px 10px;
            font-size: 0.9em;
        }

        /* NEW: Monetization Screen Styles */
        #monetization-screen .info-card {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #0d2a4a;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.08);
        }
        #monetization-screen .info-card h4 {
            color: #00ffff;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        #monetization-screen .info-card i {
            margin-right: 8px;
            color: #ff00ff;
        }
        #monetization-screen .info-card .btn {
            margin-top: 10px;
            width: auto;
            display: inline-block;
            margin-right: 10px;
        }


        /* Bottom Navigation */
        .app-bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #0f3460;
            border-top: 1px solid #0d2a4a;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            position: sticky;
            bottom: 0;
            width: 100%;
            z-index: 10;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #888;
            font-size: 0.8em;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .nav-item .icon-wrapper {
            font-size: 1.5em;
            margin-bottom: 5px;
            position: relative;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-item.active {
            color: #00ffff;
            transform: translateY(-3px);
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 80px; /* Above bottom nav */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            font-size: 0.95em;
            min-width: 200px;
            text-align: center;
        }

        .toast-notification.show {
            opacity: 1;
            visibility: visible;
        }
        .toast-notification.error { background-color: #e74c3c; }
        .toast-notification.success { background-color: #27ae60; }
        .toast-notification.info { background-color: #3498db; }

        #username-availability {
            font-size: 0.85em;
            margin-top: 5px;
            text-align: left;
        }
        #username-availability.error-text {
            color: #e74c3c;
        }
        #username-availability.success-text {
            color: #33ff57;
        }


        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.6), 0 0 20px rgba(255, 0, 255, 0.4); }
            100% { transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(255, 0, 255, 0.6); }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .app-container, .auth-container {
                border-radius: 0;
                box-shadow: none;
                max-width: 100%;
                height: 100vh; /* Ensure it takes full height on small screens */
            }

            body {
                align-items: flex-start; /* Align to top on small screens */
            }
        }
    </style>
</head>
<body class="dark-mode"> 
    
    <!-- This paragraph is for JavaScript load testing. It should be the ONLY thing initially visible IF JS loads. -->
    <div id="load-status">Loading Application...</div>

    <!-- Auth Container for Login/Register (Hidden by default, JS will manage display) -->
    <div id="auth-container" class="auth-container hidden">
        <div class="auth-content">
            <div class="app-logo-splash auth-logo"></div> <h1>AddMint</h1>
            <section id="login-screen" class="auth-screen active">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="login-password" placeholder="Enter your password">
                        <span class="password-toggle" data-target="login-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <button class="btn primary-btn" id="login-btn">Login</button>
                <p class="auth-text">
                    <a href="#" id="forgot-password-link">Forgot Password?</a>
                </p>
                <p class="auth-text">Don't have an account? <a href="#" id="show-signup">Register</a></p>
                <p id="login-status" class="status-message"></p>
            </section>

            <section id="signup-screen" class="auth-screen">
                <h2>Register</h2>
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <input type="email" id="signup-email" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="signup-password" placeholder="Create a password (min. 6 chars)">
                        <span class="password-toggle" data-target="signup-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="signup-confirm-password" placeholder="Confirm your password">
                        <span class="password-toggle" data-target="signup-confirm-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <button class="btn primary-btn" id="signup-btn">Register</button>
                <p class="auth-text">Already have an account? <a href="#" id="show-login">Login</a></p>
                <p id="signup-status" class="status-message"></p>
            </section>
        </div>
    </div>

    <div id="forgot-password-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Reset Password</h3>
            <p>Enter your email address to receive a password reset link.</p>
            <div class="form-group">
                <label for="reset-email">Email:</label>
                <input type="email" id="reset-email" placeholder="Your email address">
            </div>
            <button class="btn primary-btn" id="send-reset-email-btn">Send Reset Link</button>
            <p id="reset-status" class="status-message"></p>
            <button class="btn secondary-btn" id="close-reset-modal">Cancel</button>
        </div>
    </div>


    <!-- Main Application Container (Hidden by default, JS will manage display) -->
    <div id="app-container" class="app-container hidden">

        <header class="app-header">
            <div class="header-left">
                <div class="menu-icon" id="menu-toggle">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
                <div class="app-title">AddMint</div>
            </div>
            <div class="header-right">
                <div class="icon-button" id="refresh-posts-btn" title="Refresh Feed">
                    <i class="fas fa-sync-alt"></i>
                </div>
            </div>
        </header>

        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="profile-avatar-small" id="sidebar-profile-avatar"></div>
                <h3 id="sidebar-username">My User</h3> 
                <div class="close-sidebar" id="close-sidebar">&times;</div>
            </div>
            <ul>
                <li><a href="#" data-screen="home"><i class="fas fa-home"></i> Home Feed</a></li>
                <li><a href="#" data-screen="profile"><i class="fas fa-user-circle"></i> My Profile</a></li>
                <li><a href="#" data-screen="upload"><i class="fas fa-plus-circle"></i> Upload Post</a></li>
                <li><a href="#" data-screen="messages"><i class="fas fa-comments"></i> Messages</a></li>
                <li><a href="#" data-screen="search"><i class="fas fa-search"></i> Search Users</a></li>
                <li><a href="#" id="dark-mode-toggle"><i class="fas fa-moon"></i> Dark Mode <span class="toggle-switch"><input type="checkbox" id="dark-mode-checkbox" checked><label for="dark-mode-checkbox"></label></span></a></li>
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <section id="home-screen" class="app-screen active">
                <h2>Recent Posts</h2>
                 <div class="category-filter">
                    <select id="post-category-filter">
                        <option value="all">All Categories</option>
                        <option value="General">General</option>
                        <option value="Technology">Technology</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Sports">Sports</option>
                        <option value="News">News</option>
                    </select>
                </div>
                <div id="posts-feed" class="posts-feed">
                    <!-- Posts will be loaded here by JavaScript -->
                </div>
                <div id="loading-spinner" class="loader hidden"></div>
            </section>

            <section id="profile-screen" class="app-screen">
                <div id="user-profile-display">
                    <div class="profile-header-area">
                        <div class="profile-avatar-large" id="my-profile-avatar"></div>
                        <h2 id="my-profile-username">@myusername</h2>
                        <p id="my-profile-name" class="profile-name"></p>
                        <p id="my-profile-bio" class="profile-bio"></p>
                        <div class="profile-stats">
                            <div><span id="my-posts-count">0</span> Posts</div>
                            <div class="clickable-stat" data-stat="followers"><span id="my-followers-count">0</span> Followers</div>
                            <div class="clickable-stat" data-stat="following"><span id="my-following-count">0</span> Following</div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn primary-btn" id="edit-profile-btn"><i class="fas fa-edit"></i> Edit Profile</button>
                            <button class="btn secondary-btn hidden" id="follow-user-btn"><i class="fas fa-user-plus"></i> Follow</button>
                            <button class="btn danger-btn hidden" id="unfollow-user-btn"><i class="fas fa-user-minus"></i> Unfollow</button>
                            <button class="btn primary-btn hidden" id="message-user-btn"><i class="fas fa-paper-plane"></i> Message</button>
                        </div>
                    </div>

                    <div id="edit-profile-modal" class="modal hidden">
                        <div class="modal-content">
                            <h3>Edit Profile</h3>
                            <p id="profile-modal-instruction" class="status-message info"></p>
                            <div class="form-group">
                                <label for="edit-username">Username:</label>
                                <input type="text" id="edit-username" placeholder="Enter new username (3-30 chars)">
                                <span id="username-availability"></span>
                            </div>
                            <div class="form-group">
                                <label for="edit-name">Display Name:</label>
                                <input type="text" id="edit-name" placeholder="Enter your display name">
                            </div>
                            <div class="form-group">
                                <label for="edit-bio">Bio (Optional):</label>
                                <textarea id="edit-bio" placeholder="Tell us about yourself..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="profile-pic-url-input">Direct Profile Picture URL (Optional):</label>
                                <input type="text" id="profile-pic-url-input" placeholder="e.g., https://example.com/mypic.jpg">
                                <small>Enter a direct image link. This will override the logo selection.</small>
                            </div>
                            <div class="form-group">
                                <label>Or Choose a Profile Logo:</label>
                                <div id="profile-logo-options" class="logo-options-grid">
                                    <!-- Logo options will be populated by JS -->
                                </div>
                            </div>
                            <p id="save-profile-status" class="status-message"></p>
                            <button class="btn primary-btn" id="save-profile-btn">Save Changes</button>
                            <button class="btn secondary-btn" id="cancel-edit-profile-btn">Cancel</button>
                        </div>
                    </div>

                    <div id="follow-list-modal" class="modal hidden">
                        <div class="modal-content">
                            <h3 id="follow-list-title"></h3>
                            <div id="follow-list-content">
                                <!-- Follow list will be populated by JS -->
                            </div>
                            <button class="btn secondary-btn" id="close-follow-list-modal">Close</button>
                        </div>
                    </div>

                    <div class="profile-posts-area">
                        <h3>Posts by <span id="current-profile-username-posts">Me</span></h3>
                        <div class="profile-post-tabs">
                            <button class="tab-btn active" data-tab="posts">My Posts</button>
                        </div>
                        <div id="profile-posts-feed" class="posts-feed">
                            <!-- User's posts will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <section id="upload-screen" class="app-screen">
                <h2>Upload New Post</h2>
                <div class="form-group">
                    <label for="post-content">Post Content:</label>
                    <textarea id="post-content" placeholder="What's on your mind?"></textarea>
                    <small>Min 10 characters.</small>
                </div>
                <button class="btn primary-btn" id="publish-post-btn">Publish Post</button>
                <p id="upload-status" class="status-message"></p>
            </section>

            <section id="messages-screen" class="app-screen">
                <h2>Messages</h2>
                <div id="message-list-container">
                    <h3>Recent Chats</h3>
                    <ul id="recent-chats-list" class="recent-chats-list">
                        <!-- Recent chats will be loaded here -->
                    </ul>
                </div>
                <div id="chat-window-container" class="chat-window-container hidden">
                    <div class="chat-header">
                        <button id="back-to-chats-btn" class="icon-button"><i class="fas fa-arrow-left"></i></button>
                        <div class="profile-avatar small" id="chat-partner-avatar"></div>
                        <span id="chat-partner-username">@ChatUser</span>
                    </div>
                    <div id="chat-messages" class="chat-messages">
                        <!-- Chat messages will be loaded here -->
                    </div>
                    <div class="chat-input-area">
                        <textarea id="message-input" placeholder="Type your message..."></textarea>
                        <button id="send-message-btn" class="btn primary-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </section>

            <section id="search-screen" class="app-screen">
                <h2>Search Users</h2>
                <div class="search-input-group">
                    <input type="text" id="search-query" placeholder="Search by username...">
                    <button class="btn primary-btn" id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div id="search-results" class="search-results-container">
                    <ul id="search-user-list" class="search-list">
                        <!-- Search results will be loaded here -->
                    </ul>
                    <p id="no-search-results" class="hidden">No results found.</p>
                </div>
            </section>
        </main>

        <footer class="app-bottom-nav">
            <a href="#" class="nav-item active" data-screen="home">
                <div class="icon-wrapper"><i class="fas fa-home"></i></div>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-screen="search">
                <div class="icon-wrapper"><i class="fas fa-search"></i></div>
                <span>Search</span>
            </a>
            <a href="#" class="nav-item" data-screen="upload">
                <div class="icon-wrapper"><i class="fas fa-plus-square"></i></div>
                <span>Upload</span>
            </a>
            <a href="#" class="nav-item" data-screen="messages">
                <div class="icon-wrapper"><i class="fas fa-comments"></i></div>
                <span>Messages</span>
            </a>
            <a href="#" class="nav-item" data-screen="profile">
                <div class="icon-wrapper"><i class="fas fa-user"></i></div>
                <span>Profile</span>
            </a>
        </footer>

        <div id="toast-notification" class="toast-notification"></div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
        // --- START OF JAVASCRIPT ---

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDlZA4grzF3fx95-11E4s7ASXwkIij1k1w",
            authDomain: "addmint-7ab6b.firebaseapp.com",
            databaseURL: "https://addmint-7ab6b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "addmint-7ab6b",
            storageBucket: "addmint-7ab6b.appspot.com", // Corrected storage bucket
            messagingSenderId: "504015450137",
            appId: "1:504015450137:web:694b176313582cce1e7a88",
        };

        // Initialize Firebase
        let app, auth, db;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            document.getElementById('load-status').textContent = "Critical Error: App could not start.";
            document.getElementById('load-status').style.display = 'block';
        }
        
        // --- DOM Elements ---
        const loadStatusElement = document.getElementById('load-status');
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');

        // Auth Screens
        const loginScreen = document.getElementById('login-screen');
        const signupScreen = document.getElementById('signup-screen');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const loginStatus = document.getElementById('login-status');
        const showSignupLink = document.getElementById('show-signup');
        const signupEmailInput = document.getElementById('signup-email');
        const signupPasswordInput = document.getElementById('signup-password');
        const signupConfirmPasswordInput = document.getElementById('signup-confirm-password');
        const signupBtn = document.getElementById('signup-btn');
        const signupStatus = document.getElementById('signup-status');
        const showLoginLink = document.getElementById('show-login');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const resetEmailInput = document.getElementById('reset-email');
        const sendResetEmailBtn = document.getElementById('send-reset-email-btn');
        const resetStatus = document.getElementById('reset-status');
        const closeResetModalBtn = document.getElementById('close-reset-modal');
        const passwordToggles = document.querySelectorAll('.password-toggle');

        // Main App
        const sidebar = document.getElementById('sidebar');
        const sidebarUsername = document.getElementById('sidebar-username');
        const sidebarProfileAvatar = document.getElementById('sidebar-profile-avatar');
        const menuToggle = document.getElementById('menu-toggle');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const bottomNavItems = document.querySelectorAll('.app-bottom-nav .nav-item');
        const screenSections = document.querySelectorAll('.app-screen');
        const toastNotification = document.getElementById('toast-notification');
        const logoutBtn = document.getElementById('logout-btn');
        const darkModeCheckbox = document.getElementById('dark-mode-checkbox');

        // Profile Screen
        const myProfileAvatar = document.getElementById('my-profile-avatar');
        const myProfileUsername = document.getElementById('my-profile-username');
        const myProfileName = document.getElementById('my-profile-name');
        const myProfileBio = document.getElementById('my-profile-bio');
        const myPostsCount = document.getElementById('my-posts-count');
        const myFollowersCount = document.getElementById('my-followers-count');
        const myFollowingCount = document.getElementById('my-following-count');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const followUserBtn = document.getElementById('follow-user-btn');
        const unfollowUserBtn = document.getElementById('unfollow-user-btn');
        const messageUserBtn = document.getElementById('message-user-btn');
        const currentProfileUsernamePosts = document.getElementById('current-profile-username-posts');
        const profilePostsFeed = document.getElementById('profile-posts-feed');
        
        // Edit Profile Modal
        const editProfileModal = document.getElementById('edit-profile-modal');
        const profileModalInstruction = document.getElementById('profile-modal-instruction');
        const saveProfileStatus = document.getElementById('save-profile-status');
        const editUsernameInput = document.getElementById('edit-username');
        const usernameAvailability = document.getElementById('username-availability');
        const editNameInput = document.getElementById('edit-name');
        const editBioInput = document.getElementById('edit-bio');
        const profilePicUrlInput = document.getElementById('profile-pic-url-input');
        const profileLogoOptions = document.getElementById('profile-logo-options');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const cancelEditProfileBtn = document.getElementById('cancel-edit-profile-btn');
        
        // Upload Screen
        const publishPostBtn = document.getElementById('publish-post-btn');
        const postContentInput = document.getElementById('post-content');
        const uploadStatus = document.getElementById('upload-status');
        
        // Home Screen
        const postsFeed = document.getElementById('posts-feed');
        const loadingSpinner = document.getElementById('loading-spinner');
        const refreshPostsBtn = document.getElementById('refresh-posts-btn');
        
        // --- Global State ---
        let currentUser = null;
        let hasRunInitialAuthCheck = false;
        let isProfileSetupMandatory = false; // Flag to track if user is in mandatory setup
        let currentProfileViewingId = null;

        // --- Profile Logos Data ---
        const PROFILE_LOGOS = [
            { class: 'logo-1', emoji: '🧑', color: '#ff6347' }, { class: 'logo-2', emoji: '👩', color: '#6a5acd' }, { class: 'logo-3', emoji: '🚀', color: '#32cd32' },
            { class: 'logo-4', emoji: '💡', color: '#ff8c00' }, { class: 'logo-5', emoji: '🌟', color: '#ffd700' }, { class: 'logo-6', emoji: '🌈', color: '#9932cc' },
            { class: 'logo-7', emoji: '🦊', color: '#d2691e' }, { class: 'logo-8', emoji: '🐼', color: '#6495ed' }, { class: 'logo-9', emoji: '🦋', color: '#dda0dd' },
            { class: 'logo-10', emoji: '🐢', color: '#20b2aa' }
        ];

        // --- Utility Functions ---
        function showToast(message, type = 'info', duration = 3000) {
            toastNotification.textContent = message;
            toastNotification.className = `toast-notification show ${type}`;
            setTimeout(() => {
                toastNotification.className = 'toast-notification';
            }, duration);
        }
        
        function updateAuthStatus(element, message, type) {
            if (element) {
                element.textContent = message;
                element.className = `status-message ${type}`;
                element.style.display = (message === '') ? 'none' : 'block';
            }
        }

        function showScreen(screenId) {
            screenSections.forEach(screen => screen.classList.remove('active'));
            const activeScreen = document.getElementById(screenId);
            if (activeScreen) activeScreen.classList.add('active');
            
            bottomNavItems.forEach(item => {
                item.classList.toggle('active', item.dataset.screen === screenId.replace('-screen', ''));
            });
            sidebar.classList.remove('open');
        }

        function getLogoCssClass(logoName) {
            return logoName ? `user-${logoName}` : 'user-logo-default';
        }

        function applyLogoStyles() {
            const styleId = 'profile-logo-styles';
            if (document.getElementById(styleId)) return; // Avoid re-adding styles
            
            const style = document.createElement('style');
            style.id = styleId;
            let cssRules = '';
            PROFILE_LOGOS.forEach(logo => {
                cssRules += `
                    .profile-avatar.user-${logo.class}, 
                    .profile-avatar-large.user-${logo.class}, 
                    .profile-avatar-small.user-${logo.class}, 
                    .logo-option-item.user-${logo.class} { 
                        background-color: ${logo.color}; 
                    }
                    .user-${logo.class}::before { 
                        content: '${logo.emoji}'; 
                        font-family: 'Arial', sans-serif;
                        font-size: 150%;
                        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                        color: #1a1a2e;
                    }
                `;
            });
            style.innerHTML = cssRules;
            document.head.appendChild(style);
        }

        // --- Core Auth Flow ---
        function showAuthContainerUI() {
            appContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            loginScreen.classList.add('active');
            signupScreen.classList.remove('active');
        }

        function showAppContainerUI() {
            authContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
        }
        
        async function handleUserLogout() {
            try {
                await auth.signOut();
                console.log("User logged out.");
                // onAuthStateChanged will handle the UI transition
            } catch (error) {
                console.error("Error signing out:", error);
                showToast("Error signing out.", "error");
            }
        }

        auth.onAuthStateChanged(async (user) => {
            if (hasRunInitialAuthCheck && user === currentUser) {
                return; // Avoid re-running on redundant events
            }
            hasRunInitialAuthCheck = true;
            loadStatusElement.style.display = 'none';

            if (user && user.emailVerified) {
                currentUser = user;
                const userDocRef = db.collection('users').doc(user.uid);
                const userDoc = await userDocRef.get();

                if (!userDoc.exists() || !userDoc.data().username || !userDoc.data().name) {
                    isProfileSetupMandatory = true;
                    showAppContainerUI();
                    showScreen('profile-screen');
                    updateProfileDisplay(userDoc.data() || { uid: user.uid, email: user.email }); // Pass what we have
                    editProfileModal.classList.remove('hidden');
                    profileModalInstruction.textContent = "Welcome! Please complete your profile to continue.";
                    showToast("Please complete your profile.", 'info', 5000);
                } else {
                    isProfileSetupMandatory = false;
                    await loadAndDisplayInitialData(userDoc.data());
                }
            } else {
                currentUser = null;
                isProfileSetupMandatory = false;
                showAuthContainerUI();
                if (user && !user.emailVerified) {
                    updateAuthStatus(loginStatus, "Please verify your email. Check your inbox for the verification link.", 'info');
                    handleUserLogout(); // Log out to force re-login after verification
                }
            }
        });
        
        async function loadAndDisplayInitialData(userData) {
            updateSidebar(userData);
            showAppContainerUI();
            showScreen('home-screen');
            loadPosts();
        }
        
        function updateSidebar(userData) {
            if (userData) {
                sidebarUsername.textContent = userData.name || "New User";
                 if (userData.profilePicUrl) {
                    sidebarProfileAvatar.style.backgroundImage = `url('${userData.profilePicUrl}')`;
                    sidebarProfileAvatar.className = 'profile-avatar-small';
                } else {
                    sidebarProfileAvatar.style.backgroundImage = 'none';
                    sidebarProfileAvatar.className = `profile-avatar-small ${getLogoCssClass(userData.profileLogo)}`;
                }
            }
        }

        // --- AUTH ACTIONS ---
        loginBtn.addEventListener('click', async () => {
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();
            if (!email || !password) return updateAuthStatus(loginStatus, "All fields are required.", 'error');

            updateAuthStatus(loginStatus, "Logging in...", 'info');
            try {
                await auth.signInWithEmailAndPassword(email, password);
                // onAuthStateChanged will handle the rest
                updateAuthStatus(loginStatus, "", '');
            } catch (error) {
                updateAuthStatus(loginStatus, error.message, 'error');
            }
        });

        signupBtn.addEventListener('click', async () => {
            const email = signupEmailInput.value.trim();
            const password = signupPasswordInput.value.trim();
            const confirmPassword = signupConfirmPasswordInput.value.trim();

            if (!email || !password || !confirmPassword) return updateAuthStatus(signupStatus, "All fields are required.", 'error');
            if (password !== confirmPassword) return updateAuthStatus(signupStatus, "Passwords do not match.", 'error');
            if (password.length < 6) return updateAuthStatus(signupStatus, "Password must be at least 6 characters.", 'error');

            updateAuthStatus(signupStatus, "Registering...", 'info');
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.sendEmailVerification();
                
                // Create user document in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    uid: userCredential.user.uid,
                    email: email,
                    username: "", // To be set by user
                    name: "", // To be set by user
                    username_lowercase: "",
                    bio: "",
                    profileLogo: PROFILE_LOGOS[0].class, // Default logo
                    profilePicUrl: "",
                    postCount: 0,
                    followers: [],
                    following: [],
                    followersCount: 0,
                    followingCount: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showLoginLink.click(); // Switch to login screen
                updateAuthStatus(loginStatus, "Registration successful! Please check your email to verify your account, then log in.", 'success');

            } catch (error) {
                updateAuthStatus(signupStatus, error.message, 'error');
            }
        });
        
        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const targetId = toggle.dataset.target;
                const targetInput = document.getElementById(targetId);
                const icon = toggle.querySelector('i');
                if (targetInput.type === 'password') {
                    targetInput.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    targetInput.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
        });

        showSignupLink.addEventListener('click', (e) => { e.preventDefault(); loginScreen.classList.remove('active'); signupScreen.classList.add('active'); });
        showLoginLink.addEventListener('click', (e) => { e.preventDefault(); signupScreen.classList.remove('active'); loginScreen.classList.add('active'); });
        logoutBtn.addEventListener('click', handleUserLogout);
        
        // --- Profile Management ---
        editProfileBtn.addEventListener('click', () => {
            isProfileSetupMandatory = false; // It's a normal edit, not mandatory
            editProfileModal.classList.remove('hidden');
            profileModalInstruction.textContent = "Update your profile information.";
        });
        
        cancelEditProfileBtn.addEventListener('click', () => {
            if (isProfileSetupMandatory) {
                // If setup is mandatory, "Cancel" should log the user out
                // to prevent them from being stuck in an unusable app state.
                showToast("Profile setup is required. Logging out.", "info");
                handleUserLogout();
            } else {
                // If it's just a normal edit, simply close the modal.
                editProfileModal.classList.add('hidden');
            }
        });
        
        saveProfileBtn.addEventListener('click', async () => {
            if (!currentUser) return showToast("Not logged in", "error");
            
            const newUsername = editUsernameInput.value.trim();
            const newName = editNameInput.value.trim();
            const newBio = editBioInput.value.trim();
            const newProfilePicUrl = profilePicUrlInput.value.trim();
            const selectedLogoElement = profileLogoOptions.querySelector('.logo-option-item.selected');
            
            if (!newUsername || !newName) {
                return updateAuthStatus(saveProfileStatus, "Username and Display Name are required.", 'error');
            }
            if (newUsername.length < 3) {
                 return updateAuthStatus(saveProfileStatus, "Username must be at least 3 characters.", 'error');
            }

            // Check username availability
            const usersRef = db.collection('users');
            const snapshot = await usersRef.where('username_lowercase', '==', newUsername.toLowerCase()).get();
            let isTaken = false;
            snapshot.forEach(doc => {
                if(doc.id !== currentUser.uid) {
                    isTaken = true;
                }
            });

            if (isTaken) {
                return updateAuthStatus(saveProfileStatus, "Username is already taken.", 'error');
            }

            let newProfileLogo = '';
            if (!newProfilePicUrl && selectedLogoElement) {
                newProfileLogo = selectedLogoElement.dataset.value;
            } else if (!newProfilePicUrl) {
                // Keep old logo if nothing new is selected and no URL is provided
                 const userDoc = await db.collection('users').doc(currentUser.uid).get();
                 newProfileLogo = userDoc.data().profileLogo || PROFILE_LOGOS[0].class;
            }

            const profileData = {
                username: newUsername,
                username_lowercase: newUsername.toLowerCase(),
                name: newName,
                bio: newBio,
                profilePicUrl: newProfilePicUrl,
                profileLogo: newProfilePicUrl ? "" : newProfileLogo, // Clear logo if URL is used
            };
            
            updateAuthStatus(saveProfileStatus, "Saving...", 'info');
            try {
                const userDocRef = db.collection('users').doc(currentUser.uid);
                await userDocRef.update(profileData);

                // Batch update posts with new username and picture
                const postBatch = db.batch();
                const postsSnapshot = await db.collection('posts').where('userId', '==', currentUser.uid).get();
                postsSnapshot.forEach(doc => {
                    const postRef = db.collection('posts').doc(doc.id);
                    postBatch.update(postRef, {
                        username: newUsername,
                        userProfileLogo: profileData.profileLogo,
                        profilePicUrl: profileData.profilePicUrl
                    });
                });
                await postBatch.commit();
                
                updateAuthStatus(saveProfileStatus, "Profile saved successfully!", 'success');
                showToast("Profile updated!", "success");
                editProfileModal.classList.add('hidden');
                
                // Reload data to reflect changes everywhere
                const updatedUserDoc = await userDocRef.get();
                await loadAndDisplayInitialData(updatedUserDoc.data());
                loadUserProfile(currentUser.uid); // Refresh profile screen view
                
            } catch (error) {
                console.error("Error saving profile: ", error);
                updateAuthStatus(saveProfileStatus, `Error: ${error.message}`, 'error');
            }
        });
        
        async function loadUserProfile(userId) {
            currentProfileViewingId = userId;
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    updateProfileDisplay(userDoc.data());
                    loadProfilePosts(userId);
                } else {
                    showToast("User not found.", "error");
                }
            } catch (error) {
                console.error("Error loading profile:", error);
            }
        }
        
        function updateProfileDisplay(userData) {
            if (!userData) return;

            myProfileUsername.textContent = `@${userData.username || 'N/A'}`;
            myProfileName.textContent = userData.name || '';
            myProfileBio.textContent = userData.bio || '';
            myPostsCount.textContent = userData.postCount || 0;
            myFollowersCount.textContent = userData.followersCount || 0;
            myFollowingCount.textContent = userData.followingCount || 0;
            currentProfileUsernamePosts.textContent = userData.username || 'User';

            if (userData.profilePicUrl) {
                myProfileAvatar.style.backgroundImage = `url('${userData.profilePicUrl}')`;
                myProfileAvatar.className = 'profile-avatar-large';
            } else {
                myProfileAvatar.style.backgroundImage = 'none';
                myProfileAvatar.className = `profile-avatar-large ${getLogoCssClass(userData.profileLogo)}`;
            }
            
            // Populate modal fields if it's my profile
            if(currentUser && userData.uid === currentUser.uid) {
                editUsernameInput.value = userData.username || '';
                editNameInput.value = userData.name || '';
                editBioInput.value = userData.bio || '';
                profilePicUrlInput.value = userData.profilePicUrl || '';
                populateProfileLogoOptions(userData.profileLogo, userData.profilePicUrl);
            }

            // Show/hide follow/edit buttons
            if (currentUser && currentUser.uid === userData.uid) {
                editProfileBtn.classList.remove('hidden');
                followUserBtn.classList.add('hidden');
                unfollowUserBtn.classList.add('hidden');
            } else if (currentUser) {
                editProfileBtn.classList.add('hidden');
                // Logic to check if already following and show correct button would go here
            }
        }

        function populateProfileLogoOptions(currentLogoClass, currentProfilePicUrl) {
            profileLogoOptions.innerHTML = '';
            PROFILE_LOGOS.forEach(logo => {
                const logoItem = document.createElement('div');
                logoItem.className = `logo-option-item user-${logo.class}`;
                logoItem.dataset.value = logo.class;
                
                // A logo is selected if it's the current one AND no pic URL is being used
                if (!currentProfilePicUrl && currentLogoClass === logo.class) {
                    logoItem.classList.add('selected');
                }

                logoItem.addEventListener('click', () => {
                    profileLogoOptions.querySelectorAll('.logo-option-item').forEach(item => item.classList.remove('selected'));
                    logoItem.classList.add('selected');
                    profilePicUrlInput.value = ''; // Clear URL if a logo is chosen
                });
                profileLogoOptions.appendChild(logoItem);
            });
            
             profilePicUrlInput.addEventListener('input', () => {
                if (profilePicUrlInput.value.trim() !== '') {
                    profileLogoOptions.querySelectorAll('.logo-option-item').forEach(item => item.classList.remove('selected'));
                }
            });
        }
        
        async function loadProfilePosts(userId) {
            profilePostsFeed.innerHTML = '<div class="loader"></div>';
            try {
                const snapshot = await db.collection('posts')
                                         .where('userId', '==', userId)
                                         .orderBy('timestamp', 'desc')
                                         .limit(20)
                                         .get();
                profilePostsFeed.innerHTML = '';
                if (snapshot.empty) {
                    profilePostsFeed.innerHTML = '<p>No posts yet.</p>';
                } else {
                    snapshot.forEach(doc => renderPost(doc.id, doc.data(), profilePostsFeed));
                }
            } catch (error) {
                console.error("Error fetching profile posts:", error);
                profilePostsFeed.innerHTML = '<p>Could not load posts.</p>';
            }
        }

        // --- Post Functionality ---
        publishPostBtn.addEventListener('click', async () => {
            if (!currentUser) return showToast("You must be logged in to post.", "error");

            const content = postContentInput.value.trim();
            if (content.length < 10) {
                return updateAuthStatus(uploadStatus, "Post must be at least 10 characters.", "error");
            }

            try {
                updateAuthStatus(uploadStatus, "Publishing...", "info");
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                await db.collection('posts').add({
                    userId: currentUser.uid,
                    username: userData.username,
                    userProfileLogo: userData.profileLogo,
                    profilePicUrl: userData.profilePicUrl,
                    content: content,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    likes: 0,
                    views: 0,
                });

                // Increment user's post count
                await db.collection('users').doc(currentUser.uid).update({
                    postCount: firebase.firestore.FieldValue.increment(1)
                });

                updateAuthStatus(uploadStatus, "Post published successfully!", "success");
                postContentInput.value = '';
                showScreen('home-screen');
                loadPosts(); // Refresh home feed

            } catch (error) {
                console.error("Error publishing post:", error);
                updateAuthStatus(uploadStatus, `Error: ${error.message}`, "error");
            }
        });

        async function loadPosts() {
            loadingSpinner.classList.remove('hidden');
            postsFeed.innerHTML = '';
            try {
                const snapshot = await db.collection('posts')
                                         .orderBy('timestamp', 'desc')
                                         .limit(30)
                                         .get();
                if (snapshot.empty) {
                    postsFeed.innerHTML = '<p>No posts found. Be the first to post!</p>';
                } else {
                    snapshot.forEach(doc => {
                        renderPost(doc.id, doc.data(), postsFeed);
                    });
                }
            } catch (error) {
                console.error("Error fetching posts:", error);
                postsFeed.innerHTML = '<p>Error loading posts. Please try again.</p>';
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }
        
        function renderPost(postId, postData, container) {
            const postCard = document.createElement('div');
            postCard.className = 'post-card';
            postCard.dataset.postId = postId;

            let avatarHtml;
            if (postData.profilePicUrl) {
                avatarHtml = `<div class="profile-avatar" style="background-image: url('${postData.profilePicUrl}');"></div>`;
            } else {
                avatarHtml = `<div class="profile-avatar ${getLogoCssClass(postData.userProfileLogo)}"></div>`;
            }

            postCard.innerHTML = `
                <div class="post-header">
                    ${avatarHtml}
                    <span class="username">@${postData.username || 'unknown'}</span>
                </div>
                <div class="post-content">
                    <p>${postData.content}</p>
                </div>
                <div class="post-footer">
                    <span class="like-button"><i class="far fa-heart"></i> ${postData.likes || 0}</span>
                    <span class="views-count"><i class="fas fa-eye"></i> ${postData.views || 0}</span>
                </div>
            `;
            container.appendChild(postCard);
        }

        // --- Navigation ---
        menuToggle.addEventListener('click', () => sidebar.classList.add('open'));
        closeSidebarBtn.addEventListener('click', () => sidebar.classList.remove('open'));
        
        sidebar.querySelectorAll('ul li a').forEach(link => {
            link.addEventListener('click', (e) => {
                const screen = e.currentTarget.dataset.screen;
                if(screen) {
                    e.preventDefault();
                    showScreen(`${screen}-screen`);
                    if (screen === 'profile') loadUserProfile(currentUser.uid);
                    if (screen === 'home') loadPosts();
                }
            });
        });

        refreshPostsBtn.addEventListener('click', loadPosts);

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM content fully loaded. Initializing...");
            applyLogoStyles();
            
            // Set initial theme
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.replace('dark-mode', 'light-mode');
                darkModeCheckbox.checked = false;
            }
            
            // Show loading status until Firebase auth check completes
            loadStatusElement.style.display = 'block';
        });
        
        darkModeCheckbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                document.body.classList.replace('light-mode', 'dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.replace('dark-mode', 'light-mode');
                localStorage.setItem('theme', 'light');
            }
        });
        
        // --- END OF JAVASCRIPT ---
    </script>
</body>
    </html>
