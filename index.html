<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AddMint Pro</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23007bff' d='M50 0L100 50L50 100L0 50Z'/%3E%3Cpath fill='%23e0e0e0' d='M50 10L90 50L50 90L10 50Z'/%3E%3C/svg%3E">
    
    <style>
        /* Global Styles & Variables */
        :root {
            --dark-bg: #121212; /* Deeper dark background */
            --dark-fg: #1e1e1e; /* Slightly lighter for foreground elements */
            --text-color: #e0e0e0;
            --primary-color: #007bff; /* Bright Blue */
            --primary-dark: #0056b3; /* Darker Blue */
            --accent-color: #ffc107; /* Bright Yellow/Amber */
            --accent-dark: #cc9a00; /* Darker Yellow */
            --border-color: #333;
            --shadow-color: rgba(0, 0, 0, 0.7);
            --success-color: #28a745;
            --error-color: #dc3545;
            --info-color: #17a2b8;
            --transition-speed: 0.3s ease;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Roboto', sans-serif; /* Professional font stack */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 16px; /* Base font size */
            -webkit-font-smoothing: antialiased; /* Better text rendering */
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed);
        }

        a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        button, input[type="submit"] {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color var(--transition-speed), transform 0.15s ease, box-shadow var(--transition-speed);
            box-shadow: 0 4px 10px var(--shadow-color);
            letter-spacing: 0.5px;
        }

        button:hover, input[type="submit"]:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.8);
        }

        button:active, input[type="submit"]:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        input[type="email"],
        input[type="password"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--dark-bg); /* Match body background for deeper immersion */
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4); /* Inner shadow for depth */
        }

        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="text"]:focus,
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25), inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .container {
            width: 90%;
            max-width: 480px; /* Slightly wider for modern feel */
            margin: auto;
            padding: 30px;
            background-color: var(--dark-fg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 25px var(--shadow-color);
            animation: fadeIn 0.6s ease-out;
            border: 1px solid var(--border-color); /* Subtle border */
        }

        .message {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            word-wrap: break-word;
            border: 1px solid transparent; /* Default transparent border */
            animation: fadeIn 0.4s ease-out;
        }

        .message.success {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .message.error {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--error-color);
            border-color: var(--error-color);
        }
        .message.info {
            background-color: rgba(23, 162, 184, 0.2);
            color: var(--info-color);
            border-color: var(--info-color);
        }

        .hidden {
            display: none !important;
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg), #0f0f0f);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1.2s ease-out; /* Longer fade out */
            opacity: 1;
        }

        .splash-logo-container {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .splash-logo-diamond {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 123, 255, 0.7);
            animation: splashDiamondPulse 2s infinite alternate ease-in-out;
        }

        .splash-logo-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: 800; /* Ultra bold */
            color: white;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 25px rgba(255, 255, 255, 0.4);
            z-index: 1;
            letter-spacing: 2px;
        }

        .splash-loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite, glow 1.5s infinite alternate;
            margin-top: 40px;
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
        }

        /* Header */
        header {
            background-color: var(--dark-fg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 15px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 99;
            animation: slideDown 0.5s ease-out;
        }
        .header-left {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        .app-logo {
            display: flex;
            align-items: center;
            font-size: 1.9rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 0 8px rgba(0, 123, 255, 0.6);
            letter-spacing: 1px;
        }

        .app-logo .shape {
            width: 35px;
            height: 35px;
            background: linear-gradient(45deg, var(--accent-color), #ffd700); /* Gold color */
            transform: rotate(45deg);
            border-radius: 8px;
            margin-right: 12px;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
            animation: headerLogoSpin 4s infinite linear;
        }

        .header-menu-icon {
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
            transition: color var(--transition-speed), transform 0.2s ease;
            padding: 5px;
            border-radius: 5px;
        }

        .header-menu-icon:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }
        .add-reward-btn {
            font-size: 1.2rem;
            color: var(--accent-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
            line-height: 1;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-left: 20px;
        }
        .add-reward-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 10px var(--accent-color);
        }
        .header-currency {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }
        .currency-item {
            display: flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
        }
        .currency-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        .icon-coin { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2a10 10 0 0 0 0 20a10 10 0 0 0 0-20m0 18a8 8 0 0 1-8-8a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8m-2.5-3.5h5v-3h2v3a2.5 2.5 0 0 1-2.5 2.5h-2a2.5 2.5 0 0 1-2.5-2.5v-3h2v3m0-11h5v-3h-2v-2a2.5 2.5 0 0 1 2.5-2.5h2a2.5 2.5 0 0 1 2.5 2.5v3h-2v3h-5v-3h2v-2a2.5 2.5 0 0 0-2.5-2.5h-2a2.5 2.5 0 0 0-2.5 2.5v3h2v3Z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2a10 10 0 0 0 0 20a10 10 0 0 0 0-20m0 18a8 8 0 0 1-8-8a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8m-2.5-3.5h5v-3h2v3a2.5 2.5 0 0 1-2.5 2.5h-2a2.5 2.5 0 0 1-2.5-2.5v-3h2v3m0-11h5v-3h-2v-2a2.5 2.5 0 0 1 2.5-2.5h2a2.5 2.5 0 0 1 2.5 2.5v3h-2v3h-5v-3h2v-2a2.5 2.5 0 0 0-2.5-2.5h-2a2.5 2.5 0 0 0-2.5 2.5v3h2v3Z'/%3E%3C/svg%3E"); }
        .icon-credit { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 4H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h18c1.11 0 2-.9 2-2V6a2 2 0 0 0-2-2m0 14H3V8h18v10m-13-8v2h4v-2h-4Z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 4H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h18c1.11 0 2-.9 2-2V6a2 2 0 0 0-2-2m0 14H3V8h18v10m-13-8v2h4v-2h-4Z'/%3E%3C/svg%3E"); }
        .icon-limit { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M11 15h2v2h-2v-2m0-8h2v6h-2V7m-1-5v2h4V2h-4M5 22h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-2.18a3 3 0 0 0-5.64 0H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2Z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M11 15h2v2h-2v-2m0-8h2v6h-2V7m-1-5v2h4V2h-4M5 22h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-2.18a3 3 0 0 0-5.64 0H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2Z'/%3E%3C/svg%3E"); }

        /* Main Content */
        main {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px; /* Increased space between sections */
            overflow-y: auto;
            width: 100%;
            max-width: 1200px; /* Max width for content on large screens */
            margin: 0 auto;
        }

        section {
            display: none;
            padding: 25px;
            background-color: var(--dark-fg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 6px 15px var(--shadow-color);
            animation: fadeIn 0.6s ease-out;
            border: 1px solid var(--border-color);
        }

        section.active {
            display: block;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(0, 123, 255, 0.4);
            letter-spacing: 1px;
        }
        
        /* Password input with eye icon */
        .password-input-container {
            position: relative;
            margin-bottom: 15px;
        }

        .password-input-container input {
            padding-right: 50px; /* Space for the icon */
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--border-color);
            font-size: 1.3rem;
            transition: color var(--transition-speed);
            padding: 5px;
            border-radius: 5px;
        }

        .toggle-password:hover {
            color: var(--primary-color);
        }

        /* Post Creation Section */
        #create-post-section label {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        #post-content {
            min-height: 120px;
            resize: vertical;
            margin-bottom: 20px;
        }

        /* Post Display Section */
        #posts-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Larger min-width for posts */
            gap: 30px; /* More space between posts */
            padding-top: 10px; /* Breathing room at the top */
        }
        /* Style for other profile's post list */
        #user-profile-section #posts-list {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .post-card {
            background-color: var(--dark-bg);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: 0 8px 20px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            overflow: hidden;
            position: relative;
            animation: slideInUp 0.6s ease-out; /* Animation for new posts */
        }
        .post-card.no-animation { animation: none; }

        .post-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.9);
            border-color: var(--primary-color); /* Highlight on hover */
        }

        .post-card h3 {
            color: var(--accent-color);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.4);
            cursor: pointer;
            text-decoration: underline;
        }

        .post-card p {
            font-size: 1.05rem;
            margin-bottom: 20px;
            flex-grow: 1;
            word-wrap: break-word;
            color: var(--text-color);
        }

        .post-meta {
            font-size: 0.88rem;
            color: #aaa;
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            margin-bottom: 15px; /* Space before actions */
        }

        .post-actions {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
        }

        .post-actions button {
            padding: 8px 18px;
            font-size: 0.9rem;
            border-radius: 6px;
            background-color: var(--primary-color);
            box-shadow: none;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-actions button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }
        .post-actions button.like-btn.liked {
            background-color: var(--success-color);
        }

        .post-actions button.delete-btn {
            background-color: var(--error-color);
        }
        .post-actions button.delete-btn:hover {
            background-color: #b02a37;
        }

        /* Unique Post Styles - Dynamic Examples */
        /* Horizontal Card */
        .post-card.horizontal {
            flex-direction: row;
            align-items: flex-start; /* Align content to top */
            gap: 20px;
            padding: 25px;
            min-height: 160px;
            border-left: 5px solid var(--accent-color);
            animation: slideInRight 0.7s ease-out;
        }
        .post-card.horizontal .post-content-wrapper {
            flex-grow: 1;
        }
        .post-card.horizontal .post-meta {
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
            min-width: 100px;
            border-top: none; /* No top border for horizontal */
            padding-top: 0;
            margin-bottom: 0;
        }
        .post-card.horizontal .post-actions {
            flex-direction: column; /* Stack buttons vertically in horizontal layout */
            gap: 8px;
        }

        /* Neon Effect */
        .post-card.neon {
            box-shadow: 0 0 15px var(--primary-color), 0 0 25px var(--primary-color) inset;
            border-color: var(--primary-color);
            position: relative;
            overflow: hidden;
            animation: neonGlow 1.5s infinite alternate ease-in-out;
        }
        .post-card.neon::before { /* Border glow effect */
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color), var(--primary-color));
            z-index: -1;
            filter: blur(8px);
            opacity: 0.7;
            border-radius: var(--border-radius-lg);
            animation: neonBorderPulse 3s infinite linear;
        }
        .post-card.neon h3, .post-card.neon p, .post-card.neon .post-meta {
            text-shadow: 0 0 10px rgba(0, 123, 255, 0.8), 0 0 20px rgba(0, 123, 255, 0.6);
        }
        .post-card.neon .post-actions button {
            background-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
        }
        .post-card.neon .post-actions button:hover {
            background-color: var(--accent-dark);
        }

        /* Profile Page Styles */
        #user-profile-section .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 25px;
            gap: 15px;
        }
        .profile-username {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent-color);
            text-shadow: 0 0 8px rgba(255, 193, 7, 0.4);
        }
        .profile-stats {
            display: flex;
            gap: 25px;
            font-size: 1.1rem;
            color: #aaa;
        }
        .profile-stats span {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .profile-stats strong {
            color: var(--text-color);
            font-size: 1.4rem;
        }
        .profile-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        /* Bottom Navigation */
        footer {
            background-color: var(--dark-fg);
            padding: 15px 0;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 15px var(--shadow-color);
            position: sticky;
            bottom: 0;
            width: 100%;
            z-index: 99;
            animation: slideUp 0.5s ease-out;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            font-size: 0.85rem;
            cursor: pointer;
            transition: color var(--transition-speed), transform 0.2s ease;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            flex: 1; /* Distribute space evenly */
            max-width: 100px; /* Max width for nav items */
        }

        .nav-item.active {
            color: var(--primary-color);
            transform: translateY(-3px); /* Slight lift */
            background-color: rgba(0, 123, 255, 0.1);
        }

        .nav-item:hover {
            color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.05);
        }

        .nav-item .icon {
            font-size: 1.6rem;
            margin-bottom: 5px;
            width: 28px;
            height: 28px;
            background-color: currentColor; /* Use current text color for SVG masks */
            -webkit-mask-size: cover;
            mask-size: cover;
            transition: transform 0.2s ease;
        }

        .nav-item:hover .icon {
            transform: scale(1.1);
        }

        /* Custom SVG Icons (used as mask-image for better styling) */
        /* Home Icon */
        .icon-home { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3L2 12h3v8h5z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3L2 12h3v8h5z'/%3E%3C/svg%3E"); }
        /* Plus/Create Icon */
        .icon-plus { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/%3E%3C/svg%3E"); }
        /* User/Profile Icon */
        .icon-user { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4z'/%3E%3C/svg%3E"); }
        /* Settings Icon */
        .icon-settings { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5A3.5 3.5 0 0 1 15.5 12A3.5 3.5 0 0 1 12 15.5M12 5c.45 0 .9-.04 1.34.12l.62-1.63l1.88.7L16.92 5.5l1.63-.62l.7 1.88l-1.07 1.07l.12 1.34h2.09c.07.45.07.9 0 1.35h-2.09l-.12 1.34l1.07 1.07l-.7 1.88l-1.63-.62l-1.88.7l-.62 1.63c-.45.16-.9.16-1.35 0l-.62-1.63l-1.88-.7l-1.63.62l-.7-1.88l1.07-1.07l-.12-1.34H2.91c-.07-.45-.07-.9 0-1.35h2.09l.12-1.34l-1.07-1.07l.7-1.88l1.63.62l1.88-.7l.62-1.63c.45-.16.9-.16 1.35 0z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5A3.5 3.5 0 0 1 15.5 12A3.5 3.5 0 0 1 12 15.5M12 5c.45 0 .9-.04 1.34.12l.62-1.63l1.88.7L16.92 5.5l1.63-.62l.7 1.88l-1.07 1.07l.12 1.34h2.09c.07.45.07.9 0 1.35h-2.09l-.12 1.34l1.07 1.07l-.7 1.88l-1.63-.62l-1.88.7l-.62 1.63c-.45.16-.9.16-1.35 0l-.62-1.63l-1.88-.7l-1.63.62l-.7-1.88l1.07-1.07l-.12-1.34H2.91c-.07-.45-.07-.9 0-1.35h2.09l.12-1.34l-1.07-1.07l.7-1.88l1.63.62l1.88-.7l.62-1.63c.45-.16.9-.16 1.35 0z'/%3E%3C/svg%3E"); }
        /* Ad Icon */
        .icon-ad { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M3 4c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1H3m1 2h16v12H4V6m2 2v8h2V8H6m4 0v8h2V8h-2m4 0v8h2V8h-2Z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M3 4c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1H3m1 2h16v12H4V6m2 2v8h2V8H6m4 0v8h2V8h-2m4 0v8h2V8h-2Z'/%3E%3C/svg%3E"); }
        /* Bell Icon (for notifications or messages) */
        .icon-bell { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 19v1H3v-1l2-2v-6a8 8 0 0 1 13.99-5.77A8 8 0 0 1 21 12v6l2 2-2 2H10a4 4 0 0 1 7.9 0l2-2v-1h2v-2l-2-2v-6a6 6 0 0 0-10.87-3.69A6 6 0 0 0 4 12v6l-2 2v1h20v-2l-2-2V12a8 8 0 0 1 1.05-4.04z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 19v1H3v-1l2-2v-6a8 8 0 0 1 13.99-5.77A8 8 0 0 1 21 12v6l2 2-2 2H10a4 4 0 0 1 7.9 0l2-2v-1h2v-2l-2-2v-6a6 6 0 0 0-10.87-3.69A6 6 0 0 0 4 12v6l-2 2v1h20v-2l-2-2V12a8 8 0 0 1 1.05-4.04z'/%3E%3C/svg%3E"); }
        .icon-like { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 21.35l-1.92-1.74C3.8 14.18 2 12.44 2 10.27c0-2.31 1.86-4.2 4.18-4.2c1.4 0 2.73.74 3.65 1.95c.92-1.21 2.25-1.95 3.65-1.95c2.32 0 4.18 1.89 4.18 4.2c0 2.17-1.8 3.91-8.08 9.34z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 21.35l-1.92-1.74C3.8 14.18 2 12.44 2 10.27c0-2.31 1.86-4.2 4.18-4.2c1.4 0 2.73.74 3.65 1.95c.92-1.21 2.25-1.95 3.65-1.95c2.32 0 4.18 1.89 4.18 4.2c0 2.17-1.8 3.91-8.08 9.34z'/%3E%3C/svg%3E"); }
        .icon-translate { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12.87 15.69c-.19-.34-.41-.75-.68-1.2c-.41-.74-.75-1.46-1.07-2.1c-.2-.4-.36-.8-.47-1.2h-.08c-.11.4-.26.8-.46 1.2c-.32.64-.66 1.36-1.07 2.1c-.27.45-.49.86-.68 1.2h-.02c-.34.62-.64 1.26-.94 1.9h2.36c-.19-.53-.39-1.06-.6-1.57zm.05-.72l.74-1.77c.18-.4.36-.8.53-1.19c.17-.39.3-.77.36-1.12c.07-.35.1-.64.1-.88v-.02c0-.3-.03-.59-.1-.89c-.06-.35-.2-.73-.37-1.13c-.17-.4-.35-.8-.53-1.19l-.74-1.77h-.04c-.31.75-.62 1.5-1 2.25c-.25.5-.5 1-.76 1.5h1.72c.26-.5.51-1 .76-1.5c.38-.75.69-1.5.9-2.25h-.04c-.2.74-.4 1.48-.6 2.23c-.2.74-.4 1.48-.6 2.22h-1.72c.26-.5.51-1 .76-1.5c.38-.75.69-1.5.9-2.25h-.04c-.2.74-.4 1.48-.6 2.23c-.2.74-.4 1.48-.6 2.22z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12.87 15.69c-.19-.34-.41-.75-.68-1.2c-.41-.74-.75-1.46-1.07-2.1c-.2-.4-.36-.8-.47-1.2h-.08c-.11.4-.26.8-.46 1.2c-.32.64-.66 1.36-1.07 2.1c-.27.45-.49.86-.68 1.2h-.02c-.34.62-.64 1.26-.94 1.9h2.36c-.19-.53-.39-1.06-.6-1.57zm.05-.72l.74-1.77c.18-.4.36-.8.53-1.19c.17-.39.3-.77.36-1.12c.07-.35.1-.64.1-.88v-.02c0-.3-.03-.59-.1-.89c-.06-.35-.2-.73-.37-1.13c-.17-.4-.35-.8-.53-1.19l-.74-1.77h-.04c-.31.75-.62 1.5-1 2.25c-.25.5-.5 1-.76 1.5h1.72c.26-.5.51-1 .76-1.5c.38-.75.69-1.5.9-2.25h-.04c-.2.74-.4 1.48-.6 2.23c-.2.74-.4 1.48-.6 2.22h-1.72c.26-.5.51-1 .76-1.5c.38-.75.69-1.5.9-2.25h-.04c-.2.74-.4 1.48-.6 2.23c-.2.74-.4 1.48-.6 2.22z'/%3E%3C/svg%3E"); }

        /* Desktop Adjustments */
        @media (min-width: 768px) {
            body {
                font-size: 17px;
            }
            .container {
                padding: 40px;
                max-width: 580px; /* Larger max-width for forms on desktop */
            }
            header {
                padding: 20px 40px;
            }
            main {
                padding: 30px 40px;
                max-width: 1400px; /* Wider content area for desktop */
            }
            footer {
                padding: 15px 40px;
            }
            .post-card.horizontal {
                grid-column: span 2; /* Make horizontal cards span 2 columns on desktop */
                max-width: none;
            }
            #posts-list {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Adjust post grid for wider screens */
            }
            #user-profile-section #posts-list {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
        }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes glow { 0% { box-shadow: 0 0 5px var(--primary-color); } 50% { box-shadow: 0 0 20px var(--primary-color), 0 0 30px var(--accent-color); } 100% { box-shadow: 0 0 5px var(--primary-color); } }
        @keyframes splashDiamondPulse { 0%, 100% { transform: translate(-50%, -50%) rotate(45deg) scale(1); opacity: 1; } 50% { transform: translate(-50%, -50%) rotate(45deg) scale(1.08); opacity: 0.8; } }
        @keyframes headerLogoSpin { 0% { transform: rotate(45deg) scale(1); } 25% { transform: rotate(135deg) scale(1.05); } 50% { transform: rotate(225deg) scale(1); } 75% { transform: rotate(315deg) scale(1.05); } 100% { transform: rotate(405deg) scale(1); } }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes neonGlow { 0% { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color) inset; } 50% { box-shadow: 0 0 25px var(--primary-color), 0 0 40px var(--primary-color) inset; } 100% { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color) inset; } }
        @keyframes neonBorderPulse { 0%, 100% { opacity: 0.7; filter: blur(8px) brightness(1); } 50% { opacity: 1; filter: blur(12px) brightness(1.2); } }
        
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 20px; }
        .mt-4 { margin-top: 20px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo-container">
            <div class="splash-logo-diamond"></div>
            <div class="splash-logo-text">A</div>
        </div>
        <div class="splash-loader"></div>
        <p style="margin-top: 20px; font-size: 1.1rem; color: #bbb;">Loading AddMint Pro...</p>
    </div>

    <div id="app-container" class="hidden">
        <header>
            <div class="header-left">
                <div class="app-logo">
                    <span class="shape"></span> AddMint
                </div>
                <div class="add-reward-btn" onclick="showSection('earn-rewards-section')">&#43;</div>
            </div>
            
            <div class="header-currency">
                <div class="currency-item">
                    <span class="currency-icon icon-coin"></span>
                    <span id="header-coins">0</span>
                </div>
                <div class="currency-item">
                    <span class="currency-icon icon-credit"></span>
                    <span id="header-credits">0</span>
                </div>
                <div class="currency-item">
                    <span class="currency-icon icon-limit"></span>
                    <span id="header-limits">0</span>
                </div>
            </div>
        </header>

        <main>
            <section id="signin-auth" class="container active">
                <h2>Welcome Back!</h2>
                <div id="auth-status-message" class="message hidden"></div>
                <form id="signin-form">
                    <input type="email" id="signin-email" placeholder="Your Email" required>
                    <div class="password-input-container">
                        <input type="password" id="signin-password" placeholder="Password" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signin-password', this)">&#128065;</span> </div>
                    <button type="submit">Sign In</button>
                    <p class="text-center mt-4">Don't have an account? <a href="#" onclick="showSection('signup-auth'); return false;">Sign Up Here</a></p>
                </form>
            </section>

            <section id="signup-auth" class="container">
                <h2>Join AddMint Today!</h2>
                <div id="signup-status-message" class="message hidden"></div>
                <form id="signup-form">
                    <input type="email" id="signup-email" placeholder="Your Email" required>
                    <div class="password-input-container">
                        <input type="password" id="signup-password" placeholder="Create Password (min 6 chars)" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signup-password', this)">&#128065;</span>
                    </div>
                    <div class="password-input-container">
                        <input type="password" id="signup-confirm-password" placeholder="Confirm Password" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signup-confirm-password', this)">&#128065;</span>
                    </div>
                    <button type="submit">Sign Up</button>
                    <p class="text-center mt-4">Already have an account? <a href="#" onclick="showSection('signin-auth'); return false;">Sign In</a></p>
                </form>
            </section>

            <section id="email-verify" class="container">
                <h2>Verify Your Email</h2>
                <div id="verify-email-message" class="message error"></div>
                <p class="text-center mb-4">A verification link has been sent to your email. Please check your inbox (and spam folder) to activate your account. Then sign in again.</p>
                <button onclick="sendVerificationEmail()">Resend Verification Email</button>
                <button onclick="auth.signOut(); showSection('signin-auth');" class="mt-4" style="background-color: var(--error-color);">Sign Out</button>
            </section>

            <section id="setup-profile" class="container">
                <h2>Complete Your Profile</h2>
                <div id="profile-setup-message" class="message hidden"></div>
                <form id="profile-setup-form">
                    <label for="profileUsername">Choose a Username:</label>
                    <input type="text" id="profileUsername" placeholder="e.g., AddMintUser" required>
                    <p class="text-center mt-4">For fast app growth, share with friends!</p>
                    <button type="submit" class="mt-4">Save Profile & Continue</button>
                </form>
            </section>
            
            <section id="home-posts">
                <h2>Recent Updates</h2>
                <p class="text-center info mb-4">Daily Free Rewards! You get 10 coins, 10 credits, and 2 post limits every day.</p>
                <button class="mb-4" onclick="fetchPosts()">Refresh Feed</button>
                <div id="posts-list">
                    <p class="text-center" id="no-posts-message" style="margin-top: 30px; font-style: italic; color: #aaa;">Fetching exciting posts...</p>
                </div>
            </section>

            <section id="create-post-section">
                <h2>Share Your Thoughts</h2>
                <div id="create-post-message" class="message hidden"></div>
                <p class="text-center mb-4">You have <span id="post-limit-count">0</span> free posts remaining today.</p>
                <form id="create-post-form">
                    <label for="post-content">What's on your mind today?</label>
                    <textarea id="post-content" placeholder="Type your message here..." required></textarea>
                    <button type="submit" class="mt-4">Publish Post</button>
                </form>
                <button onclick="publishPostWithCoins()" class="mt-4" style="background-color: var(--accent-color);">Use 5 Coins to Post</button>
            </section>

            <section id="user-profile-section">
                <h2>My Profile</h2>
                <div id="user-profile-info-container">
                    </div>
            </section>

            <section id="other-user-profile-section">
                <div id="other-user-profile-info-container">
                    </div>
            </section>

            <section id="settings-section" class="container">
                <h2>App Settings</h2>
                <p class="text-center mt-4">App Version: 1.0.0 Pro</p>
                <p class="text-center mt-4">Developed with ❤️ and technology.</p>
                <button onclick="auth.signOut()" class="mt-4" style="background-color: var(--error-color);">Sign Out</button>
                <button onclick="showSection('monetize-section')" class="mt-4" style="background-color: #6c757d;">Monetization Info</button>
            </section>
            
            <section id="monetize-section" class="container">
                <h2>Monetize Your Content</h2>
                <div class="message info">
                    <p>Monetization is coming soon!</p>
                    <p>Once active, you can earn money by creating great content.</p>
                    <p><strong>How it will work:</strong></p>
                    <ul>
                        <li>Have at least <strong>100 followers</strong>.</li>
                        <li>Post <strong>150 posts</strong> to become eligible.</li>
                        <li>After that, you can earn <strong>₹10 - ₹100</strong> per eligible post.</li>
                    </ul>
                    <p class="mt-4">Start sharing and grow your followers now!</p>
                    <button onclick="showSection('home-posts')" class="mt-4" style="background-color: var(--primary-color);">Go to Home</button>
                </div>
            </section>

            <section id="earn-rewards-section" class="container">
                <h2>Earn More Rewards</h2>
                <div class="message info">
                    <p class="text-center">Watch a video ad to get rewards!</p>
                </div>
                <div class="reward-options" style="display: flex; flex-direction: column; gap: 15px;">
                    <button onclick="watchAdForReward('coins')">
                        <span class="currency-icon icon-coin"></span> Watch Ad for 10 Coins
                    </button>
                    <button onclick="watchAdForReward('credits')">
                        <span class="currency-icon icon-credit"></span> Watch Ad for 10 Credits
                    </button>
                    <button onclick="watchAdForReward('limit')">
                        <span class="currency-icon icon-limit"></span> Watch Ad for 1 Post Limit
                    </button>
                </div>
                <button onclick="showSection('home-posts')" class="mt-4" style="background-color: #6c757d;">Back to Home</button>
            </section>
        </main>

        <footer>
            <div class="nav-item active" data-section="home-posts">
                <span class="icon icon-home"></span>
                <span>Home</span>
            </div>
            <div class="nav-item" data-section="create-post-section">
                <span class="icon icon-plus"></span>
                <span>Create</span>
            </div>
            <div class="nav-item" data-section="user-profile-section">
                <span class="icon icon-user"></span>
                <span>Profile</span>
            </div>
            <div class="nav-item" data-section="settings-section">
                <span class="icon icon-settings"></span>
                <span>Settings</span>
            </div>
        </footer>
    </div>

    <script>
        // Firebase Configuration (YOURS)
        const firebaseConfig = {
            apiKey: "AIzaSyDlZA4grzF3fx95-11E4s7ASXwkIij1k1w",
            authDomain: "addmint-7ab6b.firebaseapp.com",
            databaseURL: "https://addmint-7ab6b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "addmint-7ab6b",
            storageBucket: "addmint-7ab6b.firebasestorage.app",
            messagingSenderId: "504015450137",
            appId: "1:504015450137:web:694b176313582cce1e7a88",
            measurementId: "G-H7J7M23Z82"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUserId = null;
        let currentUserProfile = {};
        let postSubscription = null; // To manage real-time post updates

        // --- UI Utility Functions ---
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeNavItem = document.querySelector(`.nav-item[data-section="${sectionId}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }
        
        function showMessage(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message ${type}`;
            element.classList.remove('hidden');
        }

        function hideMessage(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        function togglePasswordVisibility(inputId, iconElement) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text";
                iconElement.innerHTML = "&#128064;";
            } else {
                input.type = "password";
                iconElement.innerHTML = "&#128065;";
            }
        }
        
        function showMainAppUI() {
            document.getElementById('app-container').classList.remove('hidden');
            showSection('home-posts');
            startDailyRewardTimer();
        }

        function hidePreloader() {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => {
                splash.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 1200);
        }

        function updateHeaderUI() {
            if (currentUserProfile.coins !== undefined) {
                document.getElementById('header-coins').textContent = currentUserProfile.coins;
                document.getElementById('header-credits').textContent = currentUserProfile.credits;
                document.getElementById('header-limits').textContent = currentUserProfile.post_limit;
                document.getElementById('post-limit-count').textContent = currentUserProfile.post_limit;
            }
        }
        
        // --- Authentication ---
        // (Sign up, sign in, email verification, profile setup logic as before)
        // ... (This section would contain the previous logic for forms) ...
        
        // --- Daily Rewards and Post Limits ---
        async function checkAndAwardDailyRewards() {
            if (!currentUserId) return;
            const userRef = db.collection('users').doc(currentUserId);
            const userDoc = await userRef.get();

            if (userDoc.exists) {
                const userData = userDoc.data();
                const lastRewardDate = userData.last_reward_date ? userData.last_reward_date.toDate() : null;
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (!lastRewardDate || lastRewardDate < today) {
                    // It's a new day, give rewards
                    const newCoins = (userData.coins || 0) + 10;
                    const newCredits = (userData.credits || 0) + 10;
                    const newLimit = (userData.post_limit || 0) + 2;

                    await userRef.update({
                        coins: newCoins,
                        credits: newCredits,
                        post_limit: newLimit,
                        last_reward_date: new Date()
                    });
                    
                    currentUserProfile.coins = newCoins;
                    currentUserProfile.credits = newCredits;
                    currentUserProfile.post_limit = newLimit;
                    updateHeaderUI();
                    alert("Congratulations! You've received your daily rewards: 10 Coins, 10 Credits, and 2 Post Limits!");
                }
            }
        }

        // --- Post Management ---
        async function publishPost(costType) {
            hideMessage('create-post-message');
            const content = document.getElementById('post-content').value.trim();

            if (!content) {
                showMessage('create-post-message', 'Post content cannot be empty.', 'error');
                return;
            }
            if (!currentUserId || !currentUserProfile.username) {
                showMessage('create-post-message', 'User not logged in or profile incomplete.', 'error');
                return;
            }

            let canPost = false;
            let transactionAmount = 0;
            if (costType === 'limit' && currentUserProfile.post_limit > 0) {
                canPost = true;
                transactionAmount = -1;
            } else if (costType === 'coins' && currentUserProfile.coins >= 5) {
                canPost = true;
                transactionAmount = -5;
            } else {
                showMessage('create-post-message', 'Not enough free limits or coins to post. Watch an ad to earn more!', 'error');
                return;
            }

            try {
                const userRef = db.collection('users').doc(currentUserId);
                await db.runTransaction(async (transaction) => {
                    const userDoc = await transaction.get(userRef);
                    if (!userDoc.exists) throw "User not found";
                    
                    const userData = userDoc.data();
                    let newCoins = userData.coins;
                    let newLimit = userData.post_limit;

                    if (costType === 'limit') {
                        if (userData.post_limit <= 0) throw "Post limit already exhausted.";
                        newLimit -= 1;
                    } else if (costType === 'coins') {
                        if (userData.coins < 5) throw "Not enough coins to post.";
                        newCoins -= 5;
                    }

                    const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // Posts expire in 24 hours
                    const postRef = db.collection('posts').doc();
                    
                    transaction.set(postRef, {
                        content: content,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        expiryTime: expiryTime,
                        userId: currentUserId,
                        username: currentUserProfile.username,
                        likes: 0,
                        translate: false // Added for translate feature
                    });

                    // Update user's coins, limit and post count
                    transaction.update(userRef, {
                        coins: newCoins,
                        post_limit: newLimit,
                        posts_count: (userData.posts_count || 0) + 1
                    });
                });

                document.getElementById('post-content').value = '';
                showMessage('create-post-message', 'Post published successfully!', 'success');
                fetchPosts(); // Refresh home feed
                fetchUserProfile(currentUserId); // Update profile stats
                showSection('home-posts');
            } catch (error) {
                console.error("Error publishing post:", error);
                showMessage('create-post-message', `Failed to publish post: ${error.message}`, 'error');
            }
        }
        
        async function fetchPosts() {
            const postsListDiv = document.getElementById('posts-list');
            postsListDiv.innerHTML = '<p class="text-center" id="no-posts-message" style="margin-top: 30px; font-style: italic; color: #aaa;">Fetching exciting posts...</p>';
            const noPostsMessage = document.getElementById('no-posts-message');

            if (postSubscription) {
                postSubscription(); // Unsubscribe from previous listener
            }
            
            postSubscription = db.collection('posts')
                                 .orderBy('timestamp', 'desc')
                                 .onSnapshot(snapshot => {
                                     postsListDiv.innerHTML = '';
                                     if (snapshot.empty) {
                                         noPostsMessage.textContent = "No posts yet. Be the first!";
                                         postsListDiv.appendChild(noPostsMessage);
                                         return;
                                     }

                                     let lastRandomIndex = -1;
                                     const postStyles = ['horizontal', 'neon']; // Expanded options
                                     
                                     snapshot.forEach(doc => {
                                         const post = doc.data();
                                         const postId = doc.id;
                                         
                                         if (post.expiryTime && post.expiryTime < Date.now()) return;

                                         let randomIndex;
                                         do {
                                             randomIndex = Math.floor(Math.random() * postStyles.length);
                                         } while (randomIndex === lastRandomIndex && postStyles.length > 1);
                                         lastRandomIndex = randomIndex;
                                         const randomStyle = postStyles[randomIndex];

                                         const postCard = document.createElement('div');
                                         postCard.className = `post-card ${randomStyle}`;
                                         postCard.id = `post-${postId}`;
                                         
                                         // ... (Post rendering logic, including like, translate, contact buttons) ...
                                         // The HTML inside postCard will be similar to the previous version but with new buttons
                                         
                                         postsListDiv.appendChild(postCard);
                                     });

                                     if (postsListDiv.childElementCount === 0) {
                                        postsListDiv.innerHTML = '<p class="text-center" style="margin-top: 30px; font-style: italic; color: #aaa;">No posts available at the moment.</p>';
                                     }
                                 }, error => {
                                     console.error("Error fetching posts:", error);
                                     postsListDiv.innerHTML = `<p class="text-center message error">Error loading posts: ${error.message}</p>`;
                                 });
        }
        
        // --- New Functions (like, delete, edit, translate, follow, etc.) ---
        // ... (These functions will be added here. They will use Firestore transactions for data integrity) ...

        // --- Ad Monetization Callbacks ---
        // These are functions that are called from App Inventor via RunJavaScript
        window.adWatchedForReward = (rewardType) => {
            if (!currentUserId) return;
            const userRef = db.collection('users').doc(currentUserId);
            let updateData = {};

            switch(rewardType) {
                case 'coins':
                    updateData = {
                        coins: firebase.firestore.FieldValue.increment(10)
                    };
                    break;
                case 'credits':
                    updateData = {
                        credits: firebase.firestore.FieldValue.increment(10)
                    };
                    break;
                case 'limit':
                    updateData = {
                        post_limit: firebase.firestore.FieldValue.increment(1)
                    };
                    break;
                default:
                    console.error("Invalid reward type:", rewardType);
                    return;
            }

            userRef.update(updateData)
                .then(() => {
                    console.log(`User ${currentUserId} rewarded with ${rewardType}.`);
                    fetchUserProfile(currentUserId); // Refresh UI
                    alert(`Congratulations! You earned ${updateData.coins || updateData.credits || updateData.post_limit} ${rewardType}.`);
                })
                .catch(error => {
                    console.error("Error updating user rewards:", error);
                    alert("Failed to update rewards. Please try again.");
                });
        };
        
        // --- Event Listeners and Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // ... (Nav item click handlers) ...
            auth.onAuthStateChanged(async (user) => {
                setTimeout(() => {
                    hidePreloader();
                    if (user) {
                        currentUserId = user.uid;
                        if (user.emailVerified) {
                            fetchUserProfile(currentUserId)
                                .then(() => {
                                    if (!currentUserProfile.username) {
                                        showSection('setup-profile');
                                    } else {
                                        showMainAppUI();
                                        checkAndAwardDailyRewards();
                                        fetchPosts();
                                    }
                                });
                        } else {
                            showSection('email-verify');
                        }
                    } else {
                        currentUserId = null;
                        currentUserProfile = {};
                        document.getElementById('app-container').classList.remove('hidden');
                        showSection('signin-auth');
                    }
                }, 1500);
            });
        });
        
        // --- Sound System (Example using Web Audio API) ---
        function playSound() {
            // This is a simple example. A more robust solution would pre-load the audio.
            const audio = new Audio('path/to/your/sound.mp3'); // Replace with your sound file path
            audio.play().catch(e => console.error("Sound playback failed:", e));
        }

    </script>
</body>
</html>
