
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AddMint - Ultra Professional</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS start here (copied from style.css for all-in-one file) */

        /* General Body and Container Styles */
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color-main); /* Using CSS variables */
            color: var(--text-color-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease; /* For dark/light mode */
        }

        /* Dark Mode Variables (Default) */
        body.dark-mode {
            --bg-color-main: #1a1a2e;
            --bg-color-lighter: #16213e;
            --bg-color-darker: #0d2a4a;
            --text-color-main: #e0e0e0;
            --text-color-light: #bbb;
            --text-color-accent: #00ffff;
            --border-color-main: #0f3460;
            --shadow-color-main: rgba(0, 255, 255, 0.2);
            --shadow-color-strong: rgba(0, 255, 255, 0.4);
            --highlight-color-main: #00ffff;
            --highlight-color-secondary: #ff00ff;
            --button-primary-bg: #00ffff;
            --button-primary-text: #1a1a2e;
            --button-secondary-bg: #334e68;
            --button-secondary-text: #e0e0e0;
            --input-bg: #1a1a2e;
            --input-border: #00ffff;
            --post-card-bg: #0f3460;
            --chat-bubble-left-bg: #334e68;
            --chat-bubble-right-bg: #00ffff;
            --chat-bubble-right-text: #1a1a2e;
        }

        /* Light Mode Variables (Example, not fully implemented for all elements) */
        body.light-mode {
            --bg-color-main: #f0f2f5;
            --bg-color-lighter: #ffffff;
            --bg-color-darker: #e0e0e0;
            --text-color-main: #333333;
            --text-color-light: #666666;
            --text-color-accent: #007bff;
            --border-color-main: #cccccc;
            --shadow-color-main: rgba(0, 0, 0, 0.1);
            --shadow-color-strong: rgba(0, 0, 0, 0.2);
            --highlight-color-main: #007bff;
            --highlight-color-secondary: #6f42c1;
            --button-primary-bg: #007bff;
            --button-primary-text: #ffffff;
            --button-secondary-bg: #e9ecef;
            --button-secondary-text: #333333;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --post-card-bg: #ffffff;
            --chat-bubble-left-bg: #e9ecef;
            --chat-bubble-right-bg: #007bff;
            --chat-bubble-right-text: #ffffff;
        }


        .app-container {
            width: 100%;
            max-width: 420px; /* Typical mobile width */
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color-lighter);
            box-shadow: 0 0 30px var(--shadow-color-main); /* Subtle glow */
            border-radius: 12px;
            overflow: hidden;
            position: relative; /* For sidebar positioning */
            border: 1px solid var(--border-color-main);
        }

        /* Added by JS if necessary to initially hide until content is ready */
        .hidden {
            display: none !important; /* Forces elements to be truly hidden by default */
        }

        /* Diagnostic message - Visible only if JavaScript successfully loads and sets its display */
        #load-status {
            position:fixed; 
            top:50%; 
            left:50%; 
            transform:translate(-50%, -50%); 
            color:white; 
            background:black; 
            padding:10px; 
            z-index:9999;
            display: none; /* JS will change this to block */
            text-align: center;
        }

        /* Auth Container (Login/Signup) - Now handled more robustly by JS display flex/none */
        .auth-container {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            display: flex; /* Changed from default hidden to flex, controlled by JS. */
            justify-content: center;
            align-items: center; /* Vertically centers the .auth-content */
            background-color: var(--bg-color-lighter);
            box-shadow: 0 0 30px var(--shadow-color-main);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color-main);
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
            text-align: center;
        }
        .auth-content { /* Main content area for forms */
            width: 100%;
            background-color: var(--bg-color-main);
            padding: 30px 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid var(--border-color-main);
            display: flex; /* Inner flex to arrange children vertically */
            flex-direction: column;
            align-items: center; /* Center login/signup forms */
        }
        .app-logo-splash { /* Used by auth-content h1 */
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #00ffff, #ff00ff); 
            border-radius: 50%;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), 0 0 40px rgba(255, 0, 255, 0.4);
            animation: pulse 2s infinite alternate;
        }
        .app-logo-splash::before {
            content: 'A'; 
            font-family: 'Montserrat', sans-serif;
            font-size: 60px;
            font-weight: bold;
            color: #1a1a2e;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }


        .auth-screen { 
            display: none; /* Default to hidden */
            width: 100%; 
            flex-direction: column; 
            align-items: center; 
        }
        .auth-screen.active {
            display: flex; /* Active screen becomes visible flex */
        }
        .auth-text { 
            font-size: 0.9em;
            margin-top: 15px;
            color: var(--text-color-light);
        }
        .auth-text a { 
            color: var(--highlight-color-main);
            text-decoration: none;
            font-weight: bold;
        }
        .auth-text a:hover {
            text-decoration: underline;
        }
        .status-message { 
            margin-top: 15px;
            padding: 8px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .status-message.error { 
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        .status-message.success { 
            background-color: rgba(51, 255, 87, 0.2);
            color: #33ff57;
            border: 1px solid #33ff57;
        }
        .status-message.info { 
            background-color: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border: 1px solid #00ffff;
        }


        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--border-color-main);
            color: white;
            border-bottom: 1px solid var(--bg-color-darker);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .header-left, .header-right {
            display: flex;
            align-items: center;
        }

        .app-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-left: 15px;
            color: var(--highlight-color-main);
            text-shadow: 0 0 5px var(--highlight-color-main);
        }

        .icon-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 15px;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .icon-button:hover {
            color: var(--highlight-color-main);
            transform: scale(1.1);
        }

        .loader { 
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--highlight-color-main);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .menu-icon {
            width: 30px;
            height: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
        }

        .menu-icon .bar {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 2px;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px; /* Hidden by default */
            width: 280px;
            height: 100%;
            background-color: var(--border-color-main);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
            z-index: 20;
            transition: left 0.3s ease-in-out;
            padding-top: 20px;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--bg-color-darker);
            margin-bottom: 20px;
            position: relative;
        }

        .sidebar-header h3 {
            margin: 0 0 0 15px;
            color: var(--highlight-color-main);
            font-size: 1.4em;
            max-width: 150px; /* Prevent long names from pushing close button */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-header .close-sidebar {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            color: white;
            cursor: pointer;
            line-height: 1;
        }

        .profile-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--highlight-color-main); /* Default for coded avatars */
            overflow: hidden;
            position: relative;
            border: 2px solid var(--highlight-color-main);
            flex-shrink: 0;
            background-size: cover; /* For direct pic link */
            background-position: center; /* For direct pic link */
        }
        .profile-avatar-small::before {
            content: '👤'; /* Default large avatar */
            font-family: 'Font Awesome 6 Free'; font-weight: 900;
            font-size: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--button-primary-text);
        }
        .profile-avatar-small[style*="background-image"]::before {
            content: none; /* Hide default emoji if image is loaded */
        }


        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-color-main);
            text-decoration: none;
            font-size: 1.1em;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .sidebar ul li a:hover {
            background-color: var(--bg-color-main);
            color: var(--highlight-color-main);
        }

        /* Data Saver Toggle */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            margin-left: auto; /* Push to the right */
            flex-shrink: 0; /* Prevent shrinking */
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-switch label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-switch label:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + label {
            background-color: var(--highlight-color-main);
        }

        .toggle-switch input:checked + label:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }


        /* Main Content */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        .app-screen {
            display: none;
        }

        .app-screen.active {
            display: block;
        }

        section {
            background-color: var(--bg-color-main);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px var(--shadow-color-main);
            border: 1px solid var(--border-color-main);
        }

        h2 {
            color: var(--highlight-color-main);
            text-shadow: 0 0 5px var(--highlight-color-main);
            border-bottom: 2px solid var(--border-color-main);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Category Filter */
        .category-filter {
            margin-bottom: 20px;
        }
        .category-filter select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color-main);
            border: 1px solid var(--input-border);
        }


        /* Post Feed Styles */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Space between posts */
        }

        .post-card {
            background-color: var(--post-card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.08);
            border: 1px solid var(--bg-color-darker);
            transition: box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
            position: relative; /* For neon effect */
        }

        .post-card.neon-glow {
            box-shadow: 0 0 5px var(--highlight-color-main), 0 0 15px var(--highlight-color-main), 0 0 25px var(--highlight-color-main), 0 0 35px var(--highlight-color-main);
            border-color: var(--highlight-color-main);
        }
        
        /* NEW: Remix effect */
        .post-card.remixed {
            background-color: #2a163e; /* Lighter purple/darker blue for remixed */
            border-color: #ff00ff; /* Pink border */
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2);
        }
        .remix-content-wrapper {
            display: flex;
            flex-direction: column; /* Stack them for better mobile view */
            gap: 10px;
            margin-top: 10px;
            border-top: 1px dashed #0d2a4a;
            padding-top: 15px;
        }
        .remix-original, .remix-reply {
            padding: 10px;
            border-radius: 8px;
            background-color: #1a1a2e; /* Darker background for remix sections */
            border: 1px solid #0f3460;
        }
        .remix-original h5, .remix-reply h5 {
            margin-top: 0;
            color: #00ffff;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .remix-original p, .remix-reply p {
            font-size: 0.9em;
            color: #e0e0e0;
            margin-bottom: 0;
        }
        /* End NEW: Remix effect */


        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #00ffff; /* Default for coded avatars */
            margin-right: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid #00ffff;
            flex-shrink: 0;
            cursor: pointer; /* Make avatar clickable */
        }

        /* Styles for coded avatars - All 50 logos */
        /* These styles will be dynamically generated by JS, example below */
        /* .profile-avatar.user-logo-1 { background-color: #ff6347; } .profile-avatar.user-logo-1::before { content: '🧑'; font-size: 24px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); } */
        /* JS function applies these in a style tag directly to head */
        
        .profile-avatar.user-logo-default::before {
            content: '👤';
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            font-size: 24px;
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            color: #1a1a2e;
        }

        .profile-avatar[style*="background-image"]::before {
            content: none !important; /* Hide default emoji if direct image URL is set */
        }
        

        .profile-avatar.small {
            width: 30px;
            height: 30px;
            border-width: 1px;
        }

        .username {
            font-weight: bold;
            color: #fff;
            flex-grow: 1;
            cursor: pointer; /* Make username clickable */
        }

        .post-options {
            position: relative;
        }

        .post-options .fa-ellipsis-v {
            cursor: pointer;
            font-size: 1.2em;
            color: #888;
        }

        .options-dropdown {
            display: none; /* Hidden by default, toggled by JS */
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 5;
            min-width: 120px;
            overflow: hidden;
        }

        .options-dropdown.show {
            display: block;
        }

        .options-dropdown span {
            display: block;
            padding: 10px 15px;
            cursor: pointer;
            color: #e0e0e0;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .options-dropdown span:hover {
            background-color: #0f3460;
            color: #00ffff;
        }

        .post-content {
            margin-bottom: 10px;
        }

        .post-content p {
            margin: 0 0 10px 0;
        }

        .post-content img {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #0d2a4a;
        }

        .post-content a {
            color: #00ffff;
            text-decoration: underline;
            word-break: break-all;
        }

        .post-footer {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .post-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .like-button, .views-count, .translate-button, .speak-button, .comment-button {
            cursor: pointer;
            display: flex;
            align-items: center;
            color: #bbb;
            transition: color 0.2s ease;
        }

        .like-button i, .views-count i, .translate-button i, .speak-button i, .comment-button i {
            margin-right: 5px;
        }

        .like-button .fas.fa-heart {
            color: #ff007f; /* Red for liked */
            animation: bounceIn 0.3s ease-out;
        }
        .speak-button.active i {
            color: #00ffff; /* Highlight when speaking */
        }


        .post-reactions {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #aaa;
        }

        .emoji-reaction-display {
            display: flex;
            gap: 5px;
            flex-wrap: wrap; /* Allow wrapping if many emojis */
        }

        .emoji-reaction-display .emoji {
            font-size: 1.2em;
            display: flex; /* To align count */
            align-items: center;
        }

        .emoji-reaction-display .count {
            font-size: 0.8em;
            margin-left: 2px;
            color: #e0e0e0;
        }

        .total-reactions {
            margin-left: 10px;
            font-weight: bold;
            color: #00ffff;
        }

        .emoji-picker, .emoji-picker-chat {
            position: absolute;
            bottom: 40px; /* Adjust based on footer position */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.2);
            z-index: 10;
        }

        .emoji-option {
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .emoji-option:hover {
            transform: scale(1.2);
        }

        /* Horizontal Post Layout (for mixed feed) */
        .horizontal-post-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch; /* For smoother scrolling on iOS */
            margin: 10px 0;
            background-color: #0d2a4a;
            border-radius: 10px;
            padding: 15px;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
            border: 1px solid #0f3460;
        }

        .horizontal-post-container .post-card {
            min-width: 250px; /* Fixed width for horizontal items */
            scroll-snap-align: start;
            flex-shrink: 0;
            margin-bottom: 0; /* Override default margin */
        }

        .horizontal-post-container .post-card .post-content img {
            height: 150px; /* Fixed height for horizontal images */
            object-fit: cover;
        }

        /* Table Post Layout */
        .table-post-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
            gap: 15px;
            padding: 15px;
            background-color: #0d2a4a;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
            border: 1px solid #0f3460;
            margin: 10px 0;
        }

        .table-post-container .post-card {
            margin-bottom: 0; /* Override default margin */
            padding: 10px;
        }

        .table-post-container .post-card .post-content img {
            height: 100px; /* Smaller images for table layout */
            object-fit: cover;
        }
        .table-post-container .post-card .post-content p {
            font-size: 0.85em; /* Smaller text for table layout */
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limit text to 3 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        /* Form & Button Styles */
        .form-group {
            margin-bottom: 15px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #e0e0e0;
            text-align: left;
        }
        
        .password-input-group {
            position: relative;
            width: 100%;
        }

        .password-toggle {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-color-light);
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="file"],
        textarea,
        select,
        input[type="number"],
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #00ffff; /* Neon border */
            border-radius: 6px;
            background-color: #1a1a2e;
            color: #e0e0e0;
            box-sizing: border-box;
            font-size: 1em;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus,
        input[type="number"]:focus,
        input[type="date"]:focus {
            border-color: #ff00ff; /* Pink focus */
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.4);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input[type="file"] {
            padding: 8px; /* Less padding for file input */
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            text-align: center;
            text-decoration: none; /* For link buttons */
            width: 100%;
        }

        .btn.primary-btn {
            background-color: #00ffff;
            color: #1a1a2e;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }

        .btn.primary-btn:hover {
            background-color: #00e0e0;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
        }
        .btn:disabled { /* General styling for disabled buttons */
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }


        .btn.secondary-btn {
            background-color: #334e68;
            color: #e0e0e0;
            border: 1px solid #00ffff;
        }

        .btn.secondary-btn:hover {
            background-color: #4a6684;
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }

        .btn.danger-btn {
            background-color: #e74c3c;
            color: white;
        }

        .btn.danger-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn.social-btn {
            background-color: #2e8b57; /* WhatsApp Green */
            color: white;
            margin-right: 10px;
        }

        .btn.social-btn i {
            margin-right: 8px;
        }

        .btn.social-btn:hover {
            background-color: #226b41;
        }

        .profile-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: #1a1a2e;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
            border: 1px solid #00ffff;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: fadeInScale 0.3s ease-out;
            max-height: 90vh; /* Allow scrolling for tall modals */
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #00ffff;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }

        .modal-content .btn {
            margin-top: 15px;
            width: 100%;
        }

        .logo-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #0f3460;
            border-radius: 8px;
            background-color: #0d2a4a;
        }

        .logo-option-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #333; /* Base color for logo previews */
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid transparent;
            transition: border-color 0.2s ease, transform 0.2s ease;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .logo-option-item.selected {
            border-color: #00ffff;
            box-shadow: 0 0 10px #00ffff;
        }

        .logo-option-item:hover {
            transform: scale(1.1);
        }

        .profile-avatar.user-logo-default::before { /* Default fallback if dynamic styles fail */
            content: '👤';
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            font-size: 24px;
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            color: #1a1a2e;
        }

        /* Profile Screen Specifics */
        .profile-header-area {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #0f3460;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid #0d2a4a;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #00ffff; /* Default for coded avatars */
            margin: 0 auto 20px auto;
            overflow: hidden;
            position: relative;
            border: 4px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
            background-size: cover;
            background-position: center;
        }
        /* Override default avatar emoji if background image is present */
        .profile-avatar-large[style*="background-image"]::before {
            content: none !important; 
        }

        .profile-name, .profile-bio {
            color: #e0e0e0;
            font-size: 0.95em;
            margin-bottom: 5px;
        }
        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            font-size: 1.1em;
        }

        .profile-stats div {
            text-align: center;
            padding: 8px 12px;
            background-color: #1a1a2e;
            border-radius: 8px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
        }

        .profile-stats span {
            display: block;
            font-weight: bold;
            font-size: 1.2em;
            color: #00ffff;
        }

        .clickable-stat {
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .clickable-stat:hover {
            background-color: #0d2a4a;
            transform: translateY(-2px);
        }

        /* Chat Styles */
        .message-list-container, .chat-window-container {
            background-color: #0f3460;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            border: 1px solid #0d2a4a;
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
        }

        .recent-chats-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #1a1a2e;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .chat-item:hover {
            background-color: #1a1a2e;
        }

        .chat-info {
            margin-left: 10px;
            flex-grow: 1;
        }

        .chat-username {
            font-weight: bold;
            color: #00ffff;
            display: block;
        }

        .last-message {
            font-size: 0.9em;
            color: #bbb;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-window-container {
            height: calc(100vh - 160px);
            padding: 0;
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #0f3460;
            border-bottom: 1px solid #0d2a4a;
            color: white;
        }

        .chat-header .icon-button {
            margin-right: 10px;
        }

        #chat-partner-username {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ffff;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-color: #1a1a2e;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 0.95em;
            line-height: 1.4;
            position: relative;
        }

        .message-bubble.right {
            align-self: flex-end;
            background-color: #00ffff;
            color: #1a1a2e;
            border-bottom-right-radius: 4px;
        }

        .message-bubble.left {
            align-self: flex-start;
            background-color: #334e68;
            color: #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .chat-input-area {
            display: flex;
            padding: 10px 15px;
            border-top: 1px solid #0d2a4a;
            background-color: #0f3460;
        }

        #message-input {
            flex-grow: 1;
            margin-right: 10px;
            min-height: 40px;
            max-height: 100px;
            resize: none;
            align-self: center;
        }

        #send-message-btn {
            padding: 10px 15px;
            font-size: 1.2em;
            width: auto;
        }

        /* Search Screen */
        .search-input-group {
            display: flex;
            margin-bottom: 20px;
        }

        #search-query {
            flex-grow: 1;
            margin-right: 10px;
        }

        .search-results-container h3 {
            margin-top: 25px;
            color: #00ffff;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 5px;
        }

        .search-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #0d2a4a;
            border-radius: 8px;
            border: 1px solid #0f3460;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-user-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #1a1a2e;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-user-item:last-child {
            border-bottom: none;
        }

        .search-user-item:hover {
            background-color: #1a1a2e;
        }

        .search-username {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: bold;
            color: #e0e0e0;
        }

        .search-user-item .follow-btn {
            padding: 5px 10px;
            font-size: 0.9em;
        }

        /* Monetization Screen Styles */
        #monetization-screen .info-card {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #0d2a4a;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.08);
        }
        #monetization-screen .info-card h4 {
            color: #00ffff;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        #monetization-screen .info-card i {
            margin-right: 8px;
            color: #ff00ff;
        }
        #monetization-screen .info-card .btn {
            margin-top: 10px;
            width: auto;
            display: inline-block;
            margin-right: 10px;
        }

        .profile-post-tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .tab-btn {
            flex-grow: 1;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-color-light);
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
        }
        .tab-btn.active {
            color: var(--highlight-color-main);
            border-bottom-color: var(--highlight-color-main);
        }
        #username-availability {
            font-size: 0.8em;
            margin-top: 5px;
            display: block;
        }
        #username-availability.success-text { color: #33ff57; }
        #username-availability.error-text { color: #e74c3c; }


        /* Bottom Navigation */
        .app-bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #0f3460;
            border-top: 1px solid #0d2a4a;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            position: sticky;
            bottom: 0;
            width: 100%;
            z-index: 10;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #888;
            font-size: 0.8em;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .nav-item .icon-wrapper {
            width: 30px;
            height: 30px;
            margin-bottom: 5px;
            position: relative;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid transparent; /* For active state glow */
            transition: border-color 0.3s ease;
        }

        /* Custom Coded Icons for Bottom Nav */
        .home-icon::before { content: '\f015'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 1.4em; color: #e0e0e0; }
        .search-icon::before { content: '\f002'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 1.4em; color: #e0e0e0; }
        .upload-icon::before { content: '\f067'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 1.4em; color: #e0e0e0; } /* Plus Circle */
        .messages-icon::before { content: '\f075'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 1.4em; color: #e0e0e0; } /* Comment Dots */
        .profile-icon::before { content: '\f406'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 1.4em; color: #e0e0e0; } /* User Circle Solid */

        .nav-item.active {
            color: #00ffff;
            transform: translateY(-3px);
        }

        .nav-item.active .icon-wrapper {
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .nav-item.active .icon-wrapper::before {
            color: #00ffff;
        }


        /* Ad Modal */
        #ad-modal .modal-content {
            text-align: center;
        }
        #ad-placeholder {
            background-color: #0d2a4a;
            height: 150px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            border-radius: 8px;
            font-style: italic;
            color: #bbb;
            border: 1px dashed #00ffff;
        }
        #close-ad-modal {
            margin-top: 20px;
        }

        /* Reward Popup */
        .reward-content {
            text-align: center;
        }
        .reward-content h3 {
            color: #33ff57; /* Green for success */
            text-shadow: 0 0 8px rgba(51, 255, 87, 0.6);
            margin-bottom: 15px;
        }
        .reward-content i.fas.fa-trophy {
            font-size: 1.5em;
            margin-left: 10px;
            vertical-align: middle;
        }
        #reward-message {
            font-size: 1.1em;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 80px; /* Above bottom nav */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            font-size: 0.95em;
            min-width: 200px;
            text-align: center;
        }

        .toast-notification.show {
            opacity: 1;
            visibility: visible;
        }
        .toast-notification.error { background-color: #e74c3c; }
        .toast-notification.success { background-color: #27ae60; }
        .toast-notification.info { background-color: #3498db; }


        /* Language Selection Modal */
        #language-select-modal .language-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #0f3460;
            border-radius: 8px;
            background-color: #0d2a4a;
        }
        #language-select-modal .language-option {
            padding: 10px;
            border-radius: 6px;
            background-color: #1a1a2e;
            border: 1px solid #00ffff;
            color: #e0e0e0;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        #language-select-modal .language-option.selected {
            background-color: #00ffff;
            color: #1a1a2e;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }
        #language-select-modal .language-option:hover {
            transform: translateY(-2px);
        }

        /* Animation for shake effect on remix */
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }


        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.6), 0 0 20px rgba(255, 0, 255, 0.4); }
            100% { transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(255, 0, 255, 0.6); }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .app-container, .auth-screen-wrapper {
                border-radius: 0;
                box-shadow: none;
                max-width: 100%;
                height: 100vh; /* Ensure it takes full height on small screens */
            }

            body {
                align-items: flex-start; /* Align to top on small screens */
            }

            .main-content {
                padding: 10px;
            }

            .app-header {
                padding: 10px;
            }

            .app-title {
                font-size: 1.3em;
                margin-left: 10px;
            }

            .status-display {
                font-size: 0.8em;
                padding: 3px 8px;
            }

            .icon-button {
                font-size: 1em;
                margin-left: 10px;
            }

            .app-bottom-nav {
                padding: 8px 0;
            }

            .nav-item {
                font-size: 0.7em;
            }

            .nav-item .icon-wrapper {
                width: 25px;
                height: 25px;
            }

            .home-icon::before, .search-icon::before, .upload-icon::before, .messages-icon::before, .profile-icon::before {
                font-size: 1.2em;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .profile-avatar-large {
                width: 80px;
                height: 80px;
            }

            .profile-avatar-large::before {
                font-size: 45px;
            }

            .profile-stats {
                gap: 15px;
                font-size: 1em;
            }

            .profile-stats span {
                font-size: 1.1em;
            }

            .btn {
                padding: 10px 15px;
                font-size: 1em;
            }

            .profile-actions {
                flex-direction: column;
                align-items: center;
            }
            .profile-actions .btn {
                width: 80%;
            }

            .emoji-picker, .emoji-picker-chat {
                padding: 6px;
                gap: 8px;
            }

            .emoji-option {
                font-size: 1.3em;
            }

            .message-bubble {
                max-width: 90%;
            }

            .toast-notification {
                bottom: 70px;
                font-size: 0.8em;
                min-width: unset;
                width: auto;
                padding: 10px 15px;
            }

            .auth-content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body class="dark-mode"> 
    
    <!-- This paragraph is for JavaScript load testing. It should be the ONLY thing initially visible IF JS loads. -->
    <p id="load-status">Loading Application...</p>

    <!-- Auth Container for Login/Register (Hidden by default, JS will manage display) -->
    <div id="auth-container" class="auth-container hidden">
        <div class="auth-content">
            <div class="app-logo-splash auth-logo"></div> <h1>AddMint</h1>
            <section id="login-screen" class="auth-screen active">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="login-password" placeholder="Enter your password">
                        <span class="password-toggle" data-target="login-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <button class="btn primary-btn" id="login-btn">Login</button>
                <p class="auth-text">
                    <a href="#" id="forgot-password-link">Forgot Password?</a>
                </p>
                <p class="auth-text">Don't have an account? <a href="#" id="show-signup">Register</a></p>
                <p id="login-status" class="status-message"></p>
            </section>

            <section id="signup-screen" class="auth-screen">
                <h2>Register</h2>
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <input type="email" id="signup-email" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="signup-password" placeholder="Create a password">
                        <span class="password-toggle" data-target="signup-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password:</label>
                    <div class="password-input-group">
                        <input type="password" id="signup-confirm-password" placeholder="Confirm your password">
                        <span class="password-toggle" data-target="signup-confirm-password"><i class="fas fa-eye"></i></span>
                    </div>
                </div>
                <button class="btn primary-btn" id="signup-btn">Register</button>
                <p class="auth-text">Already have an account? <a href="#" id="show-login">Login</a></p>
                <p id="signup-status" class="status-message"></p>
            </section>
        </div>
    </div>


    <div id="forgot-password-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Reset Password</h3>
            <p>Enter your email address to receive a password reset link.</p>
            <div class="form-group">
                <label for="reset-email">Email:</label>
                <input type="email" id="reset-email" placeholder="Your email address">
            </div>
            <button class="btn primary-btn" id="send-reset-email-btn">Send Reset Link</button>
            <p id="reset-status" class="status-message"></p>
            <button class="btn secondary-btn" id="close-reset-modal">Cancel</button>
        </div>
    </div>


    <!-- Main Application Container (Hidden by default, JS will manage display) -->
    <div id="app-container" class="app-container hidden">

        <header class="app-header">
            <div class="header-left">
                <div class="menu-icon" id="menu-toggle">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
                <div class="app-title">AddMint</div>
            </div>
            <div class="header-center">
                <div class="status-display">
                    <span id="header-coins" class="clickable-stat" data-resource-type="coins">0 C</span> |
                    <span id="header-credits" class="clickable-stat" data-resource-type="credits">0 Cr</span> |
                    <span id="header-limit" class="clickable-stat" data-resource-type="limit">0 L</span> |
                    <span id="header-mint" class="clickable-stat" data-resource-type="mint">0 M</span>
                </div>
            </div>
            <div class="header-right">
                <div class="icon-button" id="refresh-posts-btn" title="Refresh Feed">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="icon-button" id="gift-claim-btn" title="Claim Daily Reward">
                    <i class="fas fa-gift"></i>
                </div>
            </div>
        </header>

        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="profile-avatar-small" id="sidebar-profile-avatar"></div>
                <h3 id="sidebar-username">My User</h3> 
                <div class="close-sidebar" id="close-sidebar">&times;</div>
            </div>
            <ul>
                <li><a href="#" data-screen="home"><i class="fas fa-home"></i> Home Feed</a></li>
                <li><a href="#" data-screen="feed"><i class="fas fa-stream"></i> Immersive Feed</a></li>
                <li><a href="#" data-screen="profile"><i class="fas fa-user-circle"></i> My Profile</a></li>
                <li><a href="#" data-screen="upload"><i class="fas fa-plus-circle"></i> Upload Post</a></li>
                <li><a href="#" data-screen="messages"><i class="fas fa-comments"></i> Messages</a></li>
                <li><a href="#" data-screen="search"><i class="fas fa-search"></i> Search Users</a></li>
                <li><a href="#" data-screen="monetization"><i class="fas fa-dollar-sign"></i> Earn & Boost</a></li>
                <li><a href="#" id="data-saver-link"><i class="fas fa-wifi"></i> Data Saver <span class="toggle-switch"><input type="checkbox" id="data-saver-checkbox"><label for="data-saver-checkbox"></label></span></a></li>
                <li><a href="#" id="dark-mode-link"><i class="fas fa-moon"></i> Dark Mode <span class="toggle-switch"><input type="checkbox" id="dark-mode-checkbox" checked><label for="dark-mode-checkbox"></label></span></a></li>
                <li><a href="https://www.instagram.com/addmint__" target="_blank"><i class="fab fa-instagram"></i> Our Instagram</a></li>
                <li><a href="https://www.youtube.com/@add_mintmint" target="_blank"><i class="fab fa-youtube"></i> Our YouTube</a></li>
                <li><a href="#" data-screen="about"><i class="fas fa-info-circle"></i> About Us</a></li>
                <li><a href="#" data-screen="privacy"><i class="fas fa-shield-alt"></i> Privacy Policy</a></li>
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <section id="home-screen" class="app-screen active">
                <h2>Recent Posts</h2>
                 <div class="category-filter">
                    <select id="post-category-filter">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div id="posts-feed" class="posts-feed">
                    </div>
                <div id="loading-spinner" class="loader hidden"></div>
            </section>

            <section id="feed-screen" class="app-screen">
                <h2>Immersive Feed</h2>
                <div id="immersive-feed" class="immersive-feed">
                    <!-- Posts will be loaded here with snap scrolling -->
                </div>
                <div id="feed-loading-spinner" class="loader hidden"></div>
            </section>

            <section id="profile-screen" class="app-screen">
                <div id="user-profile-display">
                    <div class="profile-header-area">
                        <div class="profile-avatar-large" id="my-profile-avatar"></div>
                        <h2 id="my-profile-username">@myusername</h2>
                        <p id="my-profile-name" class="profile-name"></p>
                        <p id="my-profile-bio" class="profile-bio"></p>
                        <div class="profile-stats">
                            <div><span id="my-posts-count">0</span> Posts</div>
                            <div class="clickable-stat" data-stat="followers"><span id="my-followers-count">0</span> Followers</div>
                            <div class="clickable-stat" data-stat="following"><span id="my-following-count">0</span> Following</div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn primary-btn" id="edit-profile-btn"><i class="fas fa-edit"></i> Edit Profile</button>
                            <button class="btn secondary-btn hidden" id="follow-user-btn"><i class="fas fa-user-plus"></i> Follow</button>
                            <button class="btn danger-btn hidden" id="unfollow-user-btn"><i class="fas fa-user-minus"></i> Unfollow</button>
                            <button class="btn primary-btn hidden" id="message-user-btn"><i class="fas fa-paper-plane"></i> Message</button>
                            <a href="#" id="profile-whatsapp-link" class="btn social-btn hidden" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                            <a href="#" id="profile-instagram-link" class="btn social-btn hidden" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
                        </div>
                    </div>

                    <div id="edit-profile-modal" class="modal hidden">
                        <div class="modal-content">
                            <h3>Edit Profile</h3>
                            <p id="profile-modal-instruction" class="status-message info"></p> <!-- Status for edit modal -->
                            <div class="form-group">
                                <label for="edit-username">Username:</label>
                                <input type="text" id="edit-username" placeholder="Enter new username">
                                <span id="username-availability"></span>
                            </div>
                            <div class="form-group">
                                <label for="edit-name">Display Name:</label>
                                <input type="text" id="edit-name" placeholder="Enter your display name">
                            </div>
                            <div class="form-group">
                                <label for="edit-bio">Bio (Optional):</label>
                                <textarea id="edit-bio" placeholder="Tell us about yourself..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="edit-whatsapp">WhatsApp (Optional):</label>
                                <input type="text" id="edit-whatsapp" placeholder="e.g., +919876543210">
                            </div>
                            <div class="form-group">
                                <label for="edit-instagram">Instagram ID (Optional):</label>
                                <input type="text" id="edit-instagram" placeholder="e.g., my_insta_id">
                            </div>
                            <div class="form-group">
                                <label for="profile-pic-url-input">Direct Profile Picture URL (Optional):</label>
                                <input type="text" id="profile-pic-url-input" placeholder="e.g., https://example.com/mypic.jpg">
                                <small>Enter a direct image link (like from imgbb.com).</small>
                            </div>
                            <div class="form-group">
                                <label>Or Choose a Profile Logo:</label>
                                <div id="profile-logo-options" class="logo-options-grid">
                                    </div>
                            </div>
                            <div class="form-group">
                                <label for="account-privacy-toggle">Account Privacy:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="account-privacy-toggle">
                                    <label for="account-privacy-toggle"></label>
                                </div>
                                <span id="account-privacy-status">Public</span>
                            </div>
                            <p id="save-profile-status" class="status-message"></p> <!-- Status for Save Changes button -->
                            <button class="btn primary-btn" id="save-profile-btn">Save Changes</button>
                            <button class="btn secondary-btn" id="cancel-edit-profile-btn">Cancel</button>
                        </div>
                    </div>

                    <div id="follow-list-modal" class="modal hidden">
                        <div class="modal-content">
                            <h3 id="follow-list-title"></h3>
                            <div id="follow-list-content">
                                </div>
                            <button class="btn secondary-btn" id="close-follow-list-modal">Close</button>
                        </div>
                    </div>

                    <div class="profile-posts-area">
                        <h3>Posts by <span id="current-profile-username-posts">Me</span></h3>
                        <div class="profile-post-tabs">
                            <button class="btn tab-btn active" data-tab="posts">My Posts</button>
                            <button class="btn tab-btn" data-tab="reposts">My Reposts</button>
                        </div>
                        <div id="profile-posts-feed" class="posts-feed">
                            </div>
                        <div id="profile-reposts-feed" class="posts-feed hidden">
                            </div>
                    </div>
                </div>
            </section>

            <section id="upload-screen" class="app-screen">
                <h2>Upload New Post</h2>
                <div class="form-group">
                    <label for="post-category">Category:</label>
                    <select id="post-category">
                       <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div class="form-group rich-text-editor">
                    <label for="post-content">Post Content:</label>
                    <div class="editor-toolbar">
                        <button type="button" class="tool-btn" data-command="bold"><i class="fas fa-bold"></i></button>
                        <button type="button" class="tool-btn" data-command="italic"><i class="fas fa-italic"></i></button>
                        <button type="button" class="tool-btn" data-command="insertImage"><i class="fas fa-image"></i></button>
                        <button type="button" class="tool-btn" data-command="insertYoutube"><i class="fab fa-youtube"></i></button>
                        <button type="button" class="tool-btn" data-command="insertLink"><i class="fas fa-link"></i></button>
                    </div>
                    <textarea id="post-content-input" placeholder="What's on your mind? Use **bold**, *italic*, [link text](http://url.com), ![image alt](http://image.url), ![youtube video](http://youtube.com/watch?v=VIDEO_ID)"></textarea>
                    <small>Min 60, Max 10000 characters.</small>
                </div>
                <div class="form-group">
                    <label for="post-boost">Post will be active for:</label>
                    <select id="post-boost" disabled>
                        <option value="24">24 Hours (Free)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="monetize-post-checkbox">Monetize this post?</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="monetize-post-checkbox">
                        <label for="monetize-post-checkbox"></label>
                    </div>
                    <small>Earn from views on monetized posts.</small>
                </div>
                <button class="btn primary-btn" id="publish-post-btn">Publish Post</button>
                <p id="upload-status" class="status-message"></p>
            </section>

            <section id="messages-screen" class="app-screen">
                <h2>Messages</h2>
                <div id="message-list-container">
                    <h3>Recent Chats</h3>
                    <ul id="recent-chats-list" class="recent-chats-list">
                        </ul>
                </div>

                <div id="chat-window-container" class="chat-window-container hidden">
                    <div class="chat-header">
                        <button id="back-to-chats-btn" class="icon-button"><i class="fas fa-arrow-left"></i></button>
                        <div class="profile-avatar small" id="chat-partner-avatar"></div>
                        <span id="chat-partner-username">@ChatUser</span>
                    </div>
                    <div id="chat-messages" class="chat-messages">
                        </div>
                    <div class="chat-input-area">
                        <textarea id="message-input" placeholder="Type your message..."></textarea>
                        <button id="send-message-btn" class="btn primary-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                    <div class="emoji-picker-chat hidden">
                        <span class="emoji-option" data-emoji="👍">👍</span>
                        <span class="emoji-option" data-emoji="❤️">❤️</span>
                        <span class="emoji-option" data-emoji="😂">😂</span>
                        <span class="emoji-option" data-emoji="😢">😢</span>
                        <span class="emoji-option" data-emoji="🔥">🔥</span>
                    </div>
                </div>
            </section>

            <section id="search-screen" class="app-screen">
                <h2>Search Users & Posts</h2>
                <div class="search-input-group">
                    <input type="text" id="search-query" placeholder="Search by username, keyword...">
                    <button class="btn primary-btn" id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div id="search-results" class="search-results-container">
                    <h3>Users</h3>
                    <ul id="search-user-list" class="search-list">
                        </ul>
                    <h3>Posts</h3>
                    <div id="search-post-list" class="posts-feed">
                        </div>
                    <div id="no-search-results" class="hidden">No results found.</div>
                </div>
            </section>

             <section id="monetization-screen" class="app-screen">
                <h2>Earn & Boost</h2>
                <div class="info-card">
                    <h4><i class="fas fa-coins"></i> My Mint Balance</h4>
                    <p>Total Estimated Earnings: <strong id="monetization-earnings">0.00 M</strong></p>
                    <p><small>1,000 Mint can be withdrawn for rewards. Mint is earned from views on your monetized posts.</small></p>
                    <button class="btn primary-btn" id="withdraw-btn">Withdraw Mint</button>
                </div>
                <div class="info-card">
                    <h4><i class="fas fa-rocket"></i> My Resources</h4>
                    <p>Track your available resources for posting and messaging.</p>
                     <div class="profile-stats">
                        <div><span id="monetization-coins">0</span> Coins</div>
                        <div><span id="monetization-credits">0</span> Credits</div>
                        <div><span id="monetization-limits">0</span> Limits</div>
                    </div>
                </div>
                 <div class="info-card">
                    <h4><i class="fas fa-ad"></i> Earn More</h4>
                    <p>Watch short ads to earn more resources for free!</p>
                    <button class="btn secondary-btn" id="earn-coins-btn">Earn Coins</button>
                    <button class="btn secondary-btn" id="earn-credits-btn">Earn Credits</button>
                    <button class="btn secondary-btn" id="earn-limits-btn">Earn Limits</button>
                </div>
            </section>

            <section id="about-screen" class="app-screen">
                <h2>About AddMint</h2>
                <p>AddMint is a revolutionary social media platform designed to connect people through shared interests and engaging content. We believe in fostering a positive and vibrant community where every voice can be heard.</p>
                <p>Our mission is to provide a seamless and professional experience for all users, offering unique features like dynamic post feeds, real-time messaging, and interactive user profiles.</p>
                <p>For support or inquiries, please contact us at support@addmint.com.</p>
            </section>

            <section id="privacy-screen" class="app-screen">
                <h2>Privacy Policy</h2>
                <p>Your privacy is paramount to us at AddMint. This policy outlines how we collect, use, and protect your personal information.</p>
                <h3>Information We Collect:</h3>
                <ul>
                    <li><strong>Account Information:</strong> Username, email, password (hashed).</li>
                    <li><strong>Profile Information:</strong> Optional WhatsApp number, Instagram ID, chosen profile logo.</li>
                    <li><strong>Content Data:</strong> Posts, messages, likes, reactions, views.</li>
                    <li><strong>Usage Data:</strong> Interactions with the app, features used, and technical data (e.g., device type).</li>
                </ul>
                <h3>How We Use Your Information:</h3>
                <ul>
                    <li>To provide and maintain our services.</li>
                    <li>To personalize your experience and show relevant content.</li>
                    <li>To communicate with you regarding updates, security alerts, and support.</li>
                    <li>To monitor and analyze usage patterns for service improvement.</li>
                    <li>To enforce our terms and conditions and prevent misuse.</li>
                </ul>
                <h3>Data Sharing:</h3>
                <p>We do not share your personal information with third parties except as necessary to provide our services, comply with legal obligations, or with your explicit consent.</p>
                <h3>Data Security:</h3>
                <p>We implement robust security measures, including encryption and access controls, to protect your data. However, no internet transmission is 100% secure.</p>
                <h3>Your Choices:</h3>
                <ul>
                    <li>You can update your profile information at any time.</li>
                    <li>You can delete your account by contacting support.</li>
                    <li>You can control notification preferences.</li>
                </ul>
                <p>By using AddMint, you agree to the terms of this Privacy Policy. We may update this policy periodically, and we will notify you of any significant changes.</p>
            </section>
        </main>

        <footer class="app-bottom-nav">
            <a href="#" class="nav-item active" data-screen="home">
                <div class="icon-wrapper home-icon"></div>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-screen="search">
                <div class="icon-wrapper search-icon"></div>
                <span>Search</span>
            </a>
            <a href="#" class="nav-item" data-screen="upload">
                <div class="icon-wrapper upload-icon"></div>
                <span>Upload</span>
            </a>
            <a href="#" class="nav-item" data-screen="messages">
                <div class="icon-wrapper messages-icon"></div>
                <span>Messages</span>
            </a>
            <a href="#" class="nav-item" data-screen="profile">
                <div class="icon-wrapper profile-icon"></div>
                <span>Profile</span>
            </a>
        </footer>

        <div id="ad-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Watch an Advertisement</h3>
                <p>Please watch a short ad to claim your reward.</p>
                <div id="ad-placeholder">
                    <p>Simulating Ad (5 seconds)...</p>
                </div>
                <button class="btn secondary-btn" id="close-ad-modal" disabled>Close Ad</button>
            </div>
        </div>

        <div id="reward-popup" class="modal hidden">
            <div class="modal-content reward-content">
                <h3>Reward Claimed! <i class="fas fa-trophy"></i></h3>
                <p id="reward-message"></p>
                <button class="btn primary-btn" id="close-reward-popup">Great!</button>
            </div>
        </div>

        <div id="withdraw-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Withdraw Mint</h3>
                <p><strong>Minimum withdrawal: 1,000 Mint</strong></p>
                <p>Your current Mint balance: <strong id="current-mint-balance">0 M</strong></p>
                <div class="form-group">
                    <label for="withdraw-paypal-email">PayPal Email:</label>
                    <input type="email" id="withdraw-paypal-email" placeholder="Enter your PayPal email">
                </div>
                <div class="form-group">
                    <label for="withdraw-real-name">Your Full Name:</label>
                    <input type="text" id="withdraw-real-name" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="withdraw-age">Your Age:</label>
                    <input type="number" id="withdraw-age" placeholder="Your age">
                </div>
                <div class="form-group">
                    <label for="withdraw-dob">Date of Birth:</label>
                    <input type="date" id="withdraw-dob">
                </div>
                <p style="font-size: 0.9em; color: #bbb;">Your payment will be processed within 1-15 business days.</p>
                <button class="btn primary-btn" id="confirm-withdraw-btn">Confirm Withdrawal</button>
                <button class="btn secondary-btn" id="close-withdraw-modal">Cancel</button>
                <p style="font-size: 0.8em; color: #aaa; margin-top: 15px;">Note: This process is simulated in this demo. Real withdrawals require a secure backend service.</p>
            </div>
        </div>

        <!-- Language Selection Modal for Translate -->
        <div id="language-select-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Select Translation Language</h3>
                <div class="language-options">
                    <!-- Options will be dynamically added by JavaScript -->
                </div>
                <button class="btn primary-btn" id="save-language-btn">Save Language</button>
                <button class="btn secondary-btn" id="cancel-language-btn">Cancel</button>
            </div>
        </div>

        <div id="toast-notification" class="toast-notification"></div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script>
        /* JavaScript starts here (copied from script.js) */

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDlZA4grzF3fx95-11E4s7ASXwkIij1k1w",
            authDomain: "addmint-7ab6b.firebaseapp.com",
            databaseURL: "https://addmint-7ab6b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "addmint-7ab6b",
            storageBucket: "addmint-7ab6b.appspot.com",
            messagingSenderId: "504015450137",
            appId: "1:504015450137:web:694b176313582cce1e7a88",
            measurementId: "G-H7J7M23Z82"
        };

        // Initialize Firebase (add basic error handling)
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            const loadStatusElement = document.getElementById('load-status');
            if (loadStatusElement) {
                loadStatusElement.textContent = "Critical Error: App failed to initialize. Check console & network.";
                loadStatusElement.style.backgroundColor = "red";
            }
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // --- DOM Elements ---
        const body = document.body;
        const loadStatusElement = document.getElementById('load-status'); 
        const authContainer = document.getElementById('auth-container'); 
        const appContainer = document.getElementById('app-container'); 

        // Auth Screens Elements
        const loginScreen = document.getElementById('login-screen');
        const signupScreen = document.getElementById('signup-screen');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const loginStatus = document.getElementById('login-status');
        const showSignupLink = document.getElementById('show-signup');
        const passwordToggles = document.querySelectorAll('.password-toggle');

        const signupEmailInput = document.getElementById('signup-email');
        const signupPasswordInput = document.getElementById('signup-password');
        const signupConfirmPasswordInput = document.getElementById('signup-confirm-password');
        const signupBtn = document.getElementById('signup-btn');
        const signupStatus = document.getElementById('signup-status');
        const showLoginLink = document.getElementById('show-login');

        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const resetEmailInput = document.getElementById('reset-email');
        const sendResetEmailBtn = document.getElementById('send-reset-email-btn');
        const resetStatus = document.getElementById('reset-status');
        const closeResetModalBtn = document.getElementById('close-reset-modal');


        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const mainContent = document.querySelector('.main-content');
        const bottomNavItems = document.querySelectorAll('.app-bottom-nav .nav-item');
        const screenSections = document.querySelectorAll('.app-screen');
        
        const refreshPostsBtn = document.getElementById('refresh-posts-btn');
        const postsFeed = document.getElementById('posts-feed');
        const loadingSpinner = document.getElementById('loading-spinner');


        // Post Upload Screen elements
        const uploadScreen = document.getElementById('upload-screen');
        const postCategorySelect = document.getElementById('post-category');
        const postContentInput = document.getElementById('post-content-input');
        const postBoostSelect = document.getElementById('post-boost');
        const monetizePostCheckbox = document.getElementById('monetize-post-checkbox');
        const publishPostBtn = document.getElementById('publish-post-btn');
        const uploadStatus = document.getElementById('upload-status');

        // Profile Screen elements
        const myProfileAvatar = document.getElementById('my-profile-avatar');
        const myProfileUsername = document.getElementById('my-profile-username');
        const myProfileName = document.getElementById('my-profile-name');
        const myProfileBio = document.getElementById('my-profile-bio');
        const myPostsCount = document.getElementById('my-posts-count');
        const myFollowersCount = document.getElementById('my-followers-count');
        const myFollowingCount = document.getElementById('my-following-count');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const followUserBtn = document.getElementById('follow-user-btn');
        const unfollowUserBtn = document.getElementById('unfollow-user-btn');
        const messageUserBtn = document.getElementById('message-user-btn');
        const profileWhatsappLink = document.getElementById('profile-whatsapp-link');
        const profileInstagramLink = document.getElementById('profile-instagram-link');
        const currentProfileUsernamePosts = document.getElementById('current-profile-username-posts');
        const profilePostsFeed = document.getElementById('profile-posts-feed');
        const profileRepostsFeed = document.getElementById('profile-reposts-feed');
        const profilePostTabs = document.querySelectorAll('.profile-post-tabs .tab-btn');

        const editProfileModal = document.getElementById('edit-profile-modal');
        const profileModalInstruction = document.getElementById('profile-modal-instruction');
        const saveProfileStatus = document.getElementById('save-profile-status');
        const editUsernameInput = document.getElementById('edit-username');
        const usernameAvailability = document.getElementById('username-availability');
        const editNameInput = document.getElementById('edit-name');
        const editBioInput = document.getElementById('edit-bio');
        const editWhatsappInput = document.getElementById('edit-whatsapp');
        const editInstagramInput = document.getElementById('edit-instagram');
        const profilePicUrlInput = document.getElementById('profile-pic-url-input');
        const profileLogoOptions = document.getElementById('profile-logo-options');
        const accountPrivacyToggle = document.getElementById('account-privacy-toggle');
        const accountPrivacyStatus = document.getElementById('account-privacy-status');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const cancelEditProfileBtn = document.getElementById('cancel-edit-profile-btn');

        const followListModal = document.getElementById('follow-list-modal');
        const followListTitle = document.getElementById('follow-list-title');
        const followListContent = document.getElementById('follow-list-content');
        const closeFollowListModalBtn = document.getElementById('close-follow-list-modal');

        // Messaging Screen elements
        const messageListContainer = document.getElementById('message-list-container');
        const recentChatsList = document.getElementById('recent-chats-list');
        const chatWindowContainer = document.getElementById('chat-window-container');
        const chatPartnerUsername = document.getElementById('chat-partner-username');
        const chatPartnerAvatar = document.getElementById('chat-partner-avatar');
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message-btn');
        const backToChatsBtn = document.getElementById('back-to-chats-btn');

        // Search Screen elements
        const searchQueryInput = document.getElementById('search-query');
        const searchBtn = document.getElementById('search-btn');
        const searchUserList = document.getElementById('search-user-list');
        const searchPostList = document.getElementById('search-post-list');
        const noSearchResults = document.getElementById('no-search-results');

        // Monetization Screen Elements
        const monetizationEarnings = document.getElementById('monetization-earnings');
        const monetizationCoins = document.getElementById('monetization-coins');
        const monetizationCredits = document.getElementById('monetization-credits');
        const monetizationLimits = document.getElementById('monetization-limits');
        const withdrawBtn = document.getElementById('withdraw-btn');
        const earnCoinsBtn = document.getElementById('earn-coins-btn');
        const earnCreditsBtn = document.getElementById('earn-credits-btn');
        const earnLimitsBtn = document.getElementById('earn-limits-btn');
        
        // Header resource displays
        const headerCoins = document.getElementById('header-coins');
        const headerCredits = document.getElementById('header-credits');
        const headerLimit = document.getElementById('header-limit');
        const headerMint = document.getElementById('header-mint');

        // Modals & Popups
        const adModal = document.getElementById('ad-modal');
        const closeAdModalBtn = document.getElementById('close-ad-modal');
        const rewardPopup = document.getElementById('reward-popup');
        const rewardMessage = document.getElementById('reward-message');
        const closeRewardPopupBtn = document.getElementById('close-reward-popup');
        const withdrawModal = document.getElementById('withdraw-modal');
        const currentMintBalance = document.getElementById('current-mint-balance');
        const withdrawPaypalEmail = document.getElementById('withdraw-paypal-email');
        const withdrawRealName = document.getElementById('withdraw-real-name');
        const withdrawAge = document.getElementById('withdraw-age');
        const withdrawDob = document.getElementById('withdraw-dob');
        const confirmWithdrawBtn = document.getElementById('confirm-withdraw-btn');
        const closeWithdrawModalBtn = document.getElementById('close-withdraw-modal');

        // Language Selection Modal for Translate
        const languageSelectModal = document.getElementById('language-select-modal');
        const languageOptionsContainer = document.querySelector('#language-select-modal .language-options');
        const saveLanguageBtn = document.getElementById('save-language-btn');
        const cancelLanguageBtn = document.getElementById('cancel-language-btn');
        
        // Sidebar Toggles
        const darkModeCheckbox = document.getElementById('dark-mode-checkbox');
        const dataSaverCheckbox = document.getElementById('data-saver-checkbox');

        // Other UI
        const giftClaimBtn = document.getElementById('gift-claim-btn');
        const toastNotification = document.getElementById('toast-notification');
        const postCategoryFilter = document.getElementById('post-category-filter');

        // --- Global Variables & Flags ---
        let currentUser = null; 
        let currentProfileViewingId = null;
        let currentChatPartnerId = null;
        let lastVisiblePost = null; 
        let fetchingPosts = false; 
        let postsToLoadPerScroll = 10; 
        let dataSaverEnabled = false; 
        let userSelectedTranslationLanguage = 'en';
        let currentSpeaker = null; 
        let unsubscribeFromChat = null;
        let isProcessingAuth = false;
        let hasRunInitialAuthCheck = false;
        let splashScreenTimeout;
        let currentAdPurpose = '';
        let adRewardDetails = {};
        
        // --- Profile Logos Data ---
        const PROFILE_LOGOS = [
            { class: 'logo-1', emoji: '🧑', color: '#ff6347' }, { class: 'logo-2', emoji: '👩', color: '#6a5acd' }, { class: 'logo-3', emoji: '🚀', color: '#32cd32' },
            { class: 'logo-4', emoji: '💡', color: '#ff8c00' }, { class: 'logo-5', emoji: '🌟', color: '#ffd700' }, { class: 'logo-6', emoji: '🌈', color: '#9932cc' },
            { class: 'logo-7', emoji: '🦊', color: '#d2691e' }, { class: 'logo-8', emoji: '🐼', color: '#6495ed' }, { class: 'logo-9', emoji: '🦋', color: '#dda0dd' },
            { class: 'logo-10', emoji: '🐢', color: '#20b2aa' }, { class: 'logo-11', emoji: '🤖', color: '#87ceeb' }, { class: 'logo-12', emoji: '👽', color: '#7cfc00' },
            { class: 'logo-13', emoji: '🦄', color: '#ee82ee' }, { class: 'logo-14', emoji: '🐉', color: '#48d1cc' }, { class: 'logo-15', emoji: '🌊', color: '#4682b4' },
            { class: 'logo-16', emoji: '🔥', color: '#dc143c' }, { class: 'logo-17', emoji: '👑', color: '#f0e68c' }, { class: 'logo-18', emoji: '💎', color: '#00ced1' },
            { class: 'logo-19', emoji: '🔑', color: '#b0e0e6' }, { class: 'logo-20', emoji: '⚡', color: '#ffff00' }, { class: 'logo-21', emoji: '🎵', color: '#ff69b4' },
            { class: 'logo-22', emoji: '🎨', color: '#7b68ee' }, { class: 'logo-23', emoji: '🧩', color: '#ffa07a' }, { class: 'logo-24', emoji: '🍔', color: '#cd853f' },
            { class: 'logo-25', emoji: '🍕', color: '#f08080' }, { class: 'logo-26', emoji: '🎮', color: '#c0c0c0' }, { class: 'logo-27', emoji: '✈️', color: '#afeeee' },
            { class: 'logo-28', emoji: '🌳', color: '#228b22' }, { class: 'logo-29', emoji: '🌸', color: '#ffb6c1' }, { class: 'logo-30', emoji: '⚽', color: '#b0c4de' },
            { class: 'logo-31', emoji: '🎸', color: '#8b4513' }, { class: 'logo-32', emoji: '🚲', color: '#00fa9a' }, { class: 'logo-33', emoji: '📚', color: '#deb887' },
            { class: 'logo-34', emoji: '☕', color: '#d2b48c' }, { class: 'logo-35', emoji: '🎁', color: '#f4a460' }, { class: 'logo-36', emoji: '🎉', color: '#ba55d3' },
            { class: 'logo-37', emoji: '🌍', color: '#87cefa' }, { class: 'logo-38', emoji: '🔬', color: '#778899' }, { class: 'logo-39', emoji: '🔭', color: '#696969' },
            { class: 'logo-40', emoji: '🛠️', color: '#d3d3d3' }, { class: 'logo-41', emoji: '⚖️', color: '#add8e6' }, { class: 'logo-42', emoji: '💰', color: '#b8860b' },
            { class: 'logo-43', emoji: '🛡️', color: '#5f9ea0' }, { class: 'logo-44', emoji: '🔔', color: '#f0f8ff' }, { class: 'logo-45', emoji: '⏳', color: '#fa8072' },
            { class: 'logo-46', emoji: '💾', color: '#3cb371' }, { class: 'logo-47', emoji: '⚙️', color: '#4682b4' }, { class: 'logo-48', emoji: '📡', color: '#2e8b57' },
            { class: 'logo-49', emoji: '🌐', color: '#a52a2a' }, { class: 'logo-50', emoji: '📈', color: '#c71585' }
        ];

        // --- Utility Functions ---
        function showToast(message, type = 'info', duration = 3000) {
            toastNotification.textContent = message;
            toastNotification.className = `toast-notification show ${type}`;
            setTimeout(() => {
                toastNotification.className = 'toast-notification';
            }, duration);
        }

        function updateAuthStatus(element, message, type) {
            if (element) {
                element.textContent = message;
                element.className = `status-message ${type}`;
                element.style.display = (type === 'hidden' || !message) ? 'none' : 'block';
            }
        }

        function formatNumber(num) {
            if (num === undefined || num === null) return 0;
            if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            return num;
        }

        function showScreen(screenId) {
            screenSections.forEach(screen => screen.classList.remove('active'));
            const activeScreen = document.getElementById(screenId);
            if(activeScreen) activeScreen.classList.add('active');

            bottomNavItems.forEach(item => {
                item.classList.toggle('active', item.dataset.screen === screenId.replace('-screen', ''));
            });
            sidebar.classList.remove('open');
        }

        function getRandomLogoClass() {
            const randomIndex = Math.floor(Math.random() * PROFILE_LOGOS.length);
            return PROFILE_LOGOS[randomIndex].class;
        }

        function getLogoCssClass(logoName) {
            return `user-logo-${logoName}`;
        }

        function applyLogoStyles() {
            let dynamicStyles = '';
            PROFILE_LOGOS.forEach(logo => {
                const className = getLogoCssClass(logo.class);
                dynamicStyles += `
                    .profile-avatar.${className}, .profile-avatar-large.${className}, .profile-avatar-small.${className}, .logo-option-item.${className} { 
                        background-color: ${logo.color}; 
                    }
                    .profile-avatar.${className}::before, .logo-option-item.${className}::before { content: '${logo.emoji}'; font-size: 24px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--button-primary-text); }
                    .profile-avatar-large.${className}::before { content: '${logo.emoji}'; font-size: 60px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--button-primary-text); }
                    .profile-avatar-small.${className}::before { content: '${logo.emoji}'; font-size: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--button-primary-text); }
                `;
            });
            const styleElement = document.createElement('style');
            styleElement.innerHTML = dynamicStyles;
            document.head.appendChild(styleElement);
        }
        
        const POST_CATEGORIES = [
            "All Categories", "Breaking News", "Trending News", "Top Stories", "National News", "International News",
            "Politics", "Economy", "Business", "Finance", "Stock Market", "Technology", "Science", "Environment",
            "Entertainment", "Movies", "TV Shows", "Music", "Celebrity Gossip", "Lifestyle", "Fashion", "Beauty & Grooming",
            "Food & Recipes", "Travel & Tourism", "Sports", "Cricket", "Football", "Tennis", "Olympics", "Esports",
            "Health & Fitness", "Yoga & Meditation", "Education", "Career & Jobs", "Startup & Entrepreneurship",
            "Automobile", "Real Estate", "Religion & Spirituality", "History & Culture", "Regional News (State-wise)",
            "Weather Updates", "Opinion & Editorials", "Viral & Social Media Trends", "General"
        ];
        
        function populateCategorySelects() {
            const selects = [postCategoryFilter, postCategorySelect];
            selects.forEach(select => {
                if(select) {
                    select.innerHTML = '';
                    POST_CATEGORIES.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category === "All Categories" ? "all" : category;
                        option.textContent = category;
                        select.appendChild(option);
                    });
                }
            });
        }


        // --- Core Authentication Flow & UI Management ---

        function showAuthContainerUI() {
            appContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            showAuthScreen('login');
        }

        function showAppContainerUI() {
            authContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
        }
        
        function showAuthScreen(screenName) {
             loginScreen.classList.toggle('active', screenName === 'login');
             signupScreen.classList.toggle('active', screenName === 'signup');
             updateAuthStatus(loginStatus, '', 'hidden');
             updateAuthStatus(signupStatus, '', 'hidden');
        }
        
        async function sendEmailVerification(user) {
            try {
                await user.sendEmailVerification();
                console.log("Verification email sent.");
            } catch(error) {
                console.error("Error sending verification email:", error);
                showToast("Could not send verification email. Please try again.", "error");
            }
        }


        async function checkUserAndRedirect(user) {
            clearTimeout(splashScreenTimeout);
            if (hasRunInitialAuthCheck && user === auth.currentUser) return;
            hasRunInitialAuthCheck = true;
            
            if (loadStatusElement) loadStatusElement.style.display = 'none';

            if (user && user.emailVerified) {
                currentUser = user;
                try {
                    const userDocRef = db.collection('users').doc(currentUser.uid);
                    const userDoc = await userDocRef.get();
                    
                    if (!userDoc.exists || !userDoc.data().username || !userDoc.data().name) {
                        showAppContainerUI();
                        showScreen('profile-screen');
                        editProfileModal.classList.remove('hidden');
                        profileModalInstruction.textContent = "Welcome! Please complete your profile to continue.";
                        myProfileUsername.textContent = "@NewUser";
                        document.getElementById('sidebar-username').textContent = "New User";
                        showToast("Please complete your profile.", 'info', 7000);
                        // Make cancel button log user out
                        cancelEditProfileBtn.onclick = () => {
                           auth.signOut();
                           editProfileModal.classList.add('hidden');
                        };
                    } else {
                        cancelEditProfileBtn.onclick = () => editProfileModal.classList.add('hidden'); // Restore normal functionality
                        await loadUserData(currentUser.uid);
                        showAppContainerUI();
                        showScreen('home-screen');
                        loadPosts();
                    }
                } catch (firestoreError) {
                    console.error("Firestore error during profile load:", firestoreError);
                    showToast("Error loading user profile. Logging out.", 'error', 8000);
                    auth.signOut();
                }
            } else {
                currentUser = null;
                showAuthContainerUI();
                if (user && !user.emailVerified) {
                    updateAuthStatus(loginStatus, "Please verify your email. Check your inbox for a link, then log in.", 'info');
                    auth.signOut();
                }
            }
        }

        auth.onAuthStateChanged(checkUserAndRedirect);
        
        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const targetId = toggle.dataset.target;
                const targetInput = document.getElementById(targetId);
                const icon = toggle.querySelector('i');

                if (targetInput.type === 'password') {
                    targetInput.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    targetInput.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
        });

        showSignupLink.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('signup'); });
        showLoginLink.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('login'); });
        forgotPasswordLink.addEventListener('click', (e) => { e.preventDefault(); forgotPasswordModal.classList.remove('hidden'); });
        closeResetModalBtn.addEventListener('click', () => forgotPasswordModal.classList.add('hidden'));

        async function signInUser() {
            if (isProcessingAuth) return;
            isProcessingAuth = true;
            loginBtn.disabled = true;

            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();

            if (!email || !password) {
                updateAuthStatus(loginStatus, "Please enter both email and password.", 'error');
                isProcessingAuth = false;
                loginBtn.disabled = false;
                return;
            }

            try {
                updateAuthStatus(loginStatus, "Logging in...", 'info');
                await auth.signInWithEmailAndPassword(email, password);
                // Success: onAuthStateChanged handles UI redirection
            } catch (error) {
                let errorMessage = "Login failed. Please check your credentials.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = "Invalid email or password.";
                }
                updateAuthStatus(loginStatus, errorMessage, 'error');
            } finally {
                isProcessingAuth = false;
                loginBtn.disabled = false;
            }
        }

        async function registerUser() {
            if (isProcessingAuth) return;
            isProcessingAuth = true;
            signupBtn.disabled = true;

            const email = signupEmailInput.value.trim();
            const password = signupPasswordInput.value.trim();
            const confirmPassword = signupConfirmPasswordInput.value.trim();

            if (!email || !password || !confirmPassword) {
                updateAuthStatus(signupStatus, "All fields are required.", 'error');
            } else if (password.length < 6) {
                updateAuthStatus(signupStatus, "Password must be at least 6 characters long.", 'error');
            } else if (password !== confirmPassword) {
                updateAuthStatus(signupStatus, "Passwords do not match.", 'error');
            } else {
                try {
                    updateAuthStatus(signupStatus, "Registering...", 'info');
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    await db.collection('users').doc(userCredential.user.uid).set({
                        uid: userCredential.user.uid,
                        email: userCredential.user.email,
                        username: "", name: "", bio: "", whatsapp: "", instagram: "",
                        profileLogo: getRandomLogoClass(), profilePicUrl: "",
                        isPrivate: false, followers: [], following: [],
                        followersCount: 0, followingCount: 0, postCount: 0,
                        mint: 0, coins: 10, credits: 10, postLimit: 2, // Starter pack
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    await sendEmailVerification(userCredential.user);
                    showAuthScreen('login');
                    updateAuthStatus(loginStatus, "Registration successful! Please verify your email, then login.", 'success');
                } catch (error) {
                    let errorMessage = "Registration failed.";
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = "This email is already in use.";
                    }
                    updateAuthStatus(signupStatus, errorMessage, 'error');
                }
            }
            isProcessingAuth = false;
            signupBtn.disabled = false;
        }

        async function sendPasswordReset() {
             if (isProcessingAuth) return;
             isProcessingAuth = true;
             sendResetEmailBtn.disabled = true;

             const email = resetEmailInput.value.trim();
             if (!email) {
                 updateAuthStatus(resetStatus, "Please enter your email.", 'error');
             } else {
                 try {
                     await auth.sendPasswordResetEmail(email);
                     updateAuthStatus(resetStatus, "Password reset link sent to your email!", 'success');
                 } catch (error) {
                     updateAuthStatus(resetStatus, "No account found with that email.", 'error');
                 }
             }
             isProcessingAuth = false;
             sendResetEmailBtn.disabled = false;
        }

        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await auth.signOut();
                showToast("Logged out.", 'info');
                hasRunInitialAuthCheck = false; // Allow re-check on next load/login
            } catch (error) {
                showToast("Failed to log out.", 'error');
            }
        });
        
        loginBtn.addEventListener('click', signInUser);
        signupBtn.addEventListener('click', registerUser);
        sendResetEmailBtn.addEventListener('click', sendPasswordReset);


        // --- Initial App Load & Settings ---
        document.addEventListener('DOMContentLoaded', () => {
            if (loadStatusElement) {
                loadStatusElement.style.display = 'block';
            }
            applyLogoStyles();
            populateCategorySelects();

            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                body.classList.replace('dark-mode', 'light-mode');
                darkModeCheckbox.checked = false;
            }

            splashScreenTimeout = setTimeout(() => {
                if (!hasRunInitialAuthCheck) {
                    console.warn("Fallback: Auth state check timed out.");
                    checkUserAndRedirect(auth.currentUser);
                }
            }, 4000);
        });
        
        dataSaverCheckbox.addEventListener('change', (e) => {
            dataSaverEnabled = e.target.checked;
            showToast(`Data Saver ${dataSaverEnabled ? 'Enabled' : 'Disabled'}`, 'info');
        });

        darkModeCheckbox.addEventListener('change', (e) => {
            const isDarkMode = e.target.checked;
            body.classList.toggle('dark-mode', isDarkMode);
            body.classList.toggle('light-mode', !isDarkMode);
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            showToast(`Dark Mode ${isDarkMode ? 'Enabled' : 'Disabled'}`, 'info');
        });


        // --- Sidebar & Navigation ---
        menuToggle.addEventListener('click', () => sidebar.classList.add('open'));
        closeSidebarBtn.addEventListener('click', () => sidebar.classList.remove('open'));

        sidebar.querySelectorAll('ul li a').forEach(link => {
            link.addEventListener('click', (e) => {
                 if(link.id.includes('toggle')) return; // Don't prevent default for toggles
                 e.preventDefault();
                 const screenId = e.currentTarget.dataset.screen;
                 if (screenId) {
                     showScreen(`${screenId}-screen`);
                     if (screenId === 'profile') loadUserData(currentUser.uid);
                     if (screenId === 'home') loadPosts();
                     if (screenId === 'messages') loadRecentChats();
                     if (screenId === 'monetization') loadUserData(currentUser.uid); // To refresh balances
                 }
                 sidebar.classList.remove('open');
            });
        });

        bottomNavItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const screenId = e.currentTarget.dataset.screen;
                 if (screenId) {
                     showScreen(`${screenId}-screen`);
                     if (screenId === 'profile') loadUserData(currentUser.uid);
                     if (screenId === 'home') loadPosts();
                     if (screenId === 'messages') loadRecentChats();
                     if (screenId === 'monetization') loadUserData(currentUser.uid);
                 }
            });
        });

        // --- Post Loading ---
        postCategoryFilter.addEventListener('change', () => {
            postsFeed.innerHTML = '';
            lastVisiblePost = null;
            loadPosts();
        });

        async function loadPosts() {
            if (!currentUser || fetchingPosts) return;
            fetchingPosts = true;
            loadingSpinner.classList.remove('hidden');

            try {
                let query = db.collection('posts')
                    .where('expiryTime', '>', firebase.firestore.Timestamp.now())
                    .orderBy('expiryTime', 'desc')
                    .orderBy('timestamp', 'desc');

                const selectedCategory = postCategoryFilter.value;
                if (selectedCategory !== 'all') {
                    query = query.where('category', '==', selectedCategory);
                }
                
                if (lastVisiblePost) {
                    query = query.startAfter(lastVisiblePost);
                }
                
                const snapshot = await query.limit(postsToLoadPerScroll).get();

                if (snapshot.empty && !lastVisiblePost) {
                    postsFeed.innerHTML = '<p style="text-align: center; color: var(--text-color-light);">No posts found in this category.</p>';
                } else {
                     if(!lastVisiblePost) postsFeed.innerHTML = ''; // Clear only on first load
                     snapshot.docs.forEach(doc => {
                        const postData = { id: doc.id, ...doc.data() };
                        if(!document.querySelector(`.post-card[data-post-id="${postData.id}"]`)) {
                           renderPost(postData, postsFeed);
                        }
                    });
                    lastVisiblePost = snapshot.docs[snapshot.docs.length - 1];
                }
            } catch (error) {
                console.error("Error loading posts:", error);
                showToast("Error loading posts.", 'error');
            } finally {
                loadingSpinner.classList.add('hidden');
                fetchingPosts = false;
            }
        }
        
        mainContent.addEventListener('scroll', () => {
            if (mainContent.scrollTop + mainContent.clientHeight >= mainContent.scrollHeight - 100 &&
                document.getElementById('home-screen').classList.contains('active')) {
                loadPosts();
            }
        });

        refreshPostsBtn.addEventListener('click', () => {
            postsFeed.innerHTML = '';
            lastVisiblePost = null;
            loadPosts();
            showToast("Feed refreshed!", 'info');
        });
        
        // -- Post Creation and Rendering --
        function createPostElement(postData, layoutClass = 'vertical-post') {
            const postCard = document.createElement('div');
            postCard.className = `post-card ${layoutClass}`;
            postCard.dataset.postId = postData.id;
            postCard.dataset.userId = postData.userId;
            const isOwner = currentUser && postData.userId === currentUser.uid;

            let userAvatarHtml;
            if (postData.profilePicUrl && !dataSaverEnabled) {
                userAvatarHtml = `<div class="profile-avatar" style="background-image: url('${postData.profilePicUrl}');" data-user-id="${postData.userId}"></div>`;
            } else {
                const userProfileClass = getLogoCssClass(postData.userProfileLogo || 'logo-1');
                userAvatarHtml = `<div class="profile-avatar ${userProfileClass}" data-user-id="${postData.userId}"></div>`;
            }

            postCard.innerHTML = `
                <div class="post-header">
                    ${userAvatarHtml}
                    <span class="username" data-user-id="${postData.userId}">@${postData.username || '...'}</span>
                    <div class="post-options">
                        <i class="fas fa-ellipsis-v"></i>
                        <div class="options-dropdown">
                            <span class="report-btn">Report</span>
                            <span class="repost-btn">Repost</span>
                             <span class="copy-link-btn">Copy Link</span>
                            ${isOwner ? `<span class="delete-btn">Delete</span>` : ''}
                        </div>
                    </div>
                </div>
                <div class="post-content" data-original-content="${postData.content.replace(/"/g, '&quot;')}">
                   <p>${formatPostContent(postData.content)}</p>
                </div>
                <div class="post-footer">
                    <div class="post-actions">
                        <span class="like-button"><i class="far fa-heart"></i> <span class="like-count">${formatNumber(postData.likes || 0)}</span></span>
                        <span class="comment-button"><i class="far fa-comment"></i> <span class="comment-count">${formatNumber(postData.commentCount || 0)}</span></span>
                        <span class="views-count"><i class="fas fa-eye"></i> <span class="view-count-num">${formatNumber(postData.views || 0)}</span></span>
                        <span class="speak-button" title="Listen to Post"><i class="fas fa-volume-up"></i></span>
                        <span class="translate-button" title="Translate Post"><i class="fas fa-language"></i></span>
                    </div>
                </div>
                <div class="emoji-picker hidden">
                    <span class="emoji-option" data-emoji="👍">👍</span><span class="emoji-option" data-emoji="❤️">❤️</span><span class="emoji-option" data-emoji="😂">😂</span><span class="emoji-option" data-emoji="😢">😢</span><span class="emoji-option" data-emoji="🔥">🔥</span>
                </div>
            `;
            // Simplified version of event listeners will be attached next.
            return postCard;
        }

        function renderPost(postData, container) {
            const postElement = createPostElement(postData);
            addPostEventListeners(postElement, postData); // Attach listeners after creation
            container.appendChild(postElement);
        }
        
        function formatPostContent(content) {
            if(!content) return '';
            // Make URLs clickable
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            let formattedContent = content.replace(urlRegex, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
            // Basic markdown-like formatting
            formattedContent = formattedContent.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formattedContent = formattedContent.replace(/\*(.*?)\*/g, '<em>$1</em>');
            return formattedContent;
        }

        // --- Post Event Listeners ---
        function addPostEventListeners(postElement, postData) {
            const postId = postData.id;
            const likeButton = postElement.querySelector('.like-button');
            const optionsBtn = postElement.querySelector('.post-options .fa-ellipsis-v');
            const dropdown = postElement.querySelector('.options-dropdown');
            const deleteBtn = postElement.querySelector('.delete-btn');
            const copyLinkBtn = postElement.querySelector('.copy-link-btn');
            const translateBtn = postElement.querySelector('.translate-button');
            const speakBtn = postElement.querySelector('.speak-button');

            postElement.querySelector('.profile-avatar')?.addEventListener('click', () => openUserProfile(postData.userId));
            postElement.querySelector('.username')?.addEventListener('click', () => openUserProfile(postData.userId));
            
            likeButton?.addEventListener('click', () => handleLike(postId, postElement));
            
            optionsBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.options-dropdown.show').forEach(d => d.classList.remove('show'));
                dropdown.classList.toggle('show');
            });
            
            deleteBtn?.addEventListener('click', () => handleDeletePost(postId, postElement));
            copyLinkBtn?.addEventListener('click', () => handleCopyPostLink(postId));
            translateBtn?.addEventListener('click', () => {
                const contentEl = postElement.querySelector('.post-content');
                handleTranslatePost(contentEl, userSelectedTranslationLanguage);
            });
            speakBtn?.addEventListener('click', () => {
                const text = postElement.querySelector('.post-content').textContent;
                handleSpeakPost(text, speakBtn);
            });

            incrementViewCount(postId);
        }
        
        document.addEventListener('click', () => {
            document.querySelectorAll('.options-dropdown.show').forEach(d => d.classList.remove('show'));
        });
        
        // --- Post Actions (Like, Delete, etc.) ---
        async function handleLike(postId, postElement) {
             if (!currentUser) { showToast("Please log in to like posts.", 'info'); return; }
             const likeButtonIcon = postElement.querySelector('.like-button i');
             const likeCountSpan = postElement.querySelector('.like-button .like-count');
             const postRef = db.collection('posts').doc(postId);
             
             try {
                await db.runTransaction(async (transaction) => {
                    const postDoc = await transaction.get(postRef);
                    if (!postDoc.exists) throw "Post not found.";
                    
                    const postData = postDoc.data();
                    const likedBy = postData.likedBy || [];
                    const isLiked = likedBy.includes(currentUser.uid);
                    let newLikes = postData.likes || 0;
                    
                    if(isLiked) {
                        transaction.update(postRef, {
                            likedBy: firebase.firestore.FieldValue.arrayRemove(currentUser.uid),
                            likes: firebase.firestore.FieldValue.increment(-1)
                        });
                        newLikes--;
                    } else {
                         transaction.update(postRef, {
                            likedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.uid),
                            likes: firebase.firestore.FieldValue.increment(1)
                        });
                        newLikes++;
                    }
                    
                    // UI update outside transaction
                    likeCountSpan.textContent = formatNumber(newLikes);
                    likeButtonIcon.classList.toggle('fas', !isLiked);
                    likeButtonIcon.classList.toggle('far', isLiked);
                });
             } catch(error) {
                console.error("Error liking post:", error);
                showToast("Failed to update like.", "error");
             }
        }
        
        async function handleDeletePost(postId, postElement) {
            if (!currentUser) return;
            if(confirm("Are you sure you want to delete this post?")) {
                try {
                    await db.collection('posts').doc(postId).delete();
                    await db.collection('users').doc(currentUser.uid).update({
                        postCount: firebase.firestore.FieldValue.increment(-1)
                    });
                    postElement.remove();
                    showToast("Post deleted.", 'success');
                } catch(error) {
                    console.error("Error deleting post:", error);
                    showToast("Could not delete post.", 'error');
                }
            }
        }

        async function handleCopyPostLink(postId) {
            const link = `${window.location.origin}${window.location.pathname}?post=${postId}`;
            try {
                await navigator.clipboard.writeText(link);
                showToast("Link copied to clipboard!", 'success');
            } catch (err) {
                showToast("Failed to copy link.", 'error');
            }
        }
        
         async function incrementViewCount(postId) {
            if (!currentUser) return;
            const viewKey = `viewed_${postId}`;
            if (sessionStorage.getItem(viewKey)) return;

            sessionStorage.setItem(viewKey, 'true');
            const postRef = db.collection('posts').doc(postId);
            try {
                await postRef.update({ views: firebase.firestore.FieldValue.increment(1) });
                // Note: Real-time UI update for views would need a listener or manual increment.
            } catch(error) {
                console.error("Error incrementing view:", error);
            }
        }

        // --- Post Upload Logic ---
        publishPostBtn.addEventListener('click', async () => {
            if (!currentUser) return;

            const content = postContentInput.value.trim();
            const category = postCategorySelect.value;
            
            if (content.length < 60 || content.length > 10000) {
                updateAuthStatus(uploadStatus, "Content must be 60-10000 characters.", 'error');
                return;
            }

            updateAuthStatus(uploadStatus, "Publishing...", 'info');
            publishPostBtn.disabled = true;

            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                const newPost = {
                    userId: currentUser.uid,
                    username: userData.username,
                    userProfileLogo: userData.profileLogo,
                    profilePicUrl: userData.profilePicUrl,
                    content: content,
                    category: category,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    expiryTime: firebase.firestore.Timestamp.fromMillis(Date.now() + (24 * 60 * 60 * 1000)),
                    likes: 0,
                    views: 0,
                    isPrivate: userData.isPrivate,
                    likedBy: [],
                    monetized: monetizePostCheckbox.checked
                };
                
                await db.collection('posts').add(newPost);
                await db.collection('users').doc(currentUser.uid).update({
                    postCount: firebase.firestore.FieldValue.increment(1)
                });
                
                updateAuthStatus(uploadStatus, "Post published!", 'success');
                postContentInput.value = '';
                monetizePostCheckbox.checked = false;
                showScreen('home-screen');
                loadPosts();

            } catch (error) {
                console.error("Error publishing post:", error);
                updateAuthStatus(uploadStatus, "Failed to publish post.", 'error');
            } finally {
                publishPostBtn.disabled = false;
            }
        });
        
        // --- Profile Management ---
        async function loadUserData(userId) {
            if (!userId) return;
            currentProfileViewingId = userId;

            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    updateProfileDisplay(userData);
                    loadProfilePosts(userId);
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }
        
        function updateProfileDisplay(userData) {
            const isMyProfile = currentUser.uid === userData.uid;
            
            // Sidebar
            document.getElementById('sidebar-username').textContent = userData.name || userData.username;
            const sidebarAvatar = document.getElementById('sidebar-profile-avatar');
             if (userData.profilePicUrl && !dataSaverEnabled) {
                sidebarAvatar.style.backgroundImage = `url('${userData.profilePicUrl}')`;
                sidebarAvatar.className = 'profile-avatar-small';
            } else {
                sidebarAvatar.style.backgroundImage = '';
                sidebarAvatar.className = `profile-avatar-small ${getLogoCssClass(userData.profileLogo || 'logo-1')}`;
            }

            // Main Profile Screen
            myProfileUsername.textContent = `@${userData.username}`;
            myProfileName.textContent = userData.name;
            myProfileBio.textContent = userData.bio;
            myPostsCount.textContent = formatNumber(userData.postCount);
            myFollowersCount.textContent = formatNumber(userData.followersCount);
            myFollowingCount.textContent = formatNumber(userData.followingCount);
            
             if (userData.profilePicUrl && !dataSaverEnabled) {
                myProfileAvatar.style.backgroundImage = `url('${userData.profilePicUrl}')`;
                myProfileAvatar.className = 'profile-avatar-large';
            } else {
                myProfileAvatar.style.backgroundImage = '';
                myProfileAvatar.className = `profile-avatar-large ${getLogoCssClass(userData.profileLogo || 'logo-1')}`;
            }

            // Header Resources
            headerCoins.textContent = `${formatNumber(userData.coins || 0)} C`;
            headerCredits.textContent = `${formatNumber(userData.credits || 0)} Cr`;
            headerLimit.textContent = `${formatNumber(userData.postLimit || 0)} L`;
            headerMint.textContent = `${formatNumber(userData.mint || 0)} M`;
            
            // Monetization Screen Resources
            monetizationCoins.textContent = formatNumber(userData.coins || 0);
            monetizationCredits.textContent = formatNumber(userData.credits || 0);
            monetizationLimits.textContent = formatNumber(userData.postLimit || 0);
            monetizationEarnings.textContent = `${(userData.mint || 0).toFixed(2)} M`;

            // Button visibility
            editProfileBtn.classList.toggle('hidden', !isMyProfile);
            followUserBtn.classList.toggle('hidden', isMyProfile);
            unfollowUserBtn.classList.toggle('hidden', isMyProfile);
            messageUserBtn.classList.toggle('hidden', isMyProfile);
        }

        editProfileBtn.addEventListener('click', async () => {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            const userData = userDoc.data();
            editUsernameInput.value = userData.username;
            editNameInput.value = userData.name;
            editBioInput.value = userData.bio;
            editWhatsappInput.value = userData.whatsapp;
            editInstagramInput.value = userData.instagram;
            profilePicUrlInput.value = userData.profilePicUrl;
            accountPrivacyToggle.checked = userData.isPrivate;
            accountPrivacyStatus.textContent = userData.isPrivate ? 'Private' : 'Public';
            populateProfileLogoOptions(userData.profileLogo, userData.profilePicUrl);
            editProfileModal.classList.remove('hidden');
        });
        
        cancelEditProfileBtn.addEventListener('click', () => {
            editProfileModal.classList.add('hidden');
        });
        
        saveProfileBtn.addEventListener('click', async () => {
             updateAuthStatus(saveProfileStatus, 'Saving...', 'info');
             const newUsername = editUsernameInput.value.trim();
             
             // Simple validation
             if(!newUsername) {
                updateAuthStatus(saveProfileStatus, 'Username is required.', 'error');
                return;
             }
             
             try {
                const selectedLogoElement = profileLogoOptions.querySelector('.logo-option-item.selected');
                let newProfileLogo = '';
                let newProfilePicUrl = profilePicUrlInput.value.trim();
                
                if(newProfilePicUrl) {
                    newProfileLogo = '';
                } else if(selectedLogoElement) {
                    newProfileLogo = selectedLogoElement.dataset.value;
                }
             
                await db.collection('users').doc(currentUser.uid).update({
                    username: newUsername,
                    username_lowercase: newUsername.toLowerCase(),
                    name: editNameInput.value.trim(),
                    bio: editBioInput.value.trim(),
                    whatsapp: editWhatsappInput.value.trim(),
                    instagram: editInstagramInput.value.trim(),
                    profilePicUrl: newProfilePicUrl,
                    profileLogo: newProfileLogo,
                    isPrivate: accountPrivacyToggle.checked
                });
                
                updateAuthStatus(saveProfileStatus, '', 'hidden');
                editProfileModal.classList.add('hidden');
                showToast("Profile updated!", 'success');
                loadUserData(currentUser.uid); // Refresh profile
             
             } catch(error) {
                console.error("Error saving profile:", error);
                updateAuthStatus(saveProfileStatus, 'Failed to save.', 'error');
             }
        });
        
         async function loadProfilePosts(userId) {
            profilePostsFeed.innerHTML = `<div class="loader"></div>`;
            try {
                const snapshot = await db.collection('posts')
                    .where('userId', '==', userId)
                    .orderBy('timestamp', 'desc')
                    .get();

                profilePostsFeed.innerHTML = '';
                if (snapshot.empty) {
                    profilePostsFeed.innerHTML = '<p style="text-align:center; color: var(--text-color-light);">No posts yet.</p>';
                } else {
                    snapshot.docs.forEach(doc => renderPost({ id: doc.id, ...doc.data() }, profilePostsFeed));
                }
            } catch (error) {
                console.error("Error loading profile posts:", error);
                profilePostsFeed.innerHTML = '<p style="text-align:center; color:red;">Error loading posts.</p>';
            }
        }
        
         function populateProfileLogoOptions(currentLogoClass, currentProfilePicUrl) {
            profileLogoOptions.innerHTML = '';

            PROFILE_LOGOS.forEach(logo => {
                const logoItem = document.createElement('div');
                logoItem.className = `logo-option-item user-logo-${logo.class}`;
                logoItem.dataset.value = logo.class;
                
                if ((!currentProfilePicUrl && currentLogoClass === logo.class) || (currentProfilePicUrl && logo.class === 'url-logo')) {
                    logoItem.classList.add('selected');
                }
                
                logoItem.addEventListener('click', () => {
                    profileLogoOptions.querySelectorAll('.logo-option-item').forEach(item => item.classList.remove('selected'));
                    profilePicUrlInput.value = '';
                    logoItem.classList.add('selected');
                });
                profileLogoOptions.appendChild(logoItem);
            });
             
             profilePicUrlInput.addEventListener('input', () => {
                 if(profilePicUrlInput.value.trim()) {
                      profileLogoOptions.querySelectorAll('.logo-option-item').forEach(item => item.classList.remove('selected'));
                 }
             });
        }
        
        
        // --- Text to Speech & Translate ---
        const simulatedTranslations = { 'en': 'This is a simulated English translation.', 'hi': 'यह एक नकली हिंदी अनुवाद है।', 'es': 'Esta es una traducción simulada al español.' };

        function handleTranslatePost(contentElement, targetLang) {
            const originalContent = contentElement.dataset.originalContent;
            const pElement = contentElement.querySelector('p');
            if(pElement.innerHTML === formatPostContent(originalContent)) {
                 pElement.textContent = simulatedTranslations[targetLang] || simulatedTranslations['en'];
            } else {
                 pElement.innerHTML = formatPostContent(originalContent);
            }
            showToast("Translation is simulated for this demo.", "info");
        }

        function handleSpeakPost(textToSpeak, speakButtonElement) {
            if (!('speechSynthesis' in window)) {
                showToast("Text-to-speech not supported.", 'error');
                return;
            }
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                if(speakButtonElement.classList.contains('active')) {
                    speakButtonElement.classList.remove('active');
                    return;
                }
            }
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.onstart = () => speakButtonElement.classList.add('active');
            utterance.onend = () => speakButtonElement.classList.remove('active');
            utterance.onerror = () => speakButtonElement.classList.remove('active');
            window.speechSynthesis.speak(utterance);
        }

    </script>
</body>
</html>```
