<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AddMint Pro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path fill='%23007bff' d='M50 0L100 50L50 100L0 50Z'/><path fill='%23e0e0e0' d='M50 10L90 50L50 90L10 50Z'/></svg>">
    
    <style>
        /* [ ... All previous CSS styles for dark mode, animations, etc. are here ... ] */
        /* I will add some new ones below */

        /* Global Styles & Variables */
        :root {
            --dark-bg: #121212;
            --dark-fg: #1e1e1e;
            --text-color: #e0e0e0;
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --accent-color: #ffc107;
            --accent-dark: #cc9a00;
            --border-color: #333;
            --shadow-color: rgba(0, 0, 0, 0.7);
            --success-color: #28a745;
            --error-color: #dc3545;
            --info-color: #17a2b8;
            --transition-speed: 0.3s ease;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed);
        }

        a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        button, input[type="submit"] {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color var(--transition-speed), transform 0.15s ease, box-shadow var(--transition-speed);
            box-shadow: 0 4px 10px var(--shadow-color);
            letter-spacing: 0.5px;
        }

        button:hover, input[type="submit"]:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.8);
        }

        button:active, input[type="submit"]:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        input[type="email"],
        input[type="password"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--dark-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="text"]:focus,
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25), inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .container {
            width: 90%;
            max-width: 480px;
            margin: auto;
            padding: 30px;
            background-color: var(--dark-fg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 25px var(--shadow-color);
            animation: fadeIn 0.6s ease-out;
            border: 1px solid var(--border-color);
        }

        .message {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            word-wrap: break-word;
            border: 1px solid transparent;
            animation: fadeIn 0.4s ease-out;
        }

        .message.success {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .message.error {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--error-color);
            border-color: var(--error-color);
        }
        .message.info {
            background-color: rgba(23, 162, 184, 0.2);
            color: var(--info-color);
            border-color: var(--info-color);
        }

        .hidden {
            display: none !important;
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg), #0f0f0f);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1.2s ease-out;
            opacity: 1;
        }

        .splash-logo-container {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .splash-logo-diamond {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 123, 255, 0.7);
            animation: splashDiamondPulse 2s infinite alternate ease-in-out;
        }

        .splash-logo-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 25px rgba(255, 255, 255, 0.4);
            z-index: 1;
            letter-spacing: 2px;
        }

        .splash-loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite, glow 1.5s infinite alternate;
            margin-top: 40px;
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
        }

        /* Header */
        header {
            background-color: var(--dark-fg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 15px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 99;
            animation: slideDown 0.5s ease-out;
        }
        .header-left, .header-right {
            display: flex;
            align-items: center;
            gap: 15px; /* Space between header items */
        }

        .app-logo {
            display: flex;
            align-items: center;
            font-size: 1.9rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 0 8px rgba(0, 123, 255, 0.6);
            letter-spacing: 1px;
        }

        .app-logo .shape {
            width: 35px;
            height: 35px;
            background: linear-gradient(45deg, var(--accent-color), #ffd700);
            transform: rotate(45deg);
            border-radius: 8px;
            margin-right: 12px;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
            animation: headerLogoSpin 4s infinite linear;
        }

        .header-icon {
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
            transition: color var(--transition-speed), transform 0.2s ease;
            padding: 5px;
            border-radius: 5px;
            position: relative;
        }
        .header-icon:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }
        .header-icon .count-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--error-color);
            color: white;
            font-size: 0.6rem;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 50%;
            line-height: 1;
        }
        
        /* Main Content */
        main {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        section {
            display: none;
            padding: 25px;
            background-color: var(--dark-fg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 6px 15px var(--shadow-color);
            animation: fadeIn 0.6s ease-out;
            border: 1px solid var(--border-color);
        }

        section.active {
            display: block;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(0, 123, 255, 0.4);
            letter-spacing: 1px;
        }

        /* Password input with eye icon */
        .password-input-container {
            position: relative;
            margin-bottom: 15px;
        }

        .password-input-container input {
            padding-right: 50px;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--border-color);
            font-size: 1.3rem;
            transition: color var(--transition-speed);
            padding: 5px;
            border-radius: 5px;
        }

        .toggle-password:hover {
            color: var(--primary-color);
        }

        /* Post Creation Section */
        #create-post-section label {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        #post-content {
            min-height: 120px;
            resize: vertical;
            margin-bottom: 20px;
        }

        /* Post Display Section */
        #posts-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding-top: 10px;
        }

        .post-card {
            background-color: var(--dark-bg);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: 0 8px 20px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            overflow: hidden;
            position: relative;
            animation: slideInUp 0.6s ease-out;
            cursor: pointer;
        }

        .post-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.9);
            border-color: var(--primary-color);
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .post-header h3 {
            color: var(--accent-color);
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.4);
            cursor: pointer;
        }
        .post-header .post-options {
            display: flex;
            gap: 10px;
        }
        .post-header .post-options .icon-button {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #aaa;
            cursor: pointer;
            transition: color var(--transition-speed);
        }
        .post-header .post-options .icon-button:hover {
            color: var(--primary-color);
        }
        
        .post-card p {
            font-size: 1.05rem;
            margin-bottom: 20px;
            flex-grow: 1;
            word-wrap: break-word;
            color: var(--text-color);
        }

        .post-meta {
            font-size: 0.88rem;
            color: #aaa;
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .post-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: flex-start;
        }

        .post-actions button {
            padding: 8px 18px;
            font-size: 0.9rem;
            border-radius: 6px;
            background-color: var(--primary-color);
            box-shadow: none;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .post-actions button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }
        .post-actions .like-btn {
            background-color: #6c757d;
        }
        .post-actions .like-btn.liked {
            background-color: var(--error-color);
        }
        .post-actions button.delete-btn {
            background-color: var(--error-color);
        }
        .post-actions button.delete-btn:hover {
            background-color: #b02a37;
        }

        /* Unique Post Styles - Dynamic Examples */
        .post-card.horizontal {
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
            padding: 25px;
            min-height: 160px;
            border-left: 5px solid var(--accent-color);
            animation: slideInRight 0.7s ease-out;
        }
        .post-card.horizontal .post-content-wrapper {
            flex-grow: 1;
        }
        .post-card.horizontal .post-meta {
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
            min-width: 100px;
            border-top: none;
            padding-top: 0;
            margin-bottom: 0;
        }
        .post-card.horizontal .post-actions {
            flex-direction: column;
            gap: 8px;
        }

        /* Square Card */
        .post-card.square {
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-radius: var(--border-radius-lg);
            animation: zoomIn 0.8s ease-out;
            border: 2px solid var(--info-color);
        }
        .post-card.square .post-content-wrapper {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            margin-bottom: 10px;
        }
        .post-card.square .post-meta, .post-card.square .post-actions {
            margin-top: 10px;
            justify-content: center;
        }
        .post-card.square .post-header {
            justify-content: center;
        }


        /* Neon Effect */
        .post-card.neon {
            box-shadow: 0 0 15px var(--primary-color), 0 0 25px var(--primary-color) inset;
            border-color: var(--primary-color);
            position: relative;
            overflow: hidden;
            animation: neonGlow 1.5s infinite alternate ease-in-out;
        }
        .post-card.neon::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color), var(--primary-color));
            z-index: -1;
            filter: blur(8px);
            opacity: 0.7;
            border-radius: var(--border-radius-lg);
            animation: neonBorderPulse 3s infinite linear;
        }
        .post-card.neon h3, .post-card.neon p, .post-card.neon .post-meta {
            text-shadow: 0 0 10px rgba(0, 123, 255, 0.8), 0 0 20px rgba(0, 123, 255, 0.6);
        }
        .post-card.neon .post-actions button {
            background-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
        }
        .post-card.neon .post-actions button:hover {
            background-color: var(--accent-dark);
        }
        
        /* New Styles for Ad, Profile and Monetization screens */
        .ad-rewards-grid, .profile-stats, .monetization-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
            text-align: center;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: #333;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            display: grid;
            place-items: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
            animation: profilePulse 2s infinite alternate;
        }
        .profile-info {
            text-align: left;
        }
        .profile-info h3 {
            margin: 0;
            font-size: 1.8rem;
        }
        .profile-info p {
            margin: 5px 0 0;
            color: #aaa;
        }
        .profile-stats {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            text-align: center;
            background-color: var(--dark-bg);
            padding: 15px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
        }
        .profile-stats div {
            flex: 1;
            border-right: 1px solid var(--border-color);
        }
        .profile-stats div:last-child {
            border-right: none;
        }
        .profile-stats strong {
            display: block;
            font-size: 1.2rem;
            color: var(--accent-color);
        }
        .profile-stats span {
            font-size: 0.9rem;
            color: #aaa;
        }
        .monetization-card {
            background-color: #1a2a40;
            border: 2px solid var(--primary-color);
            padding: 25px;
            border-radius: var(--border-radius-lg);
            animation: monetCardGlow 2s infinite alternate;
        }

        /* Post Specific Profile Screen */
        #post-user-profile-section h2 {
            margin-bottom: 10px;
        }
        #post-user-profile-posts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .follow-btn {
            background-color: var(--success-color);
        }
        .follow-btn.unfollow {
            background-color: var(--error-color);
        }
        
        /* New SVG Icons (used as mask-image) */
        .icon-ad { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 7V3h-8v4H3v14h18V7h-2zm-2 12H5V9h14v10zM7 11h2v2H7v-2zm-2 4h14v2H5v-2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 7V3h-8v4H3v14h18V7h-2zm-2 12H5V9h14v10zM7 11h2v2H7v-2zm-2 4h14v2H5v-2z'/%3E%3C/svg%3E"); }
        .icon-coins { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 8V6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2zM4 14V8h6a2 2 0 0 1 2 2v4h4a2 2 0 0 1 2 2v2H6a2 2 0 0 1-2-2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 8V6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2zM4 14V8h6a2 2 0 0 1 2 2v4h4a2 2 0 0 1 2 2v2H6a2 2 0 0 1-2-2z'/%3E%3C/svg%3E"); }
        .icon-credit-card { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4V8h16v10zm-2-7H6v-2h12v2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4V8h16v10zm-2-7H6v-2h12v2z'/%3E%3C/svg%3E"); }
        .icon-post-limit { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 15h-2v2h2v2h-2v2h-2v-2h-2v-2h2v-2h2v-2h2zM19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M21 15h-2v2h2v2h-2v2h-2v-2h-2v-2h2v-2h2v-2h2zM19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E"); }
        .icon-like { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E"); }
        .icon-translate { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 10.9c-.33 0-.65-.08-1.1-.2v-1.7c1.38-.41 2.5-1.07 3.32-1.92-1.25-1.17-2.65-2.02-4.14-2.58L9.9 4.14C11.55 4.6 13.04 5.37 14.3 6.3l-1.4 1.4c-1.4-.87-2.63-1.45-3.8-1.74-.25.5-.47.96-.6 1.4h-.02c.7 1.34 1.45 2.1 2.22 2.1c.36 0 .6-.18.6-.45 0-.17-.07-.3-.15-.4zM16 13h-2v2h2v2h2v-2h2v-2h-2v-2h-2v2zM12 20.9c-.83 0-1.5-.67-1.5-1.5S11.17 17.9 12 17.9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 3a9 9 0 0 1 9 9c0 4.2-3.23 7.63-7.29 8.24-.71.1-1.41.16-2.11.16-4.97 0-9-4.03-9-9 0-4.97 4.03-9 9-9zm-1.5 4.5c.34-.34.78-.6 1.25-.78.47-.18.98-.27 1.5-.27 1.1 0 2.1.4 2.93 1.22l1.62-1.62c-1.12-1.12-2.5-1.77-3.95-1.9C13.06 2.65 12.5 2.5 12 2.5c-.56 0-1.1.15-1.63.45C9.55 3.3 8.3 4.28 7.2 5.5l1.42 1.42c.74-.74 1.6-1.17 2.47-1.42z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 10.9c-.33 0-.65-.08-1.1-.2v-1.7c1.38-.41 2.5-1.07 3.32-1.92-1.25-1.17-2.65-2.02-4.14-2.58L9.9 4.14C11.55 4.6 13.04 5.37 14.3 6.3l-1.4 1.4c-1.4-.87-2.63-1.45-3.8-1.74-.25.5-.47.96-.6 1.4h-.02c.7 1.34 1.45 2.1 2.22 2.1c.36 0 .6-.18.6-.45 0-.17-.07-.3-.15-.4zM16 13h-2v2h2v2h2v-2h2v-2h-2v-2h-2v2zM12 20.9c-.83 0-1.5-.67-1.5-1.5S11.17 17.9 12 17.9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 3a9 9 0 0 1 9 9c0 4.2-3.23 7.63-7.29 8.24-.71.1-1.41.16-2.11.16-4.97 0-9-4.03-9-9 0-4.97 4.03-9 9-9zm-1.5 4.5c.34-.34.78-.6 1.25-.78.47-.18.98-.27 1.5-.27 1.1 0 2.1.4 2.93 1.22l1.62-1.62c-1.12-1.12-2.5-1.77-3.95-1.9C13.06 2.65 12.5 2.5 12 2.5c-.56 0-1.1.15-1.63.45C9.55 3.3 8.3 4.28 7.2 5.5l1.42 1.42c.74-.74 1.6-1.17 2.47-1.42z'/%3E%3C/svg%3E"); }
        .icon-message { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E"); }


        /* Desktop Adjustments */
        @media (min-width: 768px) {
            body { font-size: 17px; }
            .container { padding: 40px; max-width: 580px; }
            header { padding: 20px 40px; }
            main { padding: 30px 40px; max-width: 1400px; }
            footer { padding: 15px 40px; }
            .post-card.horizontal { grid-column: span 2; max-width: none; }
            .post-card.square { max-width: 320px; justify-self: center; }
            #posts-list { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
            .header-right { gap: 25px; } /* More space on desktop */
        }
        
        /* Animations */
        /* [ ... All previous animation keyframes are here ... ] */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes glow { 0% { box-shadow: 0 0 5px var(--primary-color); } 50% { box-shadow: 0 0 20px var(--primary-color), 0 0 30px var(--accent-color); } 100% { box-shadow: 0 0 5px var(--primary-color); } }
        @keyframes splashDiamondPulse { 0%, 100% { transform: translate(-50%, -50%) rotate(45deg) scale(1); opacity: 1; } 50% { transform: translate(-50%, -50%) rotate(45deg) scale(1.08); opacity: 0.8; } }
        @keyframes headerLogoSpin { 0% { transform: rotate(45deg) scale(1); } 25% { transform: rotate(135deg) scale(1.05); } 50% { transform: rotate(225deg) scale(1); } 75% { transform: rotate(315deg) scale(1.05); } 100% { transform: rotate(405deg) scale(1); } }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes neonGlow { 0% { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color) inset; } 50% { box-shadow: 0 0 25px var(--primary-color), 0 0 40px var(--primary-color) inset; } 100% { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color) inset; } }
        @keyframes neonBorderPulse { 0%, 100% { opacity: 0.7; filter: blur(8px) brightness(1); } 50% { opacity: 1; filter: blur(12px) brightness(1.2); } }
        @keyframes profilePulse { 0%, 100% { box-shadow: 0 0 10px rgba(0, 123, 255, 0.4); } 50% { box-shadow: 0 0 20px rgba(0, 123, 255, 0.8); } }
        @keyframes monetCardGlow { 0%, 100% { box-shadow: 0 0 10px var(--primary-color); } 50% { box-shadow: 0 0 20px var(--primary-color); } }
        @keyframes soundWave {
            0% { transform: scaleY(0.2); }
            50% { transform: scaleY(1); }
            100% { transform: scaleY(0.2); }
        }
        .sound-wave-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            height: 15px;
            width: 25px;
            cursor: pointer;
        }
        .sound-wave-icon span {
            width: 3px;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 2px;
            animation: soundWave 1s infinite ease-in-out;
        }
        .sound-wave-icon span:nth-child(2) { animation-delay: -0.8s; }
        .sound-wave-icon span:nth-child(3) { animation-delay: -1s; }

        /* Utility classes */
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 20px; }
        .mt-4 { margin-top: 20px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo-container">
            <div class="splash-logo-diamond"></div>
            <div class="splash-logo-text">A</div>
        </div>
        <div class="splash-loader"></div>
        <p style="margin-top: 20px; font-size: 1.1rem; color: #bbb;">AddMint Pro - The Future of Social Media</p>
    </div>

    <div id="app-container" class="hidden">
        <header>
            <div class="header-left">
                <div class="app-logo">
                    <span class="shape"></span> AddMint
                </div>
            </div>
            <div class="header-right">
                <div class="header-icon" onclick="showSection('ad-rewards-section')">
                    <span class="icon icon-ad"></span>
                    <span id="header-limit-count" class="count-badge">2</span>
                </div>
                <div class="header-icon" onclick="showSection('user-profile-section')">
                    <span class="icon icon-coins"></span>
                    <span id="header-coin-count" class="count-badge">0</span>
                </div>
                <div class="header-icon" onclick="showSection('user-profile-section')">
                    <span class="icon icon-credit-card"></span>
                    <span id="header-credit-count" class="count-badge">0</span>
                </div>
                <div class="header-icon" onclick="showSection('settings-section')">
                    &#x22EE;
                </div>
            </div>
        </header>

        <main>
            <section id="signin-auth" class="container active">
                <h2>Welcome Back!</h2>
                <div id="auth-status-message" class="message hidden"></div>
                <form id="signin-form">
                    <input type="email" id="signin-email" placeholder="Your Email" required>
                    <div class="password-input-container">
                        <input type="password" id="signin-password" placeholder="Password" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signin-password', this)">&#128065;</span>
                    </div>
                    <button type="submit">Sign In</button>
                    <p class="text-center mt-4">Don't have an account? <a href="#" onclick="showSection('signup-auth'); return false;">Sign Up Here</a></p>
                </form>
            </section>

            <section id="signup-auth" class="container">
                <h2>Join AddMint Today!</h2>
                <div id="signup-status-message" class="message hidden"></div>
                <form id="signup-form">
                    <input type="email" id="signup-email" placeholder="Your Email" required>
                    <div class="password-input-container">
                        <input type="password" id="signup-password" placeholder="Create Password (min 6 chars)" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signup-password', this)">&#128065;</span>
                    </div>
                    <div class="password-input-container">
                        <input type="password" id="signup-confirm-password" placeholder="Confirm Password" required>
                        <span class="toggle-password" onclick="togglePasswordVisibility('signup-confirm-password', this)">&#128065;</span>
                    </div>
                    <button type="submit">Sign Up</button>
                    <p class="text-center mt-4">Already have an account? <a href="#" onclick="showSection('signin-auth'); return false;">Sign In</a></p>
                </form>
            </section>

            <section id="email-verify" class="container">
                <h2>Verify Your Email</h2>
                <div id="verify-email-message" class="message error"></div>
                <p class="text-center mb-4">A verification link has been sent to your email. Please check your inbox to activate your account. Then sign in again.</p>
                <button onclick="sendVerificationEmail()">Resend Verification Email</button>
                <button onclick="auth.signOut(); showSection('signin-auth');" class="mt-4" style="background-color: var(--error-color);">Sign Out</button>
            </section>
            
            <section id="setup-profile" class="container">
                <h2>Complete Your Profile</h2>
                <div id="profile-setup-message" class="message hidden"></div>
                <form id="profile-setup-form">
                    <label for="profileUsername">Choose a Username:</label>
                    <input type="text" id="profileUsername" placeholder="e.g., AddMintUser" required>
                    <label for="profilePhone" class="mt-4">Phone Number (Optional):</label>
                    <input type="text" id="profilePhone" placeholder="e.g., +919876543210">
                    <label for="profileWhatsApp" class="mt-4">WhatsApp Number (Optional):</label>
                    <input type="text" id="profileWhatsApp" placeholder="e.g., +919876543210 (for direct chats)">
                    <label for="profileInstagram" class="mt-4">Instagram Handle (Optional):</label>
                    <input type="text" id="profileInstagram" placeholder="e.g., @yourhandle">
                    <button type="submit" class="mt-4">Save Profile & Continue</button>
                </form>
            </section>

            <section id="home-posts">
                <h2>Recent Updates</h2>
                <button class="mb-4" onclick="fetchPosts()">Refresh Feed</button>
                <div id="posts-list">
                    <p class="text-center" id="no-posts-message" style="margin-top: 30px; font-style: italic; color: #aaa;">Fetching exciting posts...</p>
                </div>
            </section>

            <section id="create-post-section">
                <h2>Share Your Thoughts</h2>
                <div id="create-post-message" class="message hidden"></div>
                <div class="text-center mb-4">
                    <p>You have <span id="posts-free-count">2</span> free posts left today.</p>
                    <p>Post more with <span id="posts-coin-count">0</span> coins or <button onclick="requestAdForPost()" style="padding: 5px 10px; font-size: 0.8rem;">Watch Ad</button> (You have <span id="posts-limit-count">0</span> post limits).</p>
                </div>
                <form id="create-post-form">
                    <label for="post-content">What's on your mind today?</label>
                    <textarea id="post-content" placeholder="Type your message here..." required></textarea>
                    <button type="submit" class="mt-4">Publish Post</button>
                    <button type="button" class="mt-2" onclick="useCoinForPost()" style="background-color: var(--accent-color);">Use 5 Coins to Post</button>
                </form>
            </section>

            <section id="ad-rewards-section" class="container">
                <h2>Get Rewards!</h2>
                <p class="text-center mb-4">Watch a video ad to earn rewards.</p>
                <div class="ad-rewards-grid">
                    <button onclick="requestAdReward('coins')">
                        <span class="icon icon-coins" style="margin-right: 10px;"></span> Get 10 Coins
                    </button>
                    <button onclick="requestAdReward('credits')">
                        <span class="icon icon-credit-card" style="margin-right: 10px;"></span> Get 10 Credits
                    </button>
                    <button onclick="requestAdReward('limit')">
                        <span class="icon icon-post-limit" style="margin-right: 10px;"></span> Get 1 Post Limit
                    </button>
                </div>
                <div id="ad-reward-message" class="message hidden mt-4"></div>
            </section>

            <section id="user-profile-section">
                <h2>My Profile</h2>
                <div id="current-user-profile-details">
                    </div>
                <div class="mt-4">
                    <h3>My Posts</h3>
                    <div id="my-active-posts">
                        </div>
                </div>
            </section>
            
            <section id="post-user-profile-section">
                <div class="profile-header">
                    <div class="profile-avatar">U</div>
                    <div class="profile-info">
                        <h3 id="other-user-profile-username">Loading...</h3>
                        <p id="other-user-profile-id">ID: ...</p>
                    </div>
                </div>
                <div class="profile-stats mt-4">
                    <div><strong><span id="other-user-posts-count">0</span></strong><span>Posts</span></div>
                    <div><strong><span id="other-user-followers-count">0</span></strong><span>Followers</span></div>
                    <div><strong><span id="other-user-following-count">0</span></strong><span>Following</span></div>
                </div>
                <div class="post-actions mt-4">
                    <button id="follow-button" class="follow-btn" onclick="toggleFollow()">Follow</button>
                    <button onclick="contactUser('whatsapp', this)">WhatsApp</button>
                    <button onclick="contactUser('instagram', this)">Instagram</button>
                    <button onclick="contactUser('phone', this)">Call</button>
                    <button onclick="showSection('message-section')">Message</button>
                </div>
                <h3 class="mt-4">Active Posts</h3>
                <div id="post-user-profile-posts">
                    </div>
            </section>
            
            <section id="message-section" class="container">
                <h2>Send a Message</h2>
                <div id="message-status-message" class="message hidden"></div>
                <div class="text-center mb-4">
                    <p>You have <span id="message-credit-count">0</span> credits.</p>
                    <p>1 credit = 1 message.</p>
                </div>
                <form id="message-form">
                    <input type="text" id="message-recipient-username" readonly>
                    <textarea id="message-content" placeholder="Type your message here..." required></textarea>
                    <button type="submit" class="mt-4">Send Message</button>
                </form>
            </section>
            
            <section id="monetization-info-section" class="container">
                <h2>Monetize Your Influence!</h2>
                <div class="monetization-details">
                    <div class="monetization-card">
                        <h3>Become a Partner</h3>
                        <p>When you reach **100 followers**, you unlock the opportunity to monetize your content on AddMint.</p>
                    </div>
                    <div class="monetization-card">
                        <h3>Earn with Every Post</h3>
                        <p>Once you've reached 100 followers, you can earn **₹10-₹100** for every **150 posts** you publish.</p>
                    </div>
                    <p>So, what are you waiting for? Share the app, grow your followers, and start earning today!</p>
                </div>
            </section>

            <section id="edit-profile-section" class="container">
                <h2>Update Your Profile Details</h2>
                <div id="edit-profile-message" class="message hidden"></div>
                <form id="edit-profile-form">
                    <label for="editUsername">Username:</label>
                    <input type="text" id="editUsername" required>
                    <label for="editPhone" class="mt-4">Phone Number (Optional):</label>
                    <input type="text" id="editPhone">
                    <label for="editWhatsApp" class="mt-4">WhatsApp Number (Optional):</label>
                    <input type="text" id="editWhatsApp">
                    <label for="editInstagram" class="mt-4">Instagram Handle (Optional):</label>
                    <input type="text" id="editInstagram">
                    <button type="submit" class="mt-4">Save Changes</button>
                    <button type="button" onclick="showSection('user-profile-section')" class="mt-4" style="background-color: #6c757d;">Cancel</button>
                </form>
            </section>

            <section id="settings-section" class="container">
                <h2>App Settings</h2>
                <p class="text-center mt-4">App Version: 1.0.1 Pro</p>
                <button onclick="showSection('monetization-info-section')" class="mt-4" style="background-color: var(--success-color);">Monetization Program</button>
                <button onclick="auth.signOut()" class="mt-4" style="background-color: var(--error-color);">Sign Out</button>
            </section>

        </main>

        <footer>
            <div class="nav-item active" data-section="home-posts">
                <span class="icon icon-home"></span>
                <span>Home</span>
            </div>
            <div class="nav-item" data-section="create-post-section">
                <span class="icon icon-plus"></span>
                <span>Create</span>
            </div>
            <div class="nav-item" data-section="user-profile-section">
                <span class="icon icon-user"></span>
                <span>Profile</span>
            </div>
            <div class="nav-item" data-section="settings-section">
                <span class="icon icon-settings"></span>
                <span>Settings</span>
            </div>
        </footer>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDlZA4grzF3fx95-11E4s7ASXwkIij1k1w",
            authDomain: "addmint-7ab6b.firebaseapp.com",
            databaseURL: "https://addmint-7ab6b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "addmint-7ab6b",
            storageBucket: "addmint-7ab6b.firebasestorage.app",
            messagingSenderId: "504015450137",
            appId: "1:504015450137:web:694b176313582cce1e7a88",
            measurementId: "G-H7J7M23Z82"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUserId = null;
        let currentUserProfile = null;
        let lastDailyRewardTime = 0;
        let postLimitsLeft = 0;
        let dailyFreePosts = 2; // Fixed number of free posts per day
        let currentViewingUserId = null; // To track which user's profile is being viewed

        // --- UI & Helper Functions ---
        function showSection(sectionId) { /* ... same as before ... */ }
        function showMessage(elementId, message, type = 'info') { /* ... same as before ... */ }
        function hideMessage(elementId) { /* ... same as before ... */ }
        function togglePasswordVisibility(inputId, iconElement) { /* ... same as before ... */ }
        function showMainAppUI() { /* ... same as before ... */ }
        function hidePreloader() { /* ... same as before ... */ }
        function toggleSettingsMenu() { showSection('settings-section'); }

        // Initial loading of Google Translate API
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }
        
        // This function will update the header UI with user's coins, credits, limits
        function updateHeaderUI() {
            if (currentUserProfile) {
                document.getElementById('header-coin-count').textContent = currentUserProfile.coins || 0;
                document.getElementById('header-credit-count').textContent = currentUserProfile.credits || 0;
                document.getElementById('header-limit-count').textContent = currentUserProfile.postLimits || 0;
                document.getElementById('message-credit-count').textContent = currentUserProfile.credits || 0;

                // Update create post section counts
                document.getElementById('posts-free-count').textContent = Math.max(0, dailyFreePosts - (currentUserProfile.postsToday || 0));
                document.getElementById('posts-coin-count').textContent = currentUserProfile.coins || 0;
                document.getElementById('posts-limit-count').textContent = currentUserProfile.postLimits || 0;

            } else {
                // Hide counts if not logged in
                document.getElementById('header-coin-count').textContent = 0;
                document.getElementById('header-credit-count').textContent = 0;
                document.getElementById('header-limit-count').textContent = 0;
            }
        }

        // --- Authentication ---
        // (Signup, Signin, sendVerificationEmail functions are largely the same)

        // --- Profile Management ---
        // (profile-setup-form and edit-profile-form listeners are similar, but with more fields)
        document.getElementById('profile-setup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage('profile-setup-message');
            const username = document.getElementById('profileUsername').value.trim();
            if (!username) { /* ... error check ... */ return; }

            try {
                // Create user document with initial values
                await db.collection('users').doc(currentUserId).set({
                    username: username,
                    email: auth.currentUser.email,
                    phone: document.getElementById('profilePhone').value.trim() || null,
                    whatsapp: document.getElementById('profileWhatsApp').value.trim() || null,
                    instagram: document.getElementById('profileInstagram').value.trim() || null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    coins: 10,       // Initial free coins
                    credits: 10,     // Initial free credits
                    postLimits: 2,   // Initial free limits
                    postsToday: 0,
                    lastDailyReward: firebase.firestore.Timestamp.now(), // Set initial timestamp
                    followers: 0,
                    following: 0,
                    likedPosts: [],  // Array of post IDs liked by this user
                    followedUsers: [] // Array of user IDs followed by this user
                });
                
                // Fetch new profile data and show main UI
                await fetchUserProfile(currentUserId);
                showMainAppUI();
            } catch (error) {
                console.error("Error setting up profile:", error.message);
                showMessage('profile-setup-message', `Failed to save profile: ${error.message}`, 'error');
            }
        });

        async function fetchUserProfile(uid, isCurrent = true) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (userDoc.exists) {
                    const profileData = userDoc.data();
                    if (isCurrent) {
                        currentUserProfile = profileData;
                        updateHeaderUI();
                        // Populate current user profile section
                        document.getElementById('current-user-profile-details').innerHTML = `
                            <div class="profile-header">
                                <div class="profile-avatar">${profileData.username.charAt(0).toUpperCase()}</div>
                                <div class="profile-info">
                                    <h3>${profileData.username}</h3>
                                    <p>${profileData.email}</p>
                                </div>
                            </div>
                            <div class="profile-stats">
                                <div><strong>${profileData.postsToday || 0}</strong><span>Posts Today</span></div>
                                <div><strong>${profileData.followers || 0}</strong><span>Followers</span></div>
                                <div><strong>${profileData.following || 0}</strong><span>Following</span></div>
                            </div>
                            <div class="profile-actions mt-4">
                                <button onclick="showSection('edit-profile-section')">Edit Profile</button>
                                <button onclick="auth.signOut()" style="background-color: var(--error-color);">Sign Out</button>
                            </div>
                        `;
                        fetchUserPosts(uid, 'my-active-posts');
                    } else {
                        // Populate other user's profile section
                        currentViewingUserId = uid;
                        document.getElementById('other-user-profile-username').textContent = profileData.username;
                        document.getElementById('other-user-profile-id').textContent = `ID: ${uid}`;
                        document.getElementById('other-user-posts-count').textContent = profileData.postsToday || 0; // Or a dedicated posts count field
                        document.getElementById('other-user-followers-count').textContent = profileData.followers || 0;
                        document.getElementById('other-user-following-count').textContent = profileData.following || 0;

                        // Check if current user is already following
                        const followBtn = document.getElementById('follow-button');
                        if (currentUserProfile.followedUsers && currentUserProfile.followedUsers.includes(uid)) {
                            followBtn.textContent = 'Unfollow';
                            followBtn.classList.add('unfollow');
                        } else {
                            followBtn.textContent = 'Follow';
                            followBtn.classList.remove('unfollow');
                        }
                        
                        fetchUserPosts(uid, 'post-user-profile-posts');
                        showSection('post-user-profile-section');
                    }
                } else {
                    console.error("User profile not found in Firestore.");
                    if(isCurrent) showSection('setup-profile');
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
            }
        }
        
        async function toggleFollow() {
            if (!currentUserId || !currentViewingUserId || currentUserId === currentViewingUserId) return;
            const followBtn = document.getElementById('follow-button');
            const isFollowing = followBtn.classList.contains('unfollow');
            
            const currentUserRef = db.collection('users').doc(currentUserId);
            const otherUserRef = db.collection('users').doc(currentViewingUserId);

            try {
                if (isFollowing) {
                    // Unfollow logic
                    await currentUserRef.update({
                        following: firebase.firestore.FieldValue.increment(-1),
                        followedUsers: firebase.firestore.FieldValue.arrayRemove(currentViewingUserId)
                    });
                    await otherUserRef.update({
                        followers: firebase.firestore.FieldValue.increment(-1)
                    });
                } else {
                    // Follow logic
                    await currentUserRef.update({
                        following: firebase.firestore.FieldValue.increment(1),
                        followedUsers: firebase.firestore.FieldValue.arrayUnion(currentViewingUserId)
                    });
                    await otherUserRef.update({
                        followers: firebase.firestore.FieldValue.increment(1)
                    });
                }
                
                // Refresh UI
                await fetchUserProfile(currentUserId);
                await fetchUserProfile(currentViewingUserId, false);
            } catch (error) {
                console.error("Error toggling follow:", error);
            }
        }


        // --- Post Management ---
        function canPost() {
            if (!currentUserProfile) return false;
            if ((currentUserProfile.postsToday || 0) < dailyFreePosts) return 'free';
            if ((currentUserProfile.postLimits || 0) > 0) return 'limit';
            if ((currentUserProfile.coins || 0) >= 5) return 'coins';
            return 'none';
        }

        async function useCoinForPost() {
            if (canPost() !== 'coins') {
                alert('You don\'t have enough coins or limits to post. You can earn more by watching ads!');
                return;
            }
            if (confirm(`This will cost 5 coins. Your current coins: ${currentUserProfile.coins}. Do you want to continue?`)) {
                try {
                    await db.collection('users').doc(currentUserId).update({
                        coins: firebase.firestore.FieldValue.increment(-5)
                    });
                    // Proceed with posting logic
                    document.getElementById('create-post-form').dispatchEvent(new Event('submit'));
                } catch (error) {
                    console.error("Error using coins for post:", error);
                    alert("Failed to use coins. Please try again.");
                }
            }
        }
        
        async function requestAdForPost() {
            if (!currentUserId) return;
            if ((currentUserProfile.postLimits || 0) > 0) {
                 // Already have a limit, no need to watch ad
                 alert(`You have ${currentUserProfile.postLimits} limits. You can post directly!`);
                 return;
            }
            // Ask App Inventor to show an ad for a post limit
            window.AppInventor.setWebViewString("SHOW_AD:post_limit");
        }

        document.getElementById('create-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage('create-post-message');
            const content = document.getElementById('post-content').value.trim();
            if (!content) { /* ... error check ... */ return; }

            let postType = canPost();
            if (postType === 'none') {
                showMessage('create-post-message', 'You have no free posts, coins, or limits left. Watch an ad to get a post limit!', 'error');
                return;
            }

            try {
                // Create the post
                const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // Posts expire after 24 hours
                await db.collection('posts').add({
                    content: content,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    expiryTime: expiryTime,
                    userId: currentUserId,
                    username: currentUserProfile.username,
                    likes: 0,
                    likingUsers: []
                });

                // Update user's post count and resources based on post type
                let updateObject = {};
                if (postType === 'free') {
                    updateObject.postsToday = firebase.firestore.FieldValue.increment(1);
                } else if (postType === 'limit') {
                    updateObject.postLimits = firebase.firestore.FieldValue.increment(-1);
                } else if (postType === 'coins') {
                    updateObject.coins = firebase.firestore.FieldValue.increment(-5);
                }

                await db.collection('users').doc(currentUserId).update(updateObject);

                showMessage('create-post-message', 'Post published successfully!', 'success');
                document.getElementById('post-content').value = '';
                await fetchUserProfile(currentUserId); // Refresh profile data
                fetchPosts();
                showSection('home-posts');
            } catch (error) {
                console.error("Error creating post:", error.message);
                showMessage('create-post-message', `Failed to publish post: ${error.message}`, 'error');
            }
        });

        async function fetchPosts() {
            const postsListDiv = document.getElementById('posts-list');
            postsListDiv.innerHTML = '<p class="text-center" id="no-posts-message" style="margin-top: 30px; font-style: italic; color: #aaa;">Fetching exciting posts...</p>';
            const noPostsMessage = document.getElementById('no-posts-message');

            try {
                const snapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
                if (snapshot.empty) { /* ... empty message ... */ return; }

                postsListDiv.innerHTML = '';
                let hasVisiblePosts = false;
                const postStyles = ['horizontal', 'square', 'neon', 'triangular', 'table-style', 'diamond-style']; // Added more styles
                let lastRandomIndex = -1;

                snapshot.forEach(doc => {
                    const post = doc.data();
                    const postId = doc.id;
                    if (post.expiryTime && post.expiryTime < Date.now()) return;
                    hasVisiblePosts = true;

                    let randomIndex;
                    do { randomIndex = Math.floor(Math.random() * postStyles.length); } while (randomIndex === lastRandomIndex);
                    lastRandomIndex = randomIndex;
                    const randomStyle = postStyles[randomIndex];

                    const postCard = document.createElement('div');
                    postCard.className = `post-card ${randomStyle}`;
                    postCard.id = `post-${postId}`;

                    // Check if current user has liked this post
                    const isLiked = currentUserProfile.likedPosts && currentUserProfile.likedPosts.includes(postId);
                    const likeButtonClass = isLiked ? 'liked' : '';
                    
                    // The HTML for the post card is now much more complex
                    postCard.innerHTML = `
                        <div class="post-header">
                            <h3 onclick="showUserProfileFromPost('${post.userId}')">${post.username || 'Anonymous'}</h3>
                            <div class="post-options">
                                <button class="icon-button" onclick="translatePost(event, '${postId}')"><span class="icon icon-translate"></span></button>
                                <button class="icon-button" onclick="playSound(event, '${postId}')"><span class="sound-wave-icon"><span></span><span></span><span></span></span></button>
                                ${post.userId === currentUserId ? `<button class="icon-button" onclick="deletePost(event, '${postId}')" style="color: var(--error-color);">X</button>` : ''}
                            </div>
                        </div>
                        <div class="post-content-wrapper" onclick="showUserProfileFromPost('${post.userId}')">
                            <p id="post-content-${postId}">${post.content}</p>
                        </div>
                        <div class="post-meta">
                            <span>${post.timestamp ? new Date(post.timestamp.toDate()).toLocaleString() : 'N/A'}</span>
                            <span><span id="likes-${postId}">${post.likes || 0}</span> Likes</span>
                        </div>
                        <div class="post-actions">
                            <button class="like-btn ${likeButtonClass}" onclick="likePost(event, '${postId}')">${isLiked ? 'Unlike' : 'Like'}</button>
                            <button onclick="contactUser(event, '${post.userId}', 'whatsapp')">WhatsApp</button>
                            <button onclick="contactUser(event, '${post.userId}', 'instagram')">Instagram</button>
                        </div>
                    `;
                    postsListDiv.appendChild(postCard);
                });
                // ... logic to hide no posts message
            } catch (error) {
                console.error("Error fetching posts:", error);
                // ... logic to show error message
            }
        }
        
        // ... (other functions like likePost, deletePost, contactUser, etc. are updated) ...
        async function likePost(event, postId) {
            event.stopPropagation(); // Prevent opening profile
            if (!currentUserId) { /* ... auth check ... */ return; }
            
            const postRef = db.collection('posts').doc(postId);
            const userRef = db.collection('users').doc(currentUserId);
            
            const postCard = document.getElementById(`post-${postId}`);
            const likeBtn = postCard.querySelector('.like-btn');
            const isCurrentlyLiked = likeBtn.classList.contains('liked');

            await db.runTransaction(async (transaction) => {
                const postDoc = await transaction.get(postRef);
                const userDoc = await transaction.get(userRef);

                if (!postDoc.exists || !userDoc.exists) { throw "Post or User does not exist!"; }
                const postData = postDoc.data();
                const userData = userDoc.data();

                let newLikes = postData.likes || 0;
                let newLikingUsers = postData.likingUsers || [];
                let userLikedPosts = userData.likedPosts || [];

                if (isCurrentlyLiked) {
                    // Unlike
                    newLikes--;
                    newLikingUsers = newLikingUsers.filter(id => id !== currentUserId);
                    userLikedPosts = userLikedPosts.filter(id => id !== postId);
                } else {
                    // Like
                    newLikes++;
                    if (!newLikingUsers.includes(currentUserId)) { newLikingUsers.push(currentUserId); }
                    if (!userLikedPosts.includes(postId)) { userLikedPosts.push(postId); }
                }

                transaction.update(postRef, { likes: newLikes, likingUsers: newLikingUsers });
                transaction.update(userRef, { likedPosts: userLikedPosts });

                // Optimistic UI update
                likeBtn.textContent = isCurrentlyLiked ? 'Like' : 'Unlike';
                if (isCurrentlyLiked) { likeBtn.classList.remove('liked'); } else { likeBtn.classList.add('liked'); }
                document.getElementById(`likes-${postId}`).textContent = newLikes;
                currentUserProfile.likedPosts = userLikedPosts;
            });

        }

        function showUserProfileFromPost(userId) {
            if (userId === currentUserId) {
                showSection('user-profile-section');
            } else {
                fetchUserProfile(userId, false);
            }
        }
        
        async function translatePost(event, postId) {
            event.stopPropagation();
            const postContentElement = document.getElementById(`post-content-${postId}`);
            if (postContentElement.dataset.originalText) {
                 // Restore original text
                 postContentElement.textContent = postContentElement.dataset.originalText;
                 delete postContentElement.dataset.originalText;
            } else {
                // Translate
                postContentElement.dataset.originalText = postContentElement.textContent;
                // This is a placeholder using a simple API. A real implementation would need a backend.
                // For a web app, you would use Google Translate Element, but it's not ideal for mobile webviews.
                alert("Translate function is for demonstration. A proper API call is required for a real app.");
            }
        }

        function playSound(event, postId) {
            event.stopPropagation();
            // This is a placeholder. You'd need to play a sound file here.
            // Example using Audio element (might not work well in all webviews):
            // const audio = new Audio('path/to/your/sound.mp3');
            // audio.play().catch(e => console.error('Error playing sound:', e));
            alert("Sound playback requested! (Functionality will depend on your App Inventor setup)");
        }
        
        // --- Ad and Rewards Management ---
        function requestAdReward(rewardType) {
            if (!currentUserId) { showMessage('ad-reward-message', 'Please sign in to earn rewards.', 'error'); return; }
            window.AppInventor.setWebViewString(`SHOW_AD:${rewardType}`);
        }

        window.unityAdRewardCallback = (rewardType) => {
            // This function is called by App Inventor after a successful ad view
            if (!currentUserId) return;
            let updateObject = {};
            let message = '';
            
            switch (rewardType) {
                case 'coins':
                    updateObject.coins = firebase.firestore.FieldValue.increment(10);
                    message = 'You earned 10 coins!';
                    break;
                case 'credits':
                    updateObject.credits = firebase.firestore.FieldValue.increment(10);
                    message = 'You earned 10 credits!';
                    break;
                case 'limit':
                    updateObject.postLimits = firebase.firestore.FieldValue.increment(1);
                    message = 'You earned 1 post limit!';
                    break;
                case 'post_limit':
                    updateObject.postLimits = firebase.firestore.FieldValue.increment(1);
                    message = 'You can now create another post!';
                    break;
            }
            
            if (Object.keys(updateObject).length > 0) {
                db.collection('users').doc(currentUserId).update(updateObject)
                    .then(() => {
                        fetchUserProfile(currentUserId);
                        showMessage('ad-reward-message', message, 'success');
                    })
                    .catch(e => {
                        console.error('Failed to update reward:', e);
                        showMessage('ad-reward-message', 'Failed to update your reward. Please try again.', 'error');
                    });
            }
        };

        // --- Daily Reward Logic ---
        async function checkAndGrantDailyReward() {
            if (!currentUserProfile || !currentUserProfile.lastDailyReward) return;
            
            const lastRewardDate = currentUserProfile.lastDailyReward.toDate();
            const now = new Date();
            
            // Check if it's a new day since the last reward
            if (lastRewardDate.getDate() !== now.getDate() || lastRewardDate.getMonth() !== now.getMonth() || lastRewardDate.getFullYear() !== now.getFullYear()) {
                 const userRef = db.collection('users').doc(currentUserId);
                 await userRef.update({
                    coins: firebase.firestore.FieldValue.increment(10),
                    credits: firebase.firestore.FieldValue.increment(10),
                    postLimits: firebase.firestore.FieldValue.increment(2),
                    lastDailyReward: firebase.firestore.FieldValue.serverTimestamp(),
                    postsToday: 0 // Reset daily post count
                 });
                 fetchUserProfile(currentUserId); // Refresh UI
            }
        }
        
        // --- Other functions (fetchUserPosts, cleanupOldPosts, etc.) ---
        
        // --- Event Listeners and Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Same as before...
            // Inside onAuthStateChanged, after a user logs in:
            // Check for daily reward
            if (user) {
                // ... existing logic ...
                checkAndGrantDailyReward();
            }
        });
    </script>
</body>
</html>
